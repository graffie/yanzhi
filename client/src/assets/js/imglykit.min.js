require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){(function(global){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},ImglyKit=_interopRequire(require("./src/js/imglykit"));!function(){"undefined"!=typeof window?window.ImglyKit=ImglyKit:"undefined"!=typeof module?module.exports=ImglyKit:"undefined"!=typeof global&&(global.ImglyKit=ImglyKit)}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/js/imglykit":12}],2:[function(require){(function(global){"use strict";if(global._babelPolyfill)throw new Error("only one instance of babel/polyfill is allowed");global._babelPolyfill=!0,require("core-js/shim"),require("regenerator-babel/runtime")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"core-js/shim":3,"regenerator-babel/runtime":4}],3:[function(require,module){!function(global,framework,undefined){"use strict";function isObject(it){return null!==it&&("object"==typeof it||"function"==typeof it)}function isFunction(it){return"function"==typeof it}function setToStringTag(it,tag,stat){it&&!has(it=stat?it:it[PROTOTYPE],SYMBOL_TAG)&&hidden(it,SYMBOL_TAG,tag)}function cof(it){return toString.call(it).slice(8,-1)}function classof(it){var O,T;return it==undefined?it===undefined?"Undefined":"Null":"string"==typeof(T=(O=Object(it))[SYMBOL_TAG])?T:cof(O)}function part(){for(var fn=assertFunction(this),length=arguments.length,args=Array(length),i=0,_=path._,holder=!1;length>i;)(args[i]=arguments[i++])===_&&(holder=!0);return function(){var _args,that=this,_length=arguments.length,i=0,j=0;if(!holder&&!_length)return invoke(fn,args,that);if(_args=args.slice(),holder)for(;length>i;i++)_args[i]===_&&(_args[i]=arguments[j++]);for(;_length>j;)_args.push(arguments[j++]);return invoke(fn,_args,that)}}function ctx(fn,that,length){if(assertFunction(fn),~length&&that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}function invoke(fn,args,that){var un=that===undefined;switch(0|args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3]);case 5:return un?fn(args[0],args[1],args[2],args[3],args[4]):fn.call(that,args[0],args[1],args[2],args[3],args[4])}return fn.apply(that,args)}function toObject(it){return ES5Object(assertDefined(it))}function returnIt(it){return it}function returnThis(){return this}function get(object,key){return has(object,key)?object[key]:void 0}function ownKeys(it){return assertObject(it),getSymbols?getNames(it).concat(getSymbols(it)):getNames(it)}function keyOf(object,el){for(var key,O=toObject(object),keys=getKeys(O),length=keys.length,index=0;length>index;)if(O[key=keys[index++]]===el)return key}function array(it){return String(it).split(",")}function createArrayMethod(type){var isMap=1==type,isFilter=2==type,isSome=3==type,isEvery=4==type,isFindIndex=6==type,noholes=5==type||isFindIndex;return function(callbackfn){for(var val,res,O=Object(assertDefined(this)),that=arguments[1],self=ES5Object(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=isMap?Array(length):isFilter?[]:undefined;length>index;index++)if((noholes||index in self)&&(val=self[index],res=f(val,index,O),type))if(isMap)result[index]=res;else if(res)switch(type){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val)}else if(isEvery)return!1;return isFindIndex?-1:isSome||isEvery?isEvery:result}}function createArrayContains(isContains){return function(el){var O=toObject(this),length=toLength(O.length),index=toIndex(arguments[1],length);if(isContains&&el!=el){for(;length>index;index++)if(sameNaN(O[index]))return isContains||index}else for(;length>index;index++)if((isContains||index in O)&&O[index]===el)return isContains||index;return!isContains&&-1}}function generic(A,B){return"function"==typeof A?A:B}function sameNaN(number){return number!=number}function toInteger(it){return isNaN(it)?0:trunc(it)}function toLength(it){return it>0?min(toInteger(it),MAX_SAFE_INTEGER):0}function toIndex(index,length){var index=toInteger(index);return 0>index?max(index+length,0):min(index,length)}function createReplacer(regExp,replace,isStatic){var replacer=isObject(replace)?function(part){return replace[part]}:replace;return function(it){return String(isStatic?it:this).replace(regExp,replacer)}}function createPointAt(toString){return function(pos){var a,b,s=String(assertDefined(this)),i=toInteger(pos),l=s.length;return 0>i||i>=l?toString?"":undefined:(a=s.charCodeAt(i),55296>a||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?toString?s.charAt(i):a:toString?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536)}}function assert(condition,msg1,msg2){if(!condition)throw TypeError(msg2?msg1+msg2:msg1)}function assertDefined(it){if(it==undefined)throw TypeError("Function called on null or undefined");return it}function assertFunction(it){return assert(isFunction(it),it," is not a function!"),it}function assertObject(it){return assert(isObject(it),it," is not an object!"),it}function assertInstance(it,Constructor,name){assert(it instanceof Constructor,name,": use the 'new' operator!")}function descriptor(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}}function simpleSet(object,key,value){return object[key]=value,object}function createDefiner(bitmap){return DESC?function(object,key,value){return defineProperty(object,key,descriptor(bitmap,value))}:simpleSet}function uid(key){return SYMBOL+"("+key+")_"+(++sid+random())[TO_STRING](36)}function getWellKnownSymbol(name,setter){return Symbol&&Symbol[name]||(setter?Symbol:safeSymbol)(SYMBOL+DOT+name)}function assignHidden(target,src){for(var key in src)hidden(target,key,src[key]);return target}function setSpecies(C){!DESC||!framework&&isNative(C)||defineProperty(C,SYMBOL_SPECIES,{configurable:!0,get:returnThis})}function $define(type,name,source){var key,own,out,exp,isGlobal=type&GLOBAL,target=isGlobal?global:type&STATIC?global[name]:(global[name]||ObjectProto)[PROTOTYPE],exports=isGlobal?core:core[name]||(core[name]={});isGlobal&&(source=name);for(key in source)own=!(type&FORCED)&&target&&key in target&&(!isFunction(target[key])||isNative(target[key])),out=(own?target:source)[key],framework||!isGlobal||isFunction(target[key])?type&BIND&&own?exp=ctx(out,global):type&WRAP&&!framework&&target[key]==out?(exp=function(param){return this instanceof out?new out(param):out(param)},exp[PROTOTYPE]=out[PROTOTYPE]):exp=type&PROTO&&isFunction(out)?ctx(call,out):out:exp=source[key],framework&&target&&!own&&(isGlobal?target[key]=out:delete target[key]&&hidden(target,key,out)),exports[key]!=out&&hidden(exports,key,exp)}function setIterator(O,value){hidden(O,SYMBOL_ITERATOR,value),FF_ITERATOR in ArrayProto&&hidden(O,FF_ITERATOR,value)}function createIterator(Constructor,NAME,next,proto){Constructor[PROTOTYPE]=create(proto||IteratorPrototype,{next:descriptor(1,next)}),setToStringTag(Constructor,NAME+" Iterator")}function defineIterator(Constructor,NAME,value,DEFAULT){var proto=Constructor[PROTOTYPE],iter=get(proto,SYMBOL_ITERATOR)||get(proto,FF_ITERATOR)||DEFAULT&&get(proto,DEFAULT)||value;if(framework&&(setIterator(proto,iter),iter!==value)){var iterProto=getPrototypeOf(iter.call(new Constructor));setToStringTag(iterProto,NAME+" Iterator",!0),has(proto,FF_ITERATOR)&&setIterator(iterProto,returnThis)}return Iterators[NAME]=iter,Iterators[NAME+" Iterator"]=returnThis,iter}function defineStdIterators(Base,NAME,Constructor,next,DEFAULT,IS_SET){function createIter(kind){return function(){return new Constructor(this,kind)}}createIterator(Constructor,NAME,next);var entries=createIter(KEY+VALUE),values=createIter(VALUE);DEFAULT==VALUE?values=defineIterator(Base,NAME,values,"values"):entries=defineIterator(Base,NAME,entries,"entries"),DEFAULT&&$define(PROTO+FORCED*BUGGY_ITERATORS,NAME,{entries:entries,keys:IS_SET?values:createIter(KEY),values:values})}function iterResult(done,value){return{value:value,done:!!done}}function isIterable(it){var O=Object(it),Symbol=global[SYMBOL],hasExt=(Symbol&&Symbol[ITERATOR]||FF_ITERATOR)in O;return hasExt||SYMBOL_ITERATOR in O||has(Iterators,classof(O))}function getIterator(it){var Symbol=global[SYMBOL],ext=it[Symbol&&Symbol[ITERATOR]||FF_ITERATOR],getIter=ext||it[SYMBOL_ITERATOR]||Iterators[classof(it)];return assertObject(getIter.call(it))}function stepCall(fn,value,entries){return entries?invoke(fn,value):fn(value)}function checkDangerIterClosing(fn){var danger=!0,O={next:function(){throw 1},"return":function(){danger=!1}};O[SYMBOL_ITERATOR]=returnThis;try{fn(O)}catch(e){}return danger}function closeIterator(iterator){var ret=iterator["return"];ret!==undefined&&ret.call(iterator)}function safeIterClose(exec,iterator){try{exec(iterator)}catch(e){throw closeIterator(iterator),e}}function forOf(iterable,entries,fn,that){safeIterClose(function(iterator){for(var step,f=ctx(fn,that,entries?2:1);!(step=iterator.next()).done;)if(stepCall(f,step.value,entries)===!1)return closeIterator(iterator)},getIterator(iterable))}var REFERENCE_GET,SYMBOL_ITERATOR,exportGlobal,OBJECT="Object",FUNCTION="Function",ARRAY="Array",STRING="String",NUMBER="Number",REGEXP="RegExp",DATE="Date",MAP="Map",SET="Set",WEAKMAP="WeakMap",WEAKSET="WeakSet",SYMBOL="Symbol",PROMISE="Promise",MATH="Math",ARGUMENTS="Arguments",PROTOTYPE="prototype",CONSTRUCTOR="constructor",TO_STRING="toString",TO_STRING_TAG=TO_STRING+"Tag",HAS_OWN="hasOwnProperty",FOR_EACH="forEach",ITERATOR="iterator",FF_ITERATOR="@@"+ITERATOR,PROCESS="process",CREATE_ELEMENT="createElement",Function=global[FUNCTION],Object=global[OBJECT],Array=global[ARRAY],String=global[STRING],Number=global[NUMBER],RegExp=global[REGEXP],Map=(global[DATE],global[MAP]),Set=global[SET],WeakMap=global[WEAKMAP],WeakSet=global[WEAKSET],Symbol=global[SYMBOL],Math=global[MATH],TypeError=global.TypeError,RangeError=global.RangeError,setTimeout=global.setTimeout,setImmediate=global.setImmediate,clearImmediate=global.clearImmediate,parseInt=global.parseInt,isFinite=global.isFinite,process=global[PROCESS],nextTick=process&&process.nextTick,document=global.document,html=document&&document.documentElement,define=(global.navigator,global.define),console=global.console||{},ArrayProto=Array[PROTOTYPE],ObjectProto=Object[PROTOTYPE],FunctionProto=Function[PROTOTYPE],Infinity=1/0,DOT=".",isNative=ctx(/./.test,/\[native code\]\s*\}\s*$/,1),toString=ObjectProto[TO_STRING],call=FunctionProto.call,apply=FunctionProto.apply,create=Object.create,getPrototypeOf=Object.getPrototypeOf,setPrototypeOf=Object.setPrototypeOf,defineProperty=Object.defineProperty,getOwnDescriptor=(Object.defineProperties,Object.getOwnPropertyDescriptor),getKeys=Object.keys,getNames=Object.getOwnPropertyNames,getSymbols=Object.getOwnPropertySymbols,isFrozen=Object.isFrozen,has=ctx(call,ObjectProto[HAS_OWN],2),ES5Object=Object,assign=Object.assign||function(target){for(var T=Object(assertDefined(target)),l=arguments.length,i=1;l>i;)for(var key,S=ES5Object(arguments[i++]),keys=getKeys(S),length=keys.length,j=0;length>j;)T[key=keys[j++]]=S[key];return T},push=ArrayProto.push,forEach=(ArrayProto.unshift,ArrayProto.slice,ArrayProto.splice,ArrayProto.indexOf,ArrayProto[FOR_EACH]),MAX_SAFE_INTEGER=9007199254740991,pow=Math.pow,abs=Math.abs,ceil=Math.ceil,floor=Math.floor,max=Math.max,min=Math.min,random=Math.random,trunc=Math.trunc||function(it){return(it>0?floor:ceil)(it)},DESC=!!function(){try{return 2==defineProperty({},"a",{get:function(){return 2}}).a}catch(e){}}(),sid=0,hidden=createDefiner(1),set=Symbol?simpleSet:hidden,safeSymbol=Symbol||uid,SYMBOL_UNSCOPABLES=getWellKnownSymbol("unscopables"),ArrayUnscopables=ArrayProto[SYMBOL_UNSCOPABLES]||{},SYMBOL_TAG=getWellKnownSymbol(TO_STRING_TAG),SYMBOL_SPECIES=getWellKnownSymbol("species"),NODE=cof(process)==PROCESS,core={},path=framework?global:core,old=global.core,FORCED=1,GLOBAL=2,STATIC=4,PROTO=8,BIND=16,WRAP=32;"undefined"!=typeof module&&module.exports?module.exports=core:isFunction(define)&&define.amd?define(function(){return core}):exportGlobal=!0,(exportGlobal||framework)&&(core.noConflict=function(){return global.core=old,core},global.core=core),SYMBOL_ITERATOR=getWellKnownSymbol(ITERATOR);var ITER=safeSymbol("iter"),KEY=1,VALUE=2,Iterators={},IteratorPrototype={},BUGGY_ITERATORS="keys"in ArrayProto&&!("next"in[].keys());setIterator(IteratorPrototype,returnThis),!function(TAG,SymbolRegistry,AllSymbols,setter){isNative(Symbol)||(Symbol=function(description){assert(!(this instanceof Symbol),SYMBOL+" is not a "+CONSTRUCTOR);var tag=uid(description),sym=set(create(Symbol[PROTOTYPE]),TAG,tag);return AllSymbols[tag]=sym,DESC&&setter&&defineProperty(ObjectProto,tag,{configurable:!0,set:function(value){hidden(this,tag,value)}}),sym},hidden(Symbol[PROTOTYPE],TO_STRING,function(){return this[TAG]})),$define(GLOBAL+WRAP,{Symbol:Symbol});var symbolStatics={"for":function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=Symbol(key)},iterator:SYMBOL_ITERATOR||getWellKnownSymbol(ITERATOR),keyFor:part.call(keyOf,SymbolRegistry),species:SYMBOL_SPECIES,toStringTag:SYMBOL_TAG=getWellKnownSymbol(TO_STRING_TAG,!0),unscopables:SYMBOL_UNSCOPABLES,pure:safeSymbol,set:set,useSetter:function(){setter=!0},useSimple:function(){setter=!1}};forEach.call(array("hasInstance,isConcatSpreadable,match,replace,search,split,toPrimitive"),function(it){symbolStatics[it]=getWellKnownSymbol(it)}),$define(STATIC,SYMBOL,symbolStatics),setToStringTag(Symbol,SYMBOL),$define(STATIC+FORCED*!isNative(Symbol),OBJECT,{getOwnPropertyNames:function(it){for(var key,names=getNames(toObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])||result.push(key);return result},getOwnPropertySymbols:function(it){for(var key,names=getNames(toObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])&&result.push(AllSymbols[key]);return result}}),setToStringTag(Math,MATH,!0),setToStringTag(global.JSON,"JSON",!0)}(safeSymbol("tag"),{},{},!0),!function(){var objectStatic={assign:assign,is:function(x,y){return x===y?0!==x||1/x===1/y:x!=x&&y!=y}};"__proto__"in ObjectProto&&function(buggy,set){try{set=ctx(call,getOwnDescriptor(ObjectProto,"__proto__").set,2),set({},ArrayProto)}catch(e){buggy=!0}objectStatic.setPrototypeOf=setPrototypeOf=setPrototypeOf||function(O,proto){return assertObject(O),assert(null===proto||isObject(proto),proto,": can't set as prototype!"),buggy?O.__proto__=proto:set(O,proto),O}}(),$define(STATIC,OBJECT,objectStatic)}(),!function(tmp){tmp[SYMBOL_TAG]=DOT,cof(tmp)!=DOT&&hidden(ObjectProto,TO_STRING,function(){return"[object "+classof(this)+"]"})}({}),!function(){function wrapObjectMethod(key,MODE){var fn=Object[key],exp=core[OBJECT][key],f=0,o={};if(!exp||isNative(exp)){o[key]=1==MODE?function(it){return isObject(it)?fn(it):it}:2==MODE?function(it){return isObject(it)?fn(it):!0}:3==MODE?function(it){return isObject(it)?fn(it):!1}:4==MODE?function(it,key){return fn(toObject(it),key)}:function(it){return fn(toObject(it))};try{fn(DOT)}catch(e){f=1}$define(STATIC+FORCED*f,OBJECT,o)}}wrapObjectMethod("freeze",1),wrapObjectMethod("seal",1),wrapObjectMethod("preventExtensions",1),wrapObjectMethod("isFrozen",2),wrapObjectMethod("isSealed",2),wrapObjectMethod("isExtensible",3),wrapObjectMethod("getOwnPropertyDescriptor",4),wrapObjectMethod("getPrototypeOf"),wrapObjectMethod("keys"),wrapObjectMethod("getOwnPropertyNames")}(),!function(NAME){NAME in FunctionProto||DESC&&defineProperty(FunctionProto,NAME,{configurable:!0,get:function(){var match=String(this).match(/^\s*function ([^ (]*)/),name=match?match[1]:"";return has(this,NAME)||defineProperty(this,NAME,descriptor(5,name)),name},set:function(value){has(this,NAME)||defineProperty(this,NAME,descriptor(0,value))}})}("name"),Number("0o1")&&Number("0b1")||function(_Number,NumberProto){function toNumber(it){if(isObject(it)&&(it=toPrimitive(it)),"string"==typeof it&&it.length>2&&48==it.charCodeAt(0)){var binary=!1;switch(it.charCodeAt(1)){case 66:case 98:binary=!0;case 79:case 111:return parseInt(it.slice(2),binary?2:8)}}return+it}function toPrimitive(it){var fn,val;if(isFunction(fn=it.valueOf)&&!isObject(val=fn.call(it)))return val;if(isFunction(fn=it[TO_STRING])&&!isObject(val=fn.call(it)))return val;throw TypeError("Can't convert object to number")}Number=function Number(it){return this instanceof Number?new _Number(toNumber(it)):toNumber(it)},forEach.call(DESC?getNames(_Number):array("MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY"),function(key){key in Number||defineProperty(Number,key,getOwnDescriptor(_Number,key))}),Number[PROTOTYPE]=NumberProto,NumberProto[CONSTRUCTOR]=Number,hidden(global,NUMBER,Number)}(Number,Number[PROTOTYPE]),!function(isInteger){$define(STATIC,NUMBER,{EPSILON:pow(2,-52),isFinite:function(it){return"number"==typeof it&&isFinite(it)},isInteger:isInteger,isNaN:sameNaN,isSafeInteger:function(number){return isInteger(number)&&abs(number)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER:MAX_SAFE_INTEGER,MIN_SAFE_INTEGER:-MAX_SAFE_INTEGER,parseFloat:parseFloat,parseInt:parseInt})}(Number.isInteger||function(it){return!isObject(it)&&isFinite(it)&&floor(it)===it}),!function(){function asinh(x){return isFinite(x=+x)&&0!=x?0>x?-asinh(-x):log(x+sqrt(x*x+1)):x}function expm1(x){return 0==(x=+x)?x:x>-1e-6&&1e-6>x?x+x*x/2:exp(x)-1}var E=Math.E,exp=Math.exp,log=Math.log,sqrt=Math.sqrt,sign=Math.sign||function(x){return 0==(x=+x)||x!=x?x:0>x?-1:1};$define(STATIC,MATH,{acosh:function(x){return(x=+x)<1?0/0:isFinite(x)?log(x/E+sqrt(x+1)*sqrt(x-1)/E)+1:x},asinh:asinh,atanh:function(x){return 0==(x=+x)?x:log((1+x)/(1-x))/2},cbrt:function(x){return sign(x=+x)*pow(abs(x),1/3)},clz32:function(x){return(x>>>=0)?32-x[TO_STRING](2).length:32},cosh:function(x){return(exp(x=+x)+exp(-x))/2},expm1:expm1,fround:function(x){return new Float32Array([x])[0]},hypot:function(){for(var arg,sum=0,len1=arguments.length,len2=len1,args=Array(len1),larg=-Infinity;len1--;){if(arg=args[len1]=+arguments[len1],arg==Infinity||arg==-Infinity)return Infinity;arg>larg&&(larg=arg)}for(larg=arg||1;len2--;)sum+=pow(args[len2]/larg,2);return larg*sqrt(sum)},imul:function(x,y){var UInt16=65535,xn=+x,yn=+y,xl=UInt16&xn,yl=UInt16&yn;return 0|xl*yl+((UInt16&xn>>>16)*yl+xl*(UInt16&yn>>>16)<<16>>>0)},log1p:function(x){return(x=+x)>-1e-8&&1e-8>x?x-x*x/2:log(1+x)},log10:function(x){return log(x)/Math.LN10},log2:function(x){return log(x)/Math.LN2},sign:sign,sinh:function(x){return abs(x=+x)<1?(expm1(x)-expm1(-x))/2:(exp(x-1)-exp(-x-1))*(E/2)},tanh:function(x){var a=expm1(x=+x),b=expm1(-x);return a==Infinity?1:b==Infinity?-1:(a-b)/(exp(x)+exp(-x))},trunc:trunc})}(),!function(fromCharCode){function assertNotRegExp(it){if(cof(it)==REGEXP)throw TypeError()}$define(STATIC,STRING,{fromCodePoint:function(){for(var code,res=[],len=arguments.length,i=0;len>i;){if(code=+arguments[i++],toIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(65536>code?fromCharCode(code):fromCharCode(((code-=65536)>>10)+55296,code%1024+56320))}return res.join("")},raw:function(callSite){for(var raw=toObject(callSite.raw),len=toLength(raw.length),sln=arguments.length,res=[],i=0;len>i;)res.push(String(raw[i++])),sln>i&&res.push(String(arguments[i]));return res.join("")}}),$define(PROTO,STRING,{codePointAt:createPointAt(!1),endsWith:function(searchString){assertNotRegExp(searchString);var that=String(assertDefined(this)),endPosition=arguments[1],len=toLength(that.length),end=endPosition===undefined?len:min(toLength(endPosition),len);return searchString+="",that.slice(end-searchString.length,end)===searchString},includes:function(searchString){return assertNotRegExp(searchString),!!~String(assertDefined(this)).indexOf(searchString,arguments[1])},repeat:function(count){var str=String(assertDefined(this)),res="",n=toInteger(count);if(0>n||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))1&n&&(res+=str);return res},startsWith:function(searchString){assertNotRegExp(searchString);var that=String(assertDefined(this)),index=toLength(min(arguments[1],that.length));return searchString+="",that.slice(index,index+searchString.length)===searchString}})}(String.fromCharCode),!function(){$define(STATIC+FORCED*checkDangerIterClosing(Array.from),ARRAY,{from:function(arrayLike){var length,result,step,O=Object(assertDefined(arrayLike)),mapfn=arguments[1],mapping=mapfn!==undefined,f=mapping?ctx(mapfn,arguments[2],2):undefined,index=0;if(isIterable(O))result=new(generic(this,Array)),safeIterClose(function(iterator){for(;!(step=iterator.next()).done;index++)result[index]=mapping?f(step.value,index):step.value},getIterator(O));else for(result=new(generic(this,Array))(length=toLength(O.length));length>index;index++)result[index]=mapping?f(O[index],index):O[index];return result.length=index,result}}),$define(STATIC,ARRAY,{of:function(){for(var index=0,length=arguments.length,result=new(generic(this,Array))(length);length>index;)result[index]=arguments[index++];return result.length=length,result}}),setSpecies(Array)}(),!function(){$define(PROTO,ARRAY,{copyWithin:function(target,start){var O=Object(assertDefined(this)),len=toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments[2],fin=end===undefined?len:toIndex(end,len),count=min(fin-from,len-to),inc=1;for(to>from&&from+count>to&&(inc=-1,from=from+count-1,to=to+count-1);count-->0;)from in O?O[to]=O[from]:delete O[to],to+=inc,from+=inc;return O},fill:function(value){for(var O=Object(assertDefined(this)),length=toLength(O.length),index=toIndex(arguments[1],length),end=arguments[2],endPos=end===undefined?length:toIndex(end,length);endPos>index;)O[index++]=value;return O},find:createArrayMethod(5),findIndex:createArrayMethod(6)}),framework&&(forEach.call(array("find,findIndex,fill,copyWithin,entries,keys,values"),function(it){ArrayUnscopables[it]=!0}),SYMBOL_UNSCOPABLES in ArrayProto||hidden(ArrayProto,SYMBOL_UNSCOPABLES,ArrayUnscopables))}(),!function(at){defineStdIterators(Array,ARRAY,function(iterated,kind){set(this,ITER,{o:toObject(iterated),i:0,k:kind})},function(){var iter=this[ITER],O=iter.o,kind=iter.k,index=iter.i++;return!O||index>=O.length?(iter.o=undefined,iterResult(1)):kind==KEY?iterResult(0,index):kind==VALUE?iterResult(0,O[index]):iterResult(0,[index,O[index]])},VALUE),Iterators[ARGUMENTS]=Iterators[ARRAY],defineStdIterators(String,STRING,function(iterated){set(this,ITER,{o:String(iterated),i:0})},function(){var point,iter=this[ITER],O=iter.o,index=iter.i;return index>=O.length?iterResult(1):(point=at.call(O,index),iter.i+=point.length,iterResult(0,point))})}(createPointAt(!0)),DESC&&!function(RegExpProto,_RegExp){(function(){try{return"/a/i"==RegExp(/a/g,"i")}catch(e){}})()||(RegExp=function(pattern,flags){return new _RegExp(cof(pattern)==REGEXP&&flags!==undefined?pattern.source:pattern,flags)},forEach.call(getNames(_RegExp),function(key){key in RegExp||defineProperty(RegExp,key,{configurable:!0,get:function(){return _RegExp[key]},set:function(it){_RegExp[key]=it}})}),RegExpProto[CONSTRUCTOR]=RegExp,RegExp[PROTOTYPE]=RegExpProto,hidden(global,REGEXP,RegExp)),"g"!=/./g.flags&&defineProperty(RegExpProto,"flags",{configurable:!0,get:createReplacer(/^.*\/(\w*)$/,"$1")}),setSpecies(RegExp)}(RegExp[PROTOTYPE],RegExp),isFunction(setImmediate)&&isFunction(clearImmediate)||function(ONREADYSTATECHANGE){function run(id){if(has(queue,id)){var fn=queue[id];delete queue[id],fn()}}function listner(event){run(event.data)}var defer,channel,port,postMessage=global.postMessage,addEventListener=global.addEventListener,MessageChannel=global.MessageChannel,counter=0,queue={};setImmediate=function(fn){for(var args=[],i=1;arguments.length>i;)args.push(arguments[i++]);return queue[++counter]=function(){invoke(isFunction(fn)?fn:Function(fn),args)},defer(counter),counter},clearImmediate=function(id){delete queue[id]},NODE?defer=function(id){nextTick(part.call(run,id))}:addEventListener&&isFunction(postMessage)&&!global.importScripts?(defer=function(id){postMessage(id,"*")},addEventListener("message",listner,!1)):isFunction(MessageChannel)?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listner,defer=ctx(port.postMessage,port,1)):defer=document&&ONREADYSTATECHANGE in document[CREATE_ELEMENT]("script")?function(id){html.appendChild(document[CREATE_ELEMENT]("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(id)}}:function(id){setTimeout(run,0,id)}}("onreadystatechange"),$define(GLOBAL+BIND,{setImmediate:setImmediate,clearImmediate:clearImmediate}),!function(Promise,test){isFunction(Promise)&&isFunction(Promise.resolve)&&Promise.resolve(test=new Promise(function(){}))==test||function(asap,RECORD){function isThenable(it){var then;return isObject(it)&&(then=it.then),isFunction(then)?then:!1}function handledRejectionOrHasOnRejected(promise){var react,record=promise[RECORD],chain=record.c,i=0;if(record.h)return!0;for(;chain.length>i;)if(react=chain[i++],react.fail||handledRejectionOrHasOnRejected(react.P))return!0}function notify(record,reject){var chain=record.c;(reject||chain.length)&&asap(function(){var promise=record.p,value=record.v,ok=1==record.s,i=0;if(reject&&!handledRejectionOrHasOnRejected(promise))setTimeout(function(){handledRejectionOrHasOnRejected(promise)||(NODE?!process.emit("unhandledRejection",value,promise):isFunction(console.error)&&console.error("Unhandled promise rejection",value))},1e3);else for(;chain.length>i;)!function(react){var ret,then,cb=ok?react.ok:react.fail;try{cb?(ok||(record.h=!0),ret=cb===!0?value:cb(value),ret===react.P?react.rej(TypeError(PROMISE+"-chain cycle")):(then=isThenable(ret))?then.call(ret,react.res,react.rej):react.res(ret)):react.rej(value)}catch(err){react.rej(err)}}(chain[i++]);chain.length=0})}function resolve(value){var then,wrapper,record=this;if(!record.d){record.d=!0,record=record.r||record;try{(then=isThenable(value))?(wrapper={r:record,d:!1},then.call(value,ctx(resolve,wrapper,1),ctx(reject,wrapper,1))):(record.v=value,record.s=1,notify(record))}catch(err){reject.call(wrapper||{r:record,d:!1},err)}}}function reject(value){var record=this;record.d||(record.d=!0,record=record.r||record,record.v=value,record.s=2,notify(record,!0))}function getConstructor(C){var S=assertObject(C)[SYMBOL_SPECIES];return S!=undefined?S:C}Promise=function(executor){assertFunction(executor),assertInstance(this,Promise,PROMISE);var record={p:this,c:[],s:0,d:!1,v:undefined,h:!1};hidden(this,RECORD,record);try{executor(ctx(resolve,record,1),ctx(reject,record,1))}catch(err){reject.call(record,err)}},assignHidden(Promise[PROTOTYPE],{then:function(onFulfilled,onRejected){var S=assertObject(assertObject(this)[CONSTRUCTOR])[SYMBOL_SPECIES],react={ok:isFunction(onFulfilled)?onFulfilled:!0,fail:isFunction(onRejected)?onRejected:!1},P=react.P=new(S!=undefined?S:Promise)(function(resolve,reject){react.res=assertFunction(resolve),react.rej=assertFunction(reject)}),record=this[RECORD];return record.c.push(react),record.s&&notify(record),P},"catch":function(onRejected){return this.then(undefined,onRejected)}}),assignHidden(Promise,{all:function(iterable){var Promise=getConstructor(this),values=[];return new Promise(function(resolve,reject){forOf(iterable,!1,push,values);var remaining=values.length,results=Array(remaining);remaining?forEach.call(values,function(promise,index){Promise.resolve(promise).then(function(value){results[index]=value,--remaining||resolve(results)},reject)}):resolve(results)})},race:function(iterable){var Promise=getConstructor(this);return new Promise(function(resolve,reject){forOf(iterable,!1,function(promise){Promise.resolve(promise).then(resolve,reject)})})},reject:function(r){return new(getConstructor(this))(function(resolve,reject){reject(r)})},resolve:function(x){return isObject(x)&&RECORD in x&&getPrototypeOf(x)===this[PROTOTYPE]?x:new(getConstructor(this))(function(resolve){resolve(x)})}})}(nextTick||setImmediate,safeSymbol("record")),setToStringTag(Promise,PROMISE),setSpecies(Promise),$define(GLOBAL+FORCED*!isNative(Promise),{Promise:Promise})}(global[PROMISE]),!function(){function getCollection(C,NAME,methods,commonMethods,isMap,isWeak){function initFromIterable(that,iterable){return iterable!=undefined&&forOf(iterable,isMap,that[ADDER],that),that}function fixSVZ(key,chain){var method=proto[key];framework&&(proto[key]=function(a,b){var result=method.call(this,0===a?0:a,b);return chain?this:result})}var ADDER=isMap?"set":"add",proto=C&&C[PROTOTYPE],O={};if(isNative(C)&&(isWeak||!BUGGY_ITERATORS&&has(proto,FOR_EACH)&&has(proto,"entries"))){var buggyZero,Native=C,inst=new C,chain=inst[ADDER](isWeak?{}:-0,1);checkDangerIterClosing(function(O){new C(O)})&&(C=function(iterable){return assertInstance(this,C,NAME),initFromIterable(new Native,iterable)},C[PROTOTYPE]=proto,framework&&(proto[CONSTRUCTOR]=C)),isWeak||inst[FOR_EACH](function(val,key){buggyZero=1/key===-Infinity}),buggyZero&&(fixSVZ("delete"),fixSVZ("has"),isMap&&fixSVZ("get")),(buggyZero||chain!==inst)&&fixSVZ(ADDER,!0)}else C=isWeak?function(iterable){assertInstance(this,C,NAME),set(this,UID,uid++),initFromIterable(this,iterable)}:function(iterable){var that=this;assertInstance(that,C,NAME),set(that,O1,create(null)),set(that,SIZE,0),set(that,LAST,undefined),set(that,FIRST,undefined),initFromIterable(that,iterable)},assignHidden(assignHidden(C[PROTOTYPE],methods),commonMethods),isWeak||!DESC||defineProperty(C[PROTOTYPE],"size",{get:function(){return assertDefined(this[SIZE])}});return setToStringTag(C,NAME),setSpecies(C),O[NAME]=C,$define(GLOBAL+WRAP+FORCED*!isNative(C),O),isWeak||defineStdIterators(C,NAME,function(iterated,kind){set(this,ITER,{o:iterated,k:kind})},function(){for(var iter=this[ITER],kind=iter.k,entry=iter.l;entry&&entry.r;)entry=entry.p;return iter.o&&(iter.l=entry=entry?entry.n:iter.o[FIRST])?kind==KEY?iterResult(0,entry.k):kind==VALUE?iterResult(0,entry.v):iterResult(0,[entry.k,entry.v]):(iter.o=undefined,iterResult(1))},isMap?KEY+VALUE:VALUE,!isMap),C}function fastKey(it,create){if(!isObject(it))return("string"==typeof it?"S":"P")+it;if(isFrozen(it))return"F";if(!has(it,UID)){if(!create)return"E";hidden(it,UID,++uid)}return"O"+it[UID]}function getEntry(that,key){var entry,index=fastKey(key);if("F"!=index)return that[O1][index];for(entry=that[FIRST];entry;entry=entry.n)if(entry.k==key)return entry}function def(that,key,value){var prev,index,entry=getEntry(that,key);return entry?entry.v=value:(that[LAST]=entry={i:index=fastKey(key,!0),k:key,v:value,p:prev=that[LAST],n:undefined,r:!1},that[FIRST]||(that[FIRST]=entry),prev&&(prev.n=entry),that[SIZE]++,"F"!=index&&(that[O1][index]=entry)),that}function defWeak(that,key,value){return isFrozen(assertObject(key))?leakStore(that).set(key,value):(has(key,WEAK)||hidden(key,WEAK,{}),key[WEAK][that[UID]]=value),that}function leakStore(that){return that[LEAK]||hidden(that,LEAK,new Map)[LEAK]}var UID=safeSymbol("uid"),O1=safeSymbol("O1"),WEAK=safeSymbol("weak"),LEAK=safeSymbol("leak"),LAST=safeSymbol("last"),FIRST=safeSymbol("first"),SIZE=DESC?safeSymbol("size"):"size",uid=0,tmp={},collectionMethods={clear:function(){for(var that=this,data=that[O1],entry=that[FIRST];entry;entry=entry.n)entry.r=!0,
entry.p&&(entry.p=entry.p.n=undefined),delete data[entry.i];that[FIRST]=that[LAST]=undefined,that[SIZE]=0},"delete":function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that[O1][entry.i],entry.r=!0,prev&&(prev.n=next),next&&(next.p=prev),that[FIRST]==entry&&(that[FIRST]=next),that[LAST]==entry&&(that[LAST]=prev),that[SIZE]--}return!!entry},forEach:function(callbackfn){for(var entry,f=ctx(callbackfn,arguments[1],3);entry=entry?entry.n:this[FIRST];)for(f(entry.v,entry.k,this);entry&&entry.r;)entry=entry.p},has:function(key){return!!getEntry(this,key)}};Map=getCollection(Map,MAP,{get:function(key){var entry=getEntry(this,key);return entry&&entry.v},set:function(key,value){return def(this,0===key?0:key,value)}},collectionMethods,!0),Set=getCollection(Set,SET,{add:function(value){return def(this,value=0===value?0:value,value)}},collectionMethods);var weakMethods={"delete":function(key){return isObject(key)?isFrozen(key)?leakStore(this)["delete"](key):has(key,WEAK)&&has(key[WEAK],this[UID])&&delete key[WEAK][this[UID]]:!1},has:function(key){return isObject(key)?isFrozen(key)?leakStore(this).has(key):has(key,WEAK)&&has(key[WEAK],this[UID]):!1}};WeakMap=getCollection(WeakMap,WEAKMAP,{get:function(key){if(isObject(key)){if(isFrozen(key))return leakStore(this).get(key);if(has(key,WEAK))return key[WEAK][this[UID]]}},set:function(key,value){return defWeak(this,key,value)}},weakMethods,!0,!0),framework&&7!=(new WeakMap).set(Object.freeze(tmp),7).get(tmp)&&forEach.call(array("delete,has,get,set"),function(key){var method=WeakMap[PROTOTYPE][key];WeakMap[PROTOTYPE][key]=function(a,b){if(isObject(a)&&isFrozen(a)){var result=leakStore(this)[key](a,b);return"set"==key?this:result}return method.call(this,a,b)}}),WeakSet=getCollection(WeakSet,WEAKSET,{add:function(value){return defWeak(this,value,!0)}},weakMethods,!1,!0)}(),!function(){function Enumerate(iterated){var key,keys=[];for(key in iterated)keys.push(key);set(this,ITER,{o:iterated,a:keys,i:0})}function wrap(fn){return function(it){assertObject(it);try{return fn.apply(undefined,arguments),!0}catch(e){return!1}}}function reflectGet(target,propertyKey){var proto,receiver=arguments.length<3?target:arguments[2],desc=getOwnDescriptor(assertObject(target),propertyKey);return desc?has(desc,"value")?desc.value:desc.get===undefined?undefined:desc.get.call(receiver):isObject(proto=getPrototypeOf(target))?reflectGet(proto,propertyKey,receiver):undefined}function reflectSet(target,propertyKey,V){var existingDescriptor,proto,receiver=arguments.length<4?target:arguments[3],ownDesc=getOwnDescriptor(assertObject(target),propertyKey);if(!ownDesc){if(isObject(proto=getPrototypeOf(target)))return reflectSet(proto,propertyKey,V,receiver);ownDesc=descriptor(0)}return has(ownDesc,"value")?ownDesc.writable!==!1&&isObject(receiver)?(existingDescriptor=getOwnDescriptor(receiver,propertyKey)||descriptor(0),existingDescriptor.value=V,defineProperty(receiver,propertyKey,existingDescriptor),!0):!1:ownDesc.set===undefined?!1:(ownDesc.set.call(receiver,V),!0)}createIterator(Enumerate,OBJECT,function(){var key,iter=this[ITER],keys=iter.a;do if(iter.i>=keys.length)return iterResult(1);while(!((key=keys[iter.i++])in iter.o));return iterResult(0,key)});var isExtensible=Object.isExtensible||returnIt,reflect={apply:ctx(call,apply,3),construct:function(target,argumentsList){var proto=assertFunction(arguments.length<3?target:arguments[2])[PROTOTYPE],instance=create(isObject(proto)?proto:ObjectProto),result=apply.call(target,instance,argumentsList);return isObject(result)?result:instance},defineProperty:wrap(defineProperty),deleteProperty:function(target,propertyKey){var desc=getOwnDescriptor(assertObject(target),propertyKey);return desc&&!desc.configurable?!1:delete target[propertyKey]},enumerate:function(target){return new Enumerate(assertObject(target))},get:reflectGet,getOwnPropertyDescriptor:function(target,propertyKey){return getOwnDescriptor(assertObject(target),propertyKey)},getPrototypeOf:function(target){return getPrototypeOf(assertObject(target))},has:function(target,propertyKey){return propertyKey in target},isExtensible:function(target){return!!isExtensible(assertObject(target))},ownKeys:ownKeys,preventExtensions:wrap(Object.preventExtensions||returnIt),set:reflectSet};setPrototypeOf&&(reflect.setPrototypeOf=function(target,proto){return setPrototypeOf(assertObject(target),proto),!0}),$define(GLOBAL,{Reflect:{}}),$define(STATIC,"Reflect",reflect)}(),!function(){function createObjectToArray(isEntries){return function(object){var key,O=toObject(object),keys=getKeys(object),length=keys.length,i=0,result=Array(length);if(isEntries)for(;length>i;)result[i]=[key=keys[i++],O[key]];else for(;length>i;)result[i]=O[keys[i++]];return result}}$define(PROTO,ARRAY,{includes:createArrayContains(!0)}),$define(PROTO,STRING,{at:createPointAt(!0)}),$define(STATIC,OBJECT,{getOwnPropertyDescriptors:function(object){var O=toObject(object),result={};return forEach.call(ownKeys(O),function(key){defineProperty(result,key,descriptor(0,getOwnDescriptor(O,key)))}),result},values:createObjectToArray(!1),entries:createObjectToArray(!0)}),$define(STATIC,REGEXP,{escape:createReplacer(/([\\\-[\]{}()*+?.,^$|])/g,"\\$1",!0)})}(),!function(REFERENCE){function setMapMethods(Constructor){if(Constructor){var MapProto=Constructor[PROTOTYPE];hidden(MapProto,REFERENCE_GET,MapProto.get),hidden(MapProto,REFERENCE_SET,MapProto.set),hidden(MapProto,REFERENCE_DELETE,MapProto["delete"])}}REFERENCE_GET=getWellKnownSymbol(REFERENCE+"Get",!0);var REFERENCE_SET=getWellKnownSymbol(REFERENCE+SET,!0),REFERENCE_DELETE=getWellKnownSymbol(REFERENCE+"Delete",!0);$define(STATIC,SYMBOL,{referenceGet:REFERENCE_GET,referenceSet:REFERENCE_SET,referenceDelete:REFERENCE_DELETE}),hidden(FunctionProto,REFERENCE_GET,returnThis),setMapMethods(Map),setMapMethods(WeakMap)}("reference"),!function(arrayStatics){function setArrayStatics(keys,length){forEach.call(array(keys),function(key){key in ArrayProto&&(arrayStatics[key]=ctx(call,ArrayProto[key],length))})}setArrayStatics("pop,reverse,shift,keys,values,entries",1),setArrayStatics("indexOf,every,some,forEach,map,filter,find,findIndex,includes",3),setArrayStatics("join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill,turn"),$define(STATIC,ARRAY,arrayStatics)}({}),!function(NodeList){!framework||!NodeList||SYMBOL_ITERATOR in NodeList[PROTOTYPE]||hidden(NodeList[PROTOTYPE],SYMBOL_ITERATOR,Iterators[ARRAY]),Iterators.NodeList=Iterators[ARRAY]}(global.NodeList)}("undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),!0)},{}],4:[function(require,module){(function(global){!function(global){"use strict";function wrap(innerFn,outerFn,self,tryLocsList){return new Generator(innerFn,outerFn,self||null,tryLocsList||[])}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function Generator(innerFn,outerFn,self,tryLocsList){function invoke(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted)return doneResult();for(;;){var delegate=context.delegate;if(delegate){var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if("throw"===record.type){context.delegate=null,method="throw",arg=record.arg;continue}method="next",arg=undefined;var info=record.arg;if(!info.done)return state=GenStateSuspendedYield,info;context[delegate.resultName]=info.value,context.next=delegate.nextLoc,context.delegate=null}if("next"===method){if(state===GenStateSuspendedStart&&"undefined"!=typeof arg)throw new TypeError("attempt to send "+JSON.stringify(arg)+" to newborn generator");state===GenStateSuspendedYield?context.sent=arg:delete context.sent}else if("throw"===method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,arg;context.dispatchException(arg)&&(method="next",arg=undefined)}else"return"===method&&context.abrupt("return",arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg!==ContinueSentinel)return info;context.delegate&&"next"===method&&(arg=undefined)}else"throw"===record.type&&(state=GenStateCompleted,"next"===method?context.dispatchException(record.arg):arg=record.arg)}}var generator=outerFn?Object.create(outerFn.prototype):this,context=new Context(tryLocsList),state=GenStateSuspendedStart;return generator.next=invoke.bind(generator,"next"),generator["throw"]=invoke.bind(generator,"throw"),generator["return"]=invoke.bind(generator,"return"),generator}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset()}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}var undefined,hasOwn=Object.prototype.hasOwnProperty,iteratorSymbol="function"==typeof Symbol&&Symbol.iterator||"@@iterator",inModule="object"==typeof module,runtime=global.regeneratorRuntime;if(runtime)return void(inModule&&(module.exports=runtime));runtime=global.regeneratorRuntime=inModule?module.exports:{},runtime.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={},Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName="GeneratorFunction",runtime.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return ctor?ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name):!1},runtime.mark=function(genFun){return genFun.__proto__=GeneratorFunctionPrototype,genFun.prototype=Object.create(Gp),genFun},runtime.async=function(innerFn,outerFn,self,tryLocsList){return new Promise(function(resolve,reject){function step(arg){var record=tryCatch(this,null,arg);if("throw"===record.type)return void reject(record.arg);var info=record.arg;info.done?resolve(info.value):Promise.resolve(info.value).then(callNext,callThrow)}var generator=wrap(innerFn,outerFn,self,tryLocsList),callNext=step.bind(generator.next),callThrow=step.bind(generator["throw"]);callNext()})},Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},runtime.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},runtime.values=values,Context.prototype={constructor:Context,reset:function(){this.prev=0,this.next=0,this.sent=undefined,this.done=!1,this.delegate=null,this.tryEntries.forEach(resetTryEntry);for(var tempName,tempIndex=0;hasOwn.call(this,tempName="t"+tempIndex)||20>tempIndex;++tempIndex)this[tempName]=null},stop:function(){this.done=!0;var rootEntry=this.tryEntries[0],rootRecord=rootEntry.completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,!!caught}if(this.done)throw exception;for(var context=this,i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?this.next=finallyEntry.finallyLoc:this.complete(record),ContinueSentinel},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=record.arg,this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc)}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},ContinueSentinel}}}("object"==typeof global?global:"object"==typeof window?window:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(require,module){module.exports=require("./lib/babel/polyfill")},{"./lib/babel/polyfill":2}],6:[function(){},{}],7:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;length>i;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return 0>start&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:8}],8:[function(require,module){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],9:[function(require,module){!function(){"use strict";function resolveDefs(c,block,def){return("string"==typeof block?block:block.toString()).replace(c.define||skip,function(m,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?(c.defineParams&&value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}}),code in def||(def[code]=value)):new Function("def","def['"+code+"']="+value)(def)),""}).replace(c.use||skip,function(m,code){c.useParams&&(code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");return def.__exp=def.__exp||{},def.__exp[rw]=def[d].text.replace(new RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2"),s+"def.__exp['"+rw+"']"}}));var v=new Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var _globals,doT={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};doT.encodeHTMLSource=function(doNotSkipEncoded){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=doNotSkipEncoded?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(code){return code?code.toString().replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):""}},_globals=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):_globals.doT=doT;var startend={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},skip=/$^/;doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var needhtmlencode,indv,cse=c.append?startend.append:startend.split,sid=0,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){return needhtmlencode=!0,cse.startencode+unescape(code)+cse.end}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='":code?"';if("+unescape(code)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(m,iterate,vname,iname){return iterate?(sid+=1,indv=iname||"i"+sid,iterate=unescape(iterate),"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),needhtmlencode&&(c.selfcontained||!_globals||_globals._encodeHTML||(_globals._encodeHTML=doT.encodeHTMLSource(c.doNotSkipEncoded)),str="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+doT.encodeHTMLSource.toString()+"("+(c.doNotSkipEncoded||"")+"));"+str);try{return new Function(c.varname,str)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),e}},doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}}()},{}],10:[function(require,module){function InstallDots(o){this.__path=o.path||"./","/"!==this.__path[this.__path.length-1]&&(this.__path+="/"),this.__destination=o.destination||this.__path,"/"!==this.__destination[this.__destination.length-1]&&(this.__destination+="/"),this.__global=o.global||"window.render",this.__rendermodule=o.rendermodule||{},this.__settings=o.templateSettings?copy(o.templateSettings,copy(doT.templateSettings)):void 0,this.__includes={}}function addexports(exports){for(var ret="",i=0;i<exports.length;i++)ret+="itself."+exports[i]+"="+exports[i]+";";return ret}function copy(o,to){to=to||{};for(var property in o)to[property]=o[property];return to}function readdata(path){var data=fs.readFileSync(path);return data?data.toString():void console.log("problems with "+path)}var fs=require("fs"),doT=module.exports=require("./doT");doT.process=function(options){return new InstallDots(options).compileAll()},InstallDots.prototype.compileToFile=function(path,template,def){def=def||{};var fn,modulename=path.substring(path.lastIndexOf("/")+1,path.lastIndexOf(".")),defs=copy(this.__includes,copy(def)),settings=this.__settings||doT.templateSettings,compileoptions=copy(settings),defaultcompiled=doT.template(template,settings,defs),exports=[],compiled="";for(var property in defs)defs[property]!==def[property]&&defs[property]!==this.__includes[property]&&(fn=void 0,"string"==typeof defs[property]?fn=doT.template(defs[property],settings,defs):"function"==typeof defs[property]?fn=defs[property]:defs[property].arg&&(compileoptions.varname=defs[property].arg,fn=doT.template(defs[property].text,compileoptions,defs)),fn&&(compiled+=fn.toString().replace("anonymous",property),exports.push(property)));compiled+=defaultcompiled.toString().replace("anonymous",modulename),fs.writeFileSync(path,"(function(){"+compiled+"var itself="+modulename+", _encodeHTML=("+doT.encodeHTMLSource.toString()+"("+(settings.doNotSkipEncoded||"")+"));"+addexports(exports)+"if(typeof module!=='undefined' && module.exports) module.exports=itself;else if(typeof define==='function')define(function(){return itself;});else {"+this.__global+"="+this.__global+"||{};"+this.__global+"['"+modulename+"']=itself;}}());")},InstallDots.prototype.compilePath=function(path){var data=readdata(path);return data?doT.template(data,this.__settings||doT.templateSettings,copy(this.__includes)):void 0},InstallDots.prototype.compileAll=function(){console.log("Compiling all doT templates...");var k,l,name,defFolder=this.__path,sources=fs.readdirSync(defFolder);for(k=0,l=sources.length;l>k;k++)name=sources[k],/\.def(\.dot|\.jst)?$/.test(name)&&(console.log("Loaded def "+name),this.__includes[name.substring(0,name.indexOf("."))]=readdata(defFolder+name));for(k=0,l=sources.length;l>k;k++)name=sources[k],/\.dot(\.def|\.jst)?$/.test(name)&&(console.log("Compiling "+name+" to function"),this.__rendermodule[name.substring(0,name.indexOf("."))]=this.compilePath(defFolder+name)),/\.jst(\.dot|\.def)?$/.test(name)&&(console.log("Compiling "+name+" to file"),this.compileToFile(this.__destination+name.substring(0,name.indexOf("."))+".js",readdata(defFolder+name)));return this.__rendermodule}},{"./doT":9,fs:6}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var RenderType={IMAGE:"image",DATAURL:"data-url"};exports.RenderType=RenderType;var ImageFormat={PNG:"image/png",JPEG:"image/jpeg"};exports.ImageFormat=ImageFormat},{}],12:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")};require("babel/polyfill");var _=_interopRequire(require("lodash")),RenderImage=_interopRequire(require("./lib/render-image")),ImageExporter=_interopRequire(require("./lib/image-exporter")),_constants=require("./constants"),RenderType=_constants.RenderType,ImageFormat=_constants.ImageFormat,Utils=_interopRequire(require("./lib/utils")),ImglyKit=function(){function ImglyKit(options){if(_classCallCheck(this,ImglyKit),"undefined"==typeof options)throw new Error("No options given.");if(options=_.defaults(options,{assetsUrl:"assets",container:null,renderOnWindowResize:!1}),options.ui=options.ui||{},options.ui=_.defaults(options.ui,{enabled:!0}),"undefined"==typeof options.image&&!options.ui.enabled)throw new Error("`options.image` needs to be set when UI is disabled.");this._options=options,this.operationsStack=[],this._registeredUIs={},this._registerUIs(),this._registeredOperations={},this._registerOperations(),this._options.ui.enabled&&(this._initUI(),this._options.renderOnWindowResize&&this._handleWindowResize())}return _createClass(ImglyKit,{render:{value:function(renderType,imageFormat,dimensions){var settings=ImageExporter.validateSettings(renderType,imageFormat);renderType=settings.renderType,imageFormat=settings.imageFormat;var renderImage=new RenderImage(this._options.image,this.operationsStack,dimensions,this._options.renderer),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.operationsStack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&(operation.dirty=!0)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return renderImage.render().then(function(){var canvas=renderImage.getRenderer().getCanvas();return ImageExporter["export"](canvas,renderType,imageFormat)})}},reset:{value:function(){}},getAssetPath:{value:function(asset){var isBrowser="undefined"!=typeof window;if(isBrowser)return this._options.assetsUrl+"/"+asset;var path=require("path");return path.resolve(this._options.assetsUrl,asset)}},_handleWindowResize:{value:function(){var _this=this,timer=null;window.addEventListener("resize",function(){null!==timer&&clearTimeout(timer),timer=setTimeout(function(){timer=null,_this.ui.render()},300)})}},_registerUIs:{value:function(){this.registerUI(ImglyKit.NightUI)}},_registerOperations:{value:function(){for(var operationName in ImglyKit.Operations)this.registerOperation(ImglyKit.Operations[operationName])}},registerOperation:{value:function(operation){this._registeredOperations[operation.prototype.identifier]=operation,this.ui&&this.ui.addOperation(operation)}},registerUI:{value:function(ui){this._registeredUIs[ui.prototype.identifier]=ui}},_initUI:{value:function(){var UI;this._options.ui.enabled===!0&&(UI=Utils.values(this._registeredUIs)[0]),UI&&(this.ui=new UI(this,this._options))}},getOperationFromStack:{value:function(identifier){var operation=this.operationsStack.filter(function(operation){return operation.identifier===identifier})[0];return operation}},run:{value:function(){"undefined"!=typeof this.ui&&this.ui.run()}},registeredOperations:{get:function(){return this._registeredOperations}}}),ImglyKit}();ImglyKit.version="2.0.0-beta6",ImglyKit.RenderImage=RenderImage,ImglyKit.Color=require("./lib/color"),ImglyKit.Filter=require("./operations/filters/filter"),ImglyKit.Operation=require("./operations/operation"),ImglyKit.Operations={},ImglyKit.Operations.Filters=require("./operations/filters-operation"),ImglyKit.Operations.Crop=require("./operations/crop-operation"),ImglyKit.Operations.Rotation=require("./operations/rotation-operation"),ImglyKit.Operations.Saturation=require("./operations/saturation-operation"),ImglyKit.Operations.Contrast=require("./operations/contrast-operation"),ImglyKit.Operations.Brightness=require("./operations/brightness-operation"),ImglyKit.Operations.Flip=require("./operations/flip-operation"),ImglyKit.Operations.TiltShift=require("./operations/tilt-shift-operation"),ImglyKit.Operations.RadialBlur=require("./operations/radial-blur-operation"),ImglyKit.Operations.Text=require("./operations/text-operation"),ImglyKit.Operations.Stickers=require("./operations/stickers-operation"),ImglyKit.Operations.Frames=require("./operations/frames-operation"),ImglyKit.Filters={},ImglyKit.Filters.A15=require("./operations/filters/a15-filter"),ImglyKit.Filters.Breeze=require("./operations/filters/breeze-filter"),ImglyKit.Filters.BW=require("./operations/filters/bw-filter"),ImglyKit.Filters.BWHard=require("./operations/filters/bwhard-filter"),ImglyKit.Filters.Celsius=require("./operations/filters/celsius-filter"),ImglyKit.Filters.Chest=require("./operations/filters/chest-filter"),
ImglyKit.Filters.Fixie=require("./operations/filters/fixie-filter"),ImglyKit.Filters.Food=require("./operations/filters/food-filter"),ImglyKit.Filters.Fridge=require("./operations/filters/fridge-filter"),ImglyKit.Filters.Front=require("./operations/filters/front-filter"),ImglyKit.Filters.Glam=require("./operations/filters/glam-filter"),ImglyKit.Filters.Gobblin=require("./operations/filters/gobblin-filter"),ImglyKit.Filters.K1=require("./operations/filters/k1-filter"),ImglyKit.Filters.K2=require("./operations/filters/k2-filter"),ImglyKit.Filters.K6=require("./operations/filters/k6-filter"),ImglyKit.Filters.KDynamic=require("./operations/filters/kdynamic-filter"),ImglyKit.Filters.Lenin=require("./operations/filters/lenin-filter"),ImglyKit.Filters.Lomo=require("./operations/filters/lomo-filter"),ImglyKit.Filters.Mellow=require("./operations/filters/mellow-filter"),ImglyKit.Filters.Morning=require("./operations/filters/morning-filter"),ImglyKit.Filters.Orchid=require("./operations/filters/orchid-filter"),ImglyKit.Filters.Pola=require("./operations/filters/pola-filter"),ImglyKit.Filters.Pola669=require("./operations/filters/pola669-filter"),ImglyKit.Filters.Quozi=require("./operations/filters/quozi-filter"),ImglyKit.Filters.Semired=require("./operations/filters/semired-filter"),ImglyKit.Filters.Sunny=require("./operations/filters/sunny-filter"),ImglyKit.Filters.Texas=require("./operations/filters/texas-filter"),ImglyKit.Filters.X400=require("./operations/filters/x400-filter"),ImglyKit.RenderType=RenderType,ImglyKit.ImageFormat=ImageFormat,ImglyKit.Vector2=require("./lib/math/vector2"),ImglyKit.NightUI=require("./ui/night/ui"),module.exports=ImglyKit},{"./constants":11,"./lib/color":13,"./lib/image-exporter":17,"./lib/math/vector2":18,"./lib/render-image":19,"./lib/utils":20,"./operations/brightness-operation":21,"./operations/contrast-operation":22,"./operations/crop-operation":23,"./operations/filters-operation":24,"./operations/filters/a15-filter":25,"./operations/filters/breeze-filter":26,"./operations/filters/bw-filter":27,"./operations/filters/bwhard-filter":28,"./operations/filters/celsius-filter":29,"./operations/filters/chest-filter":30,"./operations/filters/filter":31,"./operations/filters/fixie-filter":32,"./operations/filters/food-filter":33,"./operations/filters/fridge-filter":34,"./operations/filters/front-filter":35,"./operations/filters/glam-filter":36,"./operations/filters/gobblin-filter":37,"./operations/filters/k1-filter":39,"./operations/filters/k2-filter":40,"./operations/filters/k6-filter":41,"./operations/filters/kdynamic-filter":42,"./operations/filters/lenin-filter":43,"./operations/filters/lomo-filter":44,"./operations/filters/mellow-filter":45,"./operations/filters/morning-filter":46,"./operations/filters/orchid-filter":47,"./operations/filters/pola-filter":48,"./operations/filters/pola669-filter":49,"./operations/filters/quozi-filter":63,"./operations/filters/semired-filter":64,"./operations/filters/sunny-filter":65,"./operations/filters/texas-filter":66,"./operations/filters/x400-filter":67,"./operations/flip-operation":68,"./operations/frames-operation":69,"./operations/operation":70,"./operations/radial-blur-operation":71,"./operations/rotation-operation":72,"./operations/saturation-operation":73,"./operations/stickers-operation":74,"./operations/text-operation":75,"./operations/tilt-shift-operation":76,"./ui/night/ui":102,"babel/polyfill":5,lodash:"lodash",path:7}],13:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Color=function(){function Color(r,g,b,a){_classCallCheck(this,Color),"undefined"==typeof a&&(a=1),this.r=r,this.g=g,this.b=b,this.a=a}return _createClass(Color,{toRGBA:{value:function(){var colors=[Math.round(255*this.r),Math.round(255*this.g),Math.round(255*this.b),this.a];return"rgba("+colors.join(",")+")"}},toHex:{value:function(){var components=[this._componentToHex(Math.round(255*this.r)),this._componentToHex(Math.round(255*this.g)),this._componentToHex(Math.round(255*this.b))];return"#"+components.join("")}},toGLColor:{value:function(){return[this.r,this.g,this.b,this.a]}},toRGBGLColor:{value:function(){return[this.r,this.g,this.b]}},toHSV:{value:function(){var max=Math.max(this.r,this.g,this.b),min=Math.min(this.r,this.g,this.b),h=void 0,s=void 0,v=max,d=max-min;if(s=0===max?0:d/max,max===min)h=0;else{switch(max){case this.r:h=(this.g-this.b)/d+(this.g<this.b?6:0);break;case this.g:h=(this.b-this.r)/d+2;break;case this.b:h=(this.r-this.g)/d+4}h/=6}return[h,s,v]}},fromHSV:{value:function(h,s,v){var _ref=this,r=_ref.r,g=_ref.g,b=_ref.b,i=Math.floor(6*h),f=6*h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}this.r=r,this.g=g,this.b=b}},clone:{value:function(){return new Color(this.r,this.g,this.b,this.a)}},_componentToHex:{value:function(component){var hex=component.toString(16);return 1===hex.length?"0"+hex:hex}},toString:{value:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"}}}),Color}();module.exports=Color},{}],14:[function(require,module){"use strict";function error(message){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];console.error.apply(console,[message].concat(args)),console.trace()}var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},DEFAULT_MAX_LISTENERS=12,EventEmitter=function(){function EventEmitter(){_classCallCheck(this,EventEmitter),this._maxListeners=DEFAULT_MAX_LISTENERS,this._events={}}return _createClass(EventEmitter,{on:{value:function(type,listener){if("function"!=typeof listener)throw new TypeError;var listeners=this._events[type]||(this._events[type]=[]);return-1!==listeners.indexOf(listener)?this:(listeners.push(listener),listeners.length>this._maxListeners&&error("possible memory leak, added %i %s listeners,\n        use EventEmitter#setMaxListeners(number) if you\n        want to increase the limit (%i now)",listeners.length,type,this._maxListeners),this)}},once:{value:function(type,listener){function onceCallback(){eventsInstance.off(type,onceCallback),listener.apply(null,arguments)}var eventsInstance=this;return this.on(type,onceCallback)}},off:{value:function(type){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];if(0===args.length)return this._events[type]=null,this;var listener=args[0];if("function"!=typeof listener)throw new TypeError;var listeners=this._events[type];if(!listeners||!listeners.length)return this;var indexOfListener=listeners.indexOf(listener);return-1===indexOfListener?this:(listeners.splice(indexOfListener,1),this)}},emit:{value:function(type){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];var listeners=this._events[type];return listeners&&listeners.length?(listeners.forEach(function(fn){return fn.apply(null,args)}),!0):!1}},setMaxListeners:{value:function(newMaxListeners){if(parseInt(newMaxListeners,10)!==newMaxListeners)throw new TypeError;this._maxListeners=newMaxListeners}}}),EventEmitter}();module.exports=EventEmitter},{}],15:[function(require,module){"use strict";module.exports=function(prototypeProperties,classProperties){var child,parent=this;child=prototypeProperties&&prototypeProperties.hasOwnProperty("constructor")?prototypeProperties.constructor:function(){return parent.apply(this,arguments)};var key;for(key in parent)child[key]=parent[key];if("undefined"!=typeof classProperties)for(key in classProperties)child[key]=classProperties[key];var Surrogate=function(){this.constructor=child};if(Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,prototypeProperties)for(key in prototypeProperties)child.prototype[key]=prototypeProperties[key];return child.__super__=parent.prototype,child}},{}],16:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},ImageDimensions=function(){function ImageDimensions(dimensions){_classCallCheck(this,ImageDimensions),this._modifiers={FIXED:"!"},this._dimensionsString=dimensions,this._rules=this._parse(),this._validateRules()}return _createClass(ImageDimensions,{_parse:{value:function(){if("undefined"==typeof this._dimensionsString)return null;var match=this._dimensionsString.match(/^([0-9]+)?x([0-9]+)?([\!])?$/i);if(!match)throw new Error("Invalid size option: "+this._dimensionsString);return{x:isNaN(match[1])?null:parseInt(match[1]),y:isNaN(match[2])?null:parseInt(match[2]),modifier:match[3]}}},_validateRules:{value:function(){if(null!==this._rules){var xAvailable=null!==this._rules.x,yAvailable=null!==this._rules.y;if(!(this._rules.modifier!==this._modifiers.FIXED||xAvailable&&yAvailable))throw new Error("Both `x` and `y` have to be set when using the fixed (!) modifier.");if(!xAvailable&&!yAvailable)throw new Error("Neither `x` nor `y` are given.")}}},calculateFinalDimensions:{value:function(initialDimensions){var ratio,dimensions=initialDimensions.clone();return null===this._rules?dimensions:(this._rules.modifier===this._modifiers.FIXED?dimensions.set(this._rules.x,this._rules.y):null!==this._rules.x&&null!==this._rules.y?(ratio=Math.min(this._rules.x/dimensions.x,this._rules.y/dimensions.y),dimensions.multiply(ratio)):null!==this._rules.x?(ratio=initialDimensions.y/initialDimensions.x,dimensions.x=this._rules.x,dimensions.y=dimensions.x*ratio):null!==this._rules.y&&(ratio=initialDimensions.x/initialDimensions.y,dimensions.y=this._rules.y,dimensions.x=dimensions.y*ratio),dimensions)}}}),ImageDimensions}();module.exports=ImageDimensions},{}],17:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_constants=require("../constants"),RenderType=_constants.RenderType,ImageFormat=_constants.ImageFormat,Utils=_interopRequire(require("./utils")),ImageExporter=function(){function ImageExporter(){_classCallCheck(this,ImageExporter)}return _createClass(ImageExporter,null,{validateSettings:{value:function(renderType,imageFormat){var settings={renderType:renderType,imageFormat:imageFormat};if("undefined"!=typeof settings.renderType&&null!==settings.renderType&&-1===Utils.values(RenderType).indexOf(settings.renderType))throw new Error("Invalid render type: "+settings.renderType);if("undefined"==typeof renderType&&(settings.renderType=RenderType.DATA_URL),"undefined"!=typeof settings.imageFormat&&null!==settings.imageFormat&&-1===Utils.values(ImageFormat).indexOf(settings.imageFormat))throw new Error("Invalid image format: "+settings.imageFormat);return"undefined"==typeof imageFormat&&(settings.imageFormat=ImageFormat.PNG),settings}},"export":{value:function(canvas,renderType,imageFormat){var result=canvas.toDataURL(imageFormat);if(renderType==RenderType.IMAGE){var image;if("undefined"==typeof window){var CanvasImage=require("canvas").Image;image=new CanvasImage}else image=new Image;image.src=result,result=image}return result}}}),ImageExporter}();module.exports=ImageExporter},{"../constants":11,"./utils":20,canvas:"canvas"}],18:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=function(){function Vector2(x,y){_classCallCheck(this,Vector2),this.x=x,this.y=y,"undefined"==typeof this.x&&(this.x=0),"undefined"==typeof this.y&&(this.y=0)}return _createClass(Vector2,{set:{value:function(x,y){return this.x=x,this.y=y,this}},clone:{value:function(){return new Vector2(this.x,this.y)}},copy:{value:function(other){return this.x=other.x,this.y=other.y,this}},clamp:{value:function(minimum,maximum){var minimumSet=null!==minimum&&"undefined"!=typeof minimum,maximumSet=null!==maximum&&"undefined"!=typeof maximum;return minimum instanceof Vector2||!minimumSet||(minimum=new Vector2(minimum,minimum)),maximum instanceof Vector2||!maximumSet||(maximum=new Vector2(maximum,maximum)),minimumSet&&(this.x=Math.max(minimum.x,this.x),this.y=Math.max(minimum.y,this.y)),maximumSet&&(this.x=Math.min(maximum.x,this.x),this.y=Math.min(maximum.y,this.y)),this}},divide:{value:function(divisor,y){return divisor instanceof Vector2?(this.x/=divisor.x,this.y/=divisor.y):(this.x/=divisor,this.y/="undefined"==typeof y?divisor:y),this}},subtract:{value:function(subtrahend,y){return subtrahend instanceof Vector2?(this.x-=subtrahend.x,this.y-=subtrahend.y):(this.x-=subtrahend,this.y-="undefined"==typeof y?subtrahend:y),this}},multiply:{value:function(factor,y){return factor instanceof Vector2?(this.x*=factor.x,this.y*=factor.y):(this.x*=factor,this.y*="undefined"==typeof y?factor:y),this}},add:{value:function(addend,y){return addend instanceof Vector2?(this.x+=addend.x,this.y+=addend.y):(this.x+=addend,this.y+="undefined"==typeof y?addend:y),this}},equals:{value:function(vec,y){return vec instanceof Vector2?vec.x===this.x&&vec.y===this.y:vec===this.x&&y===this.y}},flip:{value:function(){var tempX=this.x;return this.x=this.y,this.y=tempX,this}},toString:{value:function(){return"Vector2({ x: "+this.x+", y: "+this.y+" })"}}}),Vector2}();module.exports=Vector2},{}],19:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},ImageDimensions=_interopRequire(require("./image-dimensions")),Vector2=_interopRequire(require("./math/vector2")),CanvasRenderer=_interopRequire(require("../renderers/canvas-renderer")),WebGLRenderer=_interopRequire(require("../renderers/webgl-renderer")),RenderImage=function(){function RenderImage(image,operationsStack,dimensions,preferredRenderer){_classCallCheck(this,RenderImage),this._options={preferredRenderer:preferredRenderer},this._webglEnabled=!1,this._renderer=null,this._image=image,this._stack=operationsStack,this._dimensions=new ImageDimensions(dimensions),this._initialDimensions=new Vector2(this._image.width,this._image.height),this._initRenderer()}return _createClass(RenderImage,{_initRenderer:{value:function(){if(WebGLRenderer.isSupported()&&"canvas"!==this._options.preferredRenderer?(this._renderer=new WebGLRenderer(this._initialDimensions),this._webglEnabled=!0):CanvasRenderer.isSupported()&&(this._renderer=new CanvasRenderer(this._initialDimensions),this._webglEnabled=!1),null===this._renderer)throw new Error("Neither Canvas nor WebGL renderer are supported.");this._renderer.drawImage(this._image)}},render:{value:function(){var _this=this,stack=this.sanitizedStack,validationPromises=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=stack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;validationPromises.push(operation.validateSettings())}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return Promise.all(validationPromises).then(function(){var promises=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=stack[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var operation=_step2.value;promises.push(operation.render(_this._renderer))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return Promise.all(promises)}).then(function(){return _this._renderer.renderFinal()}).then(function(){var initialSize=_this._renderer.getSize(),finalDimensions=_this._dimensions.calculateFinalDimensions(initialSize);return finalDimensions.equals(initialSize)?void 0:_this._renderer.resizeTo(finalDimensions)})}},getRenderer:{value:function(){return this._renderer}},sanitizedStack:{get:function(){var sanitizedStack=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._stack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&sanitizedStack.push(operation)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return sanitizedStack}}}),RenderImage}();module.exports=RenderImage},{"../renderers/canvas-renderer":77,"../renderers/webgl-renderer":79,"./image-dimensions":16,"./math/vector2":18}],20:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=_interopRequire(require("./math/vector2")),Utils=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,null,{isArray:{value:function(object){return"[object Array]"===Object.prototype.toString.call(object)}},select:{value:function(items){var selector=void 0===arguments[1]?null:arguments[1];if(null===selector)return items;if("string"==typeof selector&&(selector=selector.split(",").map(function(identifier){return identifier.trim()})),Utils.isArray(selector)&&(selector={only:selector}),"undefined"!=typeof selector.only)return"string"==typeof selector.only&&(selector.only=selector.only.split(",").map(function(identifier){return identifier.trim()})),items.filter(function(item){return-1!==selector.only.indexOf(item)});if("undefined"!=typeof selector.except)return"string"==typeof selector.except&&(selector.except=selector.except.split(",").map(function(identifier){return identifier.trim()})),items.filter(function(item){return-1===selector.except.indexOf(item)});throw new Error("Utils#select failed to filter items.")}},values:{value:function(_values){var _valuesWrapper=function(){return _values.apply(this,arguments)};return _valuesWrapper.toString=function(){return _values.toString()},_valuesWrapper}(function(object){var values=[];for(var key in object)values.push(object[key]);return values})},isDOMElement:{value:function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName}},getEventPosition:{value:function(e){var x=e.pageX,y=e.pageY;return-1!==e.type.indexOf("touch")&&(x=e.touches[0].pageX,y=e.touches[0].pageY),new Vector2(x,y)}}}),Utils}();module.exports=Utils},{"./math/vector2":18}],21:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),BrightnessPrimitive=_interopRequire(require("./filters/primitives/brightness")),BrightnessOperation=function(_Operation){function BrightnessOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,BrightnessOperation),this.availableOptions={brightness:{type:"number","default":0}},_get(Object.getPrototypeOf(BrightnessOperation.prototype),"constructor",this).apply(this,args)}return _inherits(BrightnessOperation,_Operation),_createClass(BrightnessOperation,{_renderWebGL:{value:function(renderer){this._render(renderer)}},_renderCanvas:{value:function(renderer){this._render(renderer)}},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new BrightnessPrimitive({brightness:this._options.brightness})),stack.render(renderer)}}}),BrightnessOperation}(Operation);BrightnessOperation.prototype.identifier="brightness",module.exports=BrightnessOperation},{"./filters/primitives-stack":50,"./filters/primitives/brightness":51,"./operation":70}],22:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),ContrastPrimitive=_interopRequire(require("./filters/primitives/contrast")),ContrastOperation=function(_Operation){function ContrastOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,ContrastOperation),this.availableOptions={contrast:{type:"number","default":1}},_get(Object.getPrototypeOf(ContrastOperation.prototype),"constructor",this).apply(this,args)}return _inherits(ContrastOperation,_Operation),_createClass(ContrastOperation,{_renderWebGL:{value:function(renderer){this._render(renderer)}},_renderCanvas:{value:function(renderer){this._render(renderer)}},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new ContrastPrimitive({contrast:this._options.contrast})),stack.render(renderer)}}}),ContrastOperation}(Operation);ContrastOperation.prototype.identifier="contrast",module.exports=ContrastOperation},{"./filters/primitives-stack":50,"./filters/primitives/contrast":52,"./operation":70}],23:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),CropOperation=function(_Operation){function CropOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,CropOperation),this.availableOptions={start:{type:"vector2",required:!0,"default":new Vector2(0,0)},end:{type:"vector2",required:!0,"default":new Vector2(1,1)}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n      uniform vec2 u_cropStart;\n      uniform vec2 u_cropEnd;\n\n      void main() {\n        vec2 size = u_cropEnd - u_cropStart;\n        gl_FragColor = texture2D(u_image, v_texCoord * size + u_cropStart);\n      }\n    ",_get(Object.getPrototypeOf(CropOperation.prototype),"constructor",this).apply(this,args)}return _inherits(CropOperation,_Operation),_createClass(CropOperation,{_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),start=this._options.start.clone(),end=this._options.end.clone();"absolute"===this._options.numberFormat&&(start.divide(canvasSize),end.divide(canvasSize));var originalStartY=start.y;start.y=1-end.y,end.y=1-originalStartY;var newDimensions=this.getNewDimensions(renderer);canvas.width=newDimensions.x,canvas.height=newDimensions.y,renderer.runShader(null,this.fragmentShader,{uniforms:{u_cropStart:{type:"2f",value:[start.x,start.y]},u_cropEnd:{type:"2f",value:[end.x,end.y]}}})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),dimensions=new Vector2(canvas.width,canvas.height),newDimensions=this.getNewDimensions(renderer),newCanvas=renderer.createCanvas();newCanvas.width=newDimensions.x,newCanvas.height=newDimensions.y;var newContext=newCanvas.getContext("2d"),startPosition=this._options.start.clone();"relative"===this._options.numberFormat&&startPosition.multiply(dimensions),newContext.drawImage(canvas,startPosition.x,startPosition.y,newDimensions.x,newDimensions.y,0,0,newDimensions.x,newDimensions.y),renderer.setCanvas(newCanvas)}},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();dimensions=dimensions||new Vector2(canvas.width,canvas.height);var newDimensions=this._options.end.clone().subtract(this._options.start);return"relative"===this._options.numberFormat&&newDimensions.multiply(dimensions),newDimensions}}}),CropOperation}(Operation);CropOperation.prototype.identifier="crop",module.exports=CropOperation},{"../lib/math/vector2":18,"./operation":70}],24:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);

subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),IdentityFilter=_interopRequire(require("./filters/identity-filter")),FiltersOperation=function(_Operation){function FiltersOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FiltersOperation),this.availableOptions={filter:{type:"object","default":IdentityFilter,setter:function(Filter){return this._selectedFilter=new Filter,Filter}}},_get(Object.getPrototypeOf(FiltersOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FiltersOperation,_Operation),_createClass(FiltersOperation,{_renderWebGL:{value:function(renderer){this._render(renderer)}},_renderCanvas:{value:function(renderer){this._render(renderer)}},_render:{value:function(renderer){this._selectedFilter.render(renderer)}}}),FiltersOperation}(Operation);FiltersOperation.prototype.identifier="filters",module.exports=FiltersOperation},{"./filters/identity-filter":38,"./operation":70}],25:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),A15Filter=function(_Filter){function A15Filter(){_classCallCheck(this,A15Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(A15Filter,_Filter),_createClass(A15Filter,{name:{get:function(){return"15"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Contrast({contrast:.63})),stack.add(new Filter.Primitives.Brightness({brightness:.12})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,38],[94,94],[148,142],[175,187],[255,255]],green:[[0,0],[77,53],[171,190],[255,255]],blue:[[0,10],[48,85],[174,228],[255,255]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"a15"}}}),A15Filter}(Filter);module.exports=A15Filter},{"./filter":31}],26:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BreezeFilter=function(_Filter){function BreezeFilter(){_classCallCheck(this,BreezeFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(BreezeFilter,_Filter),_createClass(BreezeFilter,{name:{get:function(){return"Breeze"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.5})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[170,170],[212,219],[234,242],[255,255]],green:[[0,0],[170,168],[234,231],[255,255]],blue:[[0,0],[170,170],[212,208],[255,255]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"breeze"}}}),BreezeFilter}(Filter);module.exports=BreezeFilter},{"./filter":31}],27:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BWFilter=function(_Filter){function BWFilter(){_classCallCheck(this,BWFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(BWFilter,_Filter),_createClass(BWFilter,{name:{get:function(){return"B&W"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Grayscale),stack.render(renderer)}}},{identifier:{get:function(){return"bw"}}}),BWFilter}(Filter);module.exports=BWFilter},{"./filter":31}],28:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),BWHardFilter=function(_Filter){function BWHardFilter(){_classCallCheck(this,BWHardFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(BWHardFilter,_Filter),_createClass(BWHardFilter,{name:{get:function(){return"1920"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Grayscale),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)}}},{identifier:{get:function(){return"bwhard"}}}),BWHardFilter}(Filter);module.exports=BWHardFilter},{"./filter":31}],29:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),CelsiusFilter=function(_Filter){function CelsiusFilter(){_classCallCheck(this,CelsiusFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(CelsiusFilter,_Filter),_createClass(CelsiusFilter,{name:{get:function(){return"Celsius"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,69],[55,110],[202,230],[255,255]],green:[[0,44],[89,93],[185,141],[255,189]],blue:[[0,76],[39,82],[218,138],[255,171]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"celsius"}}}),CelsiusFilter}(Filter);module.exports=CelsiusFilter},{"./filter":31}],30:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),ChestFilter=function(_Filter){function ChestFilter(){_classCallCheck(this,ChestFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(ChestFilter,_Filter),_createClass(ChestFilter,{name:{get:function(){return"Chest"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[44,44],[124,143],[221,204],[255,255]],green:[[0,0],[130,127],[213,199],[255,255]],blue:[[0,0],[51,52],[219,204],[255,255]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"chest"}}}),ChestFilter}(Filter);module.exports=ChestFilter},{"./filter":31}],31:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=function(){function Filter(){_classCallCheck(this,Filter)}return _createClass(Filter,{render:{value:function(){throw new Error("Filter#render is abstract and not implemented in inherited class.")}}},{identifier:{get:function(){return null}}}),Filter}();Filter.extend=require("../../lib/extend"),Filter.PrimitivesStack=require("./primitives-stack"),Filter.Primitives={},Filter.Primitives.Saturation=require("./primitives/saturation"),Filter.Primitives.LookupTable=require("./primitives/lookup-table"),Filter.Primitives.ToneCurve=require("./primitives/tone-curve"),Filter.Primitives.SoftColorOverlay=require("./primitives/soft-color-overlay"),Filter.Primitives.Desaturation=require("./primitives/desaturation"),Filter.Primitives.X400=require("./primitives/x400"),Filter.Primitives.Grayscale=require("./primitives/grayscale"),Filter.Primitives.Contrast=require("./primitives/contrast"),Filter.Primitives.Glow=require("./primitives/glow"),Filter.Primitives.Gobblin=require("./primitives/gobblin"),Filter.Primitives.Brightness=require("./primitives/brightness"),module.exports=Filter},{"../../lib/extend":15,"./primitives-stack":50,"./primitives/brightness":51,"./primitives/contrast":52,"./primitives/desaturation":53,"./primitives/glow":54,"./primitives/gobblin":55,"./primitives/grayscale":56,"./primitives/lookup-table":57,"./primitives/saturation":59,"./primitives/soft-color-overlay":60,"./primitives/tone-curve":61,"./primitives/x400":62}],32:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FixieFilter=function(_Filter){function FixieFilter(){_classCallCheck(this,FixieFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(FixieFilter,_Filter),_createClass(FixieFilter,{name:{get:function(){return"Fixie"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[44,28],[63,48],[128,132],[235,248],[255,255]],green:[[0,0],[20,10],[60,45],[190,209],[211,231],[255,255]],blue:[[0,31],[41,62],[150,142],[234,212],[255,224]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"fixie"}}}),FixieFilter}(Filter);module.exports=FixieFilter},{"./filter":31}],33:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FoodFilter=function(_Filter){function FoodFilter(){_classCallCheck(this,FoodFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(FoodFilter,_Filter),_createClass(FoodFilter,{name:{get:function(){return"Food"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Saturation({saturation:1.35})),stack.add(new Filter.Primitives.Contrast({contrast:1.1})),stack.render(renderer)}}},{identifier:{get:function(){return"food"}}}),FoodFilter}(Filter);module.exports=FoodFilter},{"./filter":31}],34:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FridgeFilter=function(_Filter){function FridgeFilter(){_classCallCheck(this,FridgeFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(FridgeFilter,_Filter),_createClass(FridgeFilter,{name:{get:function(){return"Fridge"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,9],[21,11],[45,24],[255,220]],green:[[0,12],[21,21],[42,42],[150,150],[170,173],[255,210]],blue:[[0,28],[43,72],[128,185],[255,220]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"fridge"}}}),FridgeFilter}(Filter);module.exports=FridgeFilter},{"./filter":31}],35:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),FrontFilter=function(_Filter){function FrontFilter(){_classCallCheck(this,FrontFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(FrontFilter,_Filter),_createClass(FrontFilter,{name:{get:function(){return"Front"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,65],[28,67],[67,113],[125,183],[187,217],[255,229]],green:[[0,52],[42,59],[104,134],[169,209],[255,240]],blue:[[0,52],[65,68],[93,104],[150,153],[255,198]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"front"}}}),FrontFilter}(Filter);module.exports=FrontFilter},{"./filter":31}],36:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),GlamFilter=function(_Filter){function GlamFilter(){_classCallCheck(this,GlamFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(GlamFilter,_Filter),_createClass(GlamFilter,{name:{get:function(){return"Glam"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Contrast({contrast:1.1})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[127,127],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"glam"}}}),GlamFilter}(Filter);module.exports=GlamFilter},{"./filter":31}],37:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),GobblinFilter=function(_Filter){function GobblinFilter(){_classCallCheck(this,GobblinFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(GobblinFilter,_Filter),_createClass(GobblinFilter,{name:{get:function(){return"Gobblin"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Gobblin),stack.render(renderer)}}},{identifier:{get:function(){return"gobblin"}}}),GobblinFilter}(Filter);module.exports=GobblinFilter},{"./filter":31}],38:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),IdentityFilter=function(_Filter){function IdentityFilter(){_classCallCheck(this,IdentityFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(IdentityFilter,_Filter),_createClass(IdentityFilter,{name:{get:function(){return"Original"}},render:{value:function(){}}},{identifier:{get:function(){return"identity"}}}),IdentityFilter}(Filter);module.exports=IdentityFilter},{"./filter":31}],39:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),K1Filter=function(_Filter){function K1Filter(){_classCallCheck(this,K1Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(K1Filter,_Filter),_createClass(K1Filter,{name:{get:function(){return"K1"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[53,32],[91,80],[176,205],[255,255]]})),stack.add(new Filter.Primitives.Saturation({saturation:.9})),stack.render(renderer)}}},{identifier:{get:function(){return"k1"}}}),K1Filter}(Filter);module.exports=K1Filter},{"./filter":31}],40:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),Color=_interopRequire(require("../../lib/color")),K2Filter=function(_Filter){function K2Filter(){_classCallCheck(this,K2Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(K2Filter,_Filter),_createClass(K2Filter,{name:{get:function(){return"K2"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[54,33],[77,82],[94,103],[122,126],[177,193],[229,232],[255,255]]})),stack.add(new Filter.Primitives.SoftColorOverlay({color:new Color(40/255,40/255,40/255)})),stack.render(renderer)}}},{identifier:{get:function(){return"k2"}}}),K2Filter}(Filter);module.exports=K2Filter},{"../../lib/color":13,"./filter":31}],41:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),K6Filter=function(_Filter){function K6Filter(){_classCallCheck(this,K6Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(K6Filter,_Filter),_createClass(K6Filter,{name:{get:function(){return"K6"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Saturation({saturation:.5})),stack.render(renderer)}}},{identifier:{get:function(){return"k6"}}}),K6Filter}(Filter);module.exports=K6Filter},{"./filter":31}],42:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),KDynamicFilter=function(_Filter){function KDynamicFilter(){_classCallCheck(this,KDynamicFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(KDynamicFilter,_Filter),_createClass(KDynamicFilter,{name:{get:function(){return"KDynamic"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[17,27],[46,69],[90,112],[156,200],[203,243],[255,255]]})),stack.add(new Filter.Primitives.Saturation({saturation:.7})),stack.render(renderer)}}},{identifier:{get:function(){return"kdynamic"}}}),KDynamicFilter}(Filter);module.exports=KDynamicFilter},{"./filter":31}],43:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj;

},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),LeninFilter=function(_Filter){function LeninFilter(){_classCallCheck(this,LeninFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(LeninFilter,_Filter),_createClass(LeninFilter,{name:{get:function(){return"Lenin"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.4})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,20],[40,20],[106,111],[129,153],[190,223],[255,255]],green:[[0,20],[40,20],[62,41],[106,108],[132,159],[203,237],[255,255]],blue:[[0,40],[40,40],[73,60],[133,160],[191,297],[203,237],[237,239],[255,255]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"lenin"}}}),LeninFilter}(Filter);module.exports=LeninFilter},{"./filter":31}],44:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),LomoFilter=function(_Filter){function LomoFilter(){_classCallCheck(this,LomoFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(LomoFilter,_Filter),_createClass(LomoFilter,{name:{get:function(){return"Lomo"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[87,20],[131,156],[183,205],[255,200]]})),stack.render(renderer)}}},{identifier:{get:function(){return"lomo"}}}),LomoFilter}(Filter);module.exports=LomoFilter},{"./filter":31}],45:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),MellowFilter=function(_Filter){function MellowFilter(){_classCallCheck(this,MellowFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(MellowFilter,_Filter),_createClass(MellowFilter,{name:{get:function(){return"Mellow"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[41,84],[87,134],[255,255]],green:[[0,0],[255,216]],blue:[[0,0],[255,131]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"mellow"}}}),MellowFilter}(Filter);module.exports=MellowFilter},{"./filter":31}],46:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),MorningFilter=function(_Filter){function MorningFilter(){_classCallCheck(this,MorningFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(MorningFilter,_Filter),_createClass(MorningFilter,{name:{get:function(){return"Morning"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,40],[255,230]],green:[[0,10],[255,225]],blue:[[0,20],[255,181]]}})),stack.add(new Filter.Primitives.Glow),stack.render(renderer)}}},{identifier:{get:function(){return"morning"}}}),MorningFilter}(Filter);module.exports=MorningFilter},{"./filter":31}],47:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),OrchidFilter=function(_Filter){function OrchidFilter(){_classCallCheck(this,OrchidFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(OrchidFilter,_Filter),_createClass(OrchidFilter,{name:{get:function(){return"Orchid"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[115,130],[195,215],[255,255]],green:[[0,0],[148,153],[172,215],[255,255]],blue:[[0,46],[58,75],[178,205],[255,255]]}})),stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[117,151],[189,217],[255,255]]})),stack.add(new Filter.Primitives.Desaturation({desaturation:.65})),stack.render(renderer)}}},{identifier:{get:function(){return"orchid"}}}),OrchidFilter}(Filter);module.exports=OrchidFilter},{"./filter":31}],48:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),PolaFilter=function(_Filter){function PolaFilter(){_classCallCheck(this,PolaFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(PolaFilter,_Filter),_createClass(PolaFilter,{name:{get:function(){return"Pola SX"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[94,74],[181,205],[255,255]],green:[[0,0],[34,34],[99,76],[176,190],[255,255]],blue:[[0,0],[102,73],[227,213],[255,255]]}})),stack.add(new Filter.Primitives.Saturation({saturation:.8})),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)}}},{identifier:{get:function(){return"pola"}}}),PolaFilter}(Filter);module.exports=PolaFilter},{"./filter":31}],49:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),Pola669Filter=function(_Filter){function Pola669Filter(){_classCallCheck(this,Pola669Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(Pola669Filter,_Filter),_createClass(Pola669Filter,{name:{get:function(){return"Pola 669"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[56,18],[196,209],[255,255]],green:[[0,38],[71,84],[255,255]],blue:[[0,0],[131,133],[204,211],[255,255]]}})),stack.add(new Filter.Primitives.Saturation({saturation:.8})),stack.add(new Filter.Primitives.Contrast({contrast:1.5})),stack.render(renderer)}}},{identifier:{get:function(){return"pola669"}}}),Pola669Filter}(Filter);module.exports=Pola669Filter},{"./filter":31}],50:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},PrimitivesStack=function(){function PrimitivesStack(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,PrimitivesStack),_get(Object.getPrototypeOf(PrimitivesStack.prototype),"constructor",this).apply(this,args),this._stack=[]}return _createClass(PrimitivesStack,{add:{value:function(primitive){this._stack.push(primitive)}},render:{value:function(renderer){for(var i=0;i<this._stack.length;i++){var primitive=this._stack[i];primitive.render(renderer)}}}}),PrimitivesStack}();module.exports=PrimitivesStack},{}],51:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Brightness=function(_Primitive){function Brightness(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Brightness),_get(Object.getPrototypeOf(Brightness.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{brightness:1}),this._fragmentShader="\n\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_brightness;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        gl_FragColor = vec4((texColor.rgb + vec3(u_brightness)), texColor.a);\n      }\n\n    "}return _inherits(Brightness,_Primitive),_createClass(Brightness,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_brightness:{type:"f",value:this._options.brightness}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),brightness=this._options.brightness,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=imageData.data[index]+255*brightness,imageData.data[index+1]=imageData.data[index+1]+255*brightness,imageData.data[index+2]=imageData.data[index+2]+255*brightness}renderer.getContext().putImageData(imageData,0,0)}}}),Brightness}(Primitive);module.exports=Brightness},{"./primitive":58,lodash:"lodash"}],52:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Contrast=function(_Primitive){function Contrast(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Contrast),_get(Object.getPrototypeOf(Contrast.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{contrast:1}),this._fragmentShader="\n\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_contrast;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        gl_FragColor = vec4(((texColor.rgb - vec3(0.5)) * u_contrast + vec3(0.5)), texColor.a);\n      }\n\n    "}return _inherits(Contrast,_Primitive),_createClass(Contrast,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_contrast:{type:"f",value:this._options.contrast}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),contrast=this._options.contrast,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=(imageData.data[index]-127)*contrast+127,imageData.data[index+1]=(imageData.data[index+1]-127)*contrast+127,imageData.data[index+2]=(imageData.data[index+2]-127)*contrast+127}renderer.getContext().putImageData(imageData,0,0)}}}),Contrast}(Primitive);module.exports=Contrast},{"./primitive":58,lodash:"lodash"}],53:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Desaturation=function(_Primitive){function Desaturation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Desaturation),_get(Object.getPrototypeOf(Desaturation.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{desaturation:1}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_desaturation;\n\n      const vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).xyz;\n        vec3 grayXfer = vec3(0.3, 0.59, 0.11);\n        vec3 gray = vec3(dot(grayXfer, texColor));\n        gl_FragColor = vec4(mix(texColor, gray, u_desaturation), 1.0);\n      }\n    "}return _inherits(Desaturation,_Primitive),_createClass(Desaturation,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_desaturation:{type:"f",value:this._options.desaturation}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),desaturation=this._options.desaturation,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.3*imageData.data[index]+.59*imageData.data[index+1]+.11*imageData.data[index+2];imageData.data[index]=luminance*(1-desaturation)+imageData.data[index]*desaturation,imageData.data[index+1]=luminance*(1-desaturation)+imageData.data[index+1]*desaturation,imageData.data[index+2]=luminance*(1-desaturation)+imageData.data[index+2]*desaturation}renderer.getContext().putImageData(imageData,0,0)}}}),Desaturation}(Primitive);module.exports=Desaturation},{"./primitive":58,lodash:"lodash"}],54:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Color=_interopRequire(require("../../../lib/color")),Glow=function(_Primitive){function Glow(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Glow),_get(Object.getPrototypeOf(Glow.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{color:new Color(1,1,1)}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      uniform vec3 u_color;\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).rgb;\n\n        vec2 textureCoord = v_texCoord - vec2(0.5, 0.5);\n        textureCoord /= 0.75;\n\n        float d = 1.0 - dot(textureCoord, textureCoord);\n        d = clamp(d, 0.2, 1.0);\n        vec3 newColor = texColor * d * u_color.rgb;\n        gl_FragColor = vec4(vec3(newColor),1.0);\n      }\n    "}return _inherits(Glow,_Primitive),_createClass(Glow,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_color:{type:"3f",value:this._options.color.toRGBGLColor()}}})}},renderCanvas:{value:function(renderer){for(var d,canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),color=this._options.color,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),x01=x/canvas.width,y01=y/canvas.height,nx=(x01-.5)/.75,ny=(y01-.5)/.75,scalarX=nx*nx,scalarY=ny*ny;d=1-(scalarX+scalarY),d=Math.min(Math.max(d,.1),1),imageData.data[index]=imageData.data[index]*d*color.r,imageData.data[index+1]=imageData.data[index+1]*d*color.g,imageData.data[index+2]=imageData.data[index+2]*d*color.b,imageData.data[index+3]=255}renderer.getContext().putImageData(imageData,0,0)}}}),Glow}(Primitive);module.exports=Glow},{"../../../lib/color":13,"./primitive":58,lodash:"lodash"}],55:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),Gobblin=function(_Primitive){function Gobblin(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Gobblin),_get(Object.getPrototypeOf(Gobblin.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        texColor.b = texColor.g * 0.33;\n        texColor.r = texColor.r * 0.6;\n        texColor.b += texColor.r * 0.33;\n        texColor.g = texColor.g * 0.7;\n        gl_FragColor = texColor;\n      }\n    "}return _inherits(Gobblin,_Primitive),_createClass(Gobblin,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index+2]=.33*imageData.data[index+1],imageData.data[index]=.6*imageData.data[index],imageData.data[index+2]+=.33*imageData.data[index],imageData.data[index+1]=.7*imageData.data[index+1],imageData.data[index+3]=255}renderer.getContext().putImageData(imageData,0,0)}}}),Gobblin}(Primitive);module.exports=Gobblin},{"./primitive":58}],56:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),Grayscale=function(_Primitive){function Grayscale(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Grayscale),_get(Object.getPrototypeOf(Grayscale.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      vec3 W = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec3 texColor = texture2D(u_image, v_texCoord).rgb;\n        float luminance = dot(texColor, W);\n        gl_FragColor = vec4(vec3(luminance), 1.0);\n      }\n    "}return _inherits(Grayscale,_Primitive),_createClass(Grayscale,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.2125*imageData.data[index]+.7154*imageData.data[index+1]+.0721*imageData.data[index+2];imageData.data[index]=luminance,imageData.data[index+1]=luminance,imageData.data[index+2]=luminance}renderer.getContext().putImageData(imageData,0,0)}}}),Grayscale}(Primitive);module.exports=Grayscale},{"./primitive":58}],57:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj;

},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),LookupTable=function(_Primitive){function LookupTable(){_classCallCheck(this,LookupTable),Primitive.apply(this,arguments),this._textureIndex=3,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_lookupTable;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float r = texture2D(u_lookupTable, vec2(texColor.r, 0.0)).r;\n        float g = texture2D(u_lookupTable, vec2(texColor.g, 0.0)).g;\n        float b = texture2D(u_lookupTable, vec2(texColor.b, 0.0)).b;\n\n        gl_FragColor = vec4(r, g, b, texColor.a);\n      }\n    "}return _inherits(LookupTable,_Primitive),_createClass(LookupTable,{renderWebGL:{value:function(renderer){this._updateTexture(renderer),renderer.runShader(null,this._fragmentShader,{uniforms:{u_lookupTable:{type:"i",value:3}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),table=this._options.data,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),r=imageData.data[index];imageData.data[index]=table[4*r];var g=imageData.data[index+1];imageData.data[index+1]=table[1+4*g];var b=imageData.data[index+2];imageData.data[index+2]=table[2+4*b]}renderer.getContext().putImageData(imageData,0,0)}},_updateTexture:{value:function(renderer){var gl=renderer.getContext();if("undefined"==typeof this._options.data)throw new Error("LookupTable: No data specified.");var dataTypedArray=new Uint8Array(this._options.data);gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture||(this._texture=gl.createTexture()),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,256,1,0,gl.RGBA,gl.UNSIGNED_BYTE,dataTypedArray),gl.activeTexture(gl.TEXTURE0)}}}),LookupTable}(Primitive);module.exports=LookupTable},{"./primitive":58}],58:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=function(){function Primitive(options){_classCallCheck(this,Primitive),options=options||{},this._options=options}return _createClass(Primitive,{render:{value:function(renderer){"webgl"===renderer.identifier?this.renderWebGL(renderer):this.renderCanvas(renderer)}},renderWebGL:{value:function(){throw new Error("Primitive#renderWebGL is abstract and not implemented in inherited class.")}},renderCanvas:{value:function(){throw new Error("Primitive#renderCanvas is abstract and not implemented in inherited class.")}}}),Primitive}();module.exports=Primitive},{}],59:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Saturation=function(_Primitive){function Saturation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,Saturation),_get(Object.getPrototypeOf(Saturation.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{saturation:0}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform float u_saturation;\n\n      const vec3 luminanceWeighting = vec3(0.2125, 0.7154, 0.0721);\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float luminance = dot(texColor.rgb, luminanceWeighting);\n\n        vec3 greyScaleColor = vec3(luminance);\n\n        gl_FragColor = vec4(mix(greyScaleColor, texColor.rgb, u_saturation), texColor.a);\n      }\n    "}return _inherits(Saturation,_Primitive),_createClass(Saturation,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_saturation:{type:"f",value:this._options.saturation}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),saturation=this._options.saturation,x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),luminance=.2125*imageData.data[index]+.7154*imageData.data[index+1]+.0721*imageData.data[index+2];imageData.data[index]=luminance*(1-saturation)+imageData.data[index]*saturation,imageData.data[index+1]=luminance*(1-saturation)+imageData.data[index+1]*saturation,imageData.data[index+2]=luminance*(1-saturation)+imageData.data[index+2]*saturation}renderer.getContext().putImageData(imageData,0,0)}}}),Saturation}(Primitive);module.exports=Saturation},{"./primitive":58,lodash:"lodash"}],60:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Primitive=_interopRequire(require("./primitive")),Color=_interopRequire(require("../../../lib/color")),SoftColorOverlay=function(_Primitive){function SoftColorOverlay(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,SoftColorOverlay),_get(Object.getPrototypeOf(SoftColorOverlay.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{color:new Color(1,1,1)}),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform vec3 u_overlay;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        vec4 overlayVec4 = vec4(u_overlay, texColor.a);\n        gl_FragColor = max(overlayVec4, texColor);\n      }\n    "}return _inherits(SoftColorOverlay,_Primitive),_createClass(SoftColorOverlay,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader,{uniforms:{u_overlay:{type:"3f",value:this._options.color.toRGBGLColor()}}})}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x);imageData.data[index]=Math.max(this._options.color.r,imageData.data[index]),imageData.data[index+1]=Math.max(this._options.color.g,imageData.data[index+1]),imageData.data[index+2]=Math.max(this._options.color.b,imageData.data[index+2])}renderer.getContext().putImageData(imageData,0,0)}}}),SoftColorOverlay}(Primitive);module.exports=SoftColorOverlay},{"../../../lib/color":13,"./primitive":58,lodash:"lodash"}],61:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),LookupTable=_interopRequire(require("./lookup-table")),ToneCurve=function(_LookupTable){function ToneCurve(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,ToneCurve),_get(Object.getPrototypeOf(ToneCurve.prototype),"constructor",this).apply(this,args),this._options=_.defaults(this._options,{rgbControlPoints:{red:this._options.controlPoints,green:this._options.controlPoints,blue:this._options.controlPoints}}),"undefined"!=typeof this._options.rgbControlPoints&&this._updateLookupTable()}return _inherits(ToneCurve,_LookupTable),_createClass(ToneCurve,{_updateLookupTable:{value:function(){var r=this._calculateSplineCurve(this._options.rgbControlPoints.red),g=this._calculateSplineCurve(this._options.rgbControlPoints.green),b=this._calculateSplineCurve(this._options.rgbControlPoints.blue);this._options.data=this._buildLookupTable(r,g,b)}},_buildLookupTable:{value:function(r,g,b){for(var data=[],i=0;256>i;i++)data.push(Math.min(Math.max(i+r[i],0),255)),data.push(Math.min(Math.max(i+g[i],0),255)),data.push(Math.min(Math.max(i+b[i],0),255)),data.push(255);return data}},_calculateSplineCurve:{value:function(points){points=points.sort(function(a,b){return a[0]>b[0]});var i,splinePoints=this._getSplineCurve(points),firstSplinePoint=splinePoints[0];if(firstSplinePoint[0]>0)for(i=0;i<firstSplinePoint[0];i++)splinePoints.unshift([0,0]);var preparedPoints=[];for(i=0;i<splinePoints.length;i++){var newPoint=splinePoints[i],origPoint=[newPoint[0],newPoint[0]],distance=Math.sqrt(Math.pow(origPoint[0]-newPoint[0],2)+Math.pow(origPoint[1]-newPoint[1],2));origPoint[1]>newPoint[1]&&(distance=-distance),preparedPoints.push(distance)}return preparedPoints}},_getSplineCurve:{value:function(points){var i,sdA=this._secondDerivative(points),n=sdA.length,sd=[];for(i=0;n>i;i++)sd[i]=sdA[i];var output=[];for(i=0;n-1>i;i++)for(var cur=points[i],next=points[i+1],x=cur[0];x<next[0];x++){var t=(x-cur[0])/(next[0]-cur[0]),a=1-t,b=t,h=next[0]-cur[0],y=a*cur[1]+b*next[1]+h*h/6*((a*a*a-a)*sd[i]+(b*b*b-b)*sd[i+1]);y>255?y=255:0>y&&(y=0),output.push([x,y])}return 255===output.length&&output.push(points[points.length-1]),output}},_secondDerivative:{value:function(points){var n=points.length;if(0>=n||1===n)return null;var i,k,matrix=[],result=[];for(matrix[0]=[0,1,0],i=1;n-1>i;i++){var P1=points[i-1],P2=points[i],P3=points[i+1];matrix[i]=matrix[i]||[],matrix[i][0]=(P2[0]-P1[0])/6,matrix[i][1]=(P3[0]-P1[0])/3,matrix[i][2]=(P3[0]-P2[0])/6,result[i]=(P3[1]-P2[1])/(P3[0]-P2[0])-(P2[1]-P1[1])/(P2[0]-P1[0])}for(result[0]=0,result[n-1]=0,matrix[n-1]=[0,1,0],i=1;n>i;i++)k=matrix[1][0]/matrix[i-1][1],matrix[i][1]-=k*matrix[i-1][2],matrix[i][0]=0,result[i]-=k*result[i-1];for(i=n-2;i>0;i--)k=matrix[i][2]/matrix[i+1][1],matrix[i][1]-=k*matrix[i+1][0],matrix[i][2]=0,result[i]-=k*result[i+1];var y2=[];for(i=0;n>i;i++)y2[i]=result[i]/matrix[i][1];return y2}}}),ToneCurve}(LookupTable);module.exports=ToneCurve},{"./lookup-table":57,lodash:"lodash"}],62:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Primitive=_interopRequire(require("./primitive")),X400=function(_Primitive){function X400(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,X400),_get(Object.getPrototypeOf(X400.prototype),"constructor",this).apply(this,args),this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n\n      void main() {\n        vec4 texColor = texture2D(u_image, v_texCoord);\n        float gray = texColor.r * 0.3 + texColor.g * 0.3 + texColor.b * 0.3;\n        gray -= 0.2;\n        gray = clamp(gray, 0.0, 1.0);\n        gray += 0.15;\n        gray *= 1.4;\n        gl_FragColor = vec4(vec3(gray), 1.0);\n      }\n    "}return _inherits(X400,_Primitive),_createClass(X400,{renderWebGL:{value:function(renderer){renderer.runShader(null,this._fragmentShader)}},renderCanvas:{value:function(renderer){for(var canvas=renderer.getCanvas(),imageData=renderer.getContext().getImageData(0,0,canvas.width,canvas.height),x=0;x<canvas.width;x++)for(var y=0;y<canvas.height;y++){var index=4*(canvas.width*y+x),gray=imageData.data[index]/255*.3+imageData.data[index+1]/255*.3+imageData.data[index+2]/255*.3;gray-=.2,gray=Math.max(0,Math.min(1,gray)),gray+=.15,gray*=1.4,gray*=255,imageData.data[index]=gray,imageData.data[index+1]=gray,imageData.data[index+2]=gray}renderer.getContext().putImageData(imageData,0,0)}}}),X400}(Primitive);module.exports=X400},{"./primitive":58}],63:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),QuoziFilter=function(_Filter){function QuoziFilter(){_classCallCheck(this,QuoziFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(QuoziFilter,_Filter),_createClass(QuoziFilter,{name:{get:function(){return"Quozi"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.Desaturation({desaturation:.65})),stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,50],[40,78],[118,170],[181,211],[255,255]],green:[[0,27],[28,45],[109,157],[157,195],[179,208],[206,212],[255,240]],blue:[[0,50],[12,55],[46,103],[103,162],[194,182],[241,201],[255,219]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"quozi"}}}),QuoziFilter}(Filter);module.exports=QuoziFilter},{"./filter":31}],64:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),SemiredFilter=function(_Filter){function SemiredFilter(){_classCallCheck(this,SemiredFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(SemiredFilter,_Filter),_createClass(SemiredFilter,{name:{get:function(){return"Semi Red"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,129],[75,153],[181,227],[255,255]],green:[[0,8],[111,85],[212,158],[255,226]],blue:[[0,5],[75,22],[193,90],[255,229]]}})),stack.add(new Filter.Primitives.Glow),stack.render(renderer)}}},{identifier:{get:function(){return"semired"}}}),SemiredFilter}(Filter);module.exports=SemiredFilter},{"./filter":31}],65:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),SunnyFilter=function(_Filter){function SunnyFilter(){_classCallCheck(this,SunnyFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(SunnyFilter,_Filter),_createClass(SunnyFilter,{name:{get:function(){return"Sunny"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,0],[62,82],[141,154],[255,255]],green:[[0,39],[56,96],[192,176],[255,255]],blue:[[0,0],[174,99],[255,235]]}})),stack.add(new Filter.Primitives.ToneCurve({controlPoints:[[0,0],[55,20],[158,191],[255,255]]})),stack.render(renderer)}}},{identifier:{get:function(){return"sunny"}}}),SunnyFilter}(Filter);module.exports=SunnyFilter},{"./filter":31}],66:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),TexasFilter=function(_Filter){function TexasFilter(){_classCallCheck(this,TexasFilter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(TexasFilter,_Filter),_createClass(TexasFilter,{name:{get:function(){return"Texas"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.ToneCurve({rgbControlPoints:{red:[[0,72],[89,99],[176,212],[255,237]],green:[[0,49],[255,192]],blue:[[0,72],[255,151]]}})),stack.render(renderer)}}},{identifier:{get:function(){return"texas"}}}),TexasFilter}(Filter);module.exports=TexasFilter},{"./filter":31}],67:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Filter=_interopRequire(require("./filter")),X400Filter=function(_Filter){function X400Filter(){_classCallCheck(this,X400Filter),null!=_Filter&&_Filter.apply(this,arguments)}return _inherits(X400Filter,_Filter),_createClass(X400Filter,{name:{get:function(){return"X400"}},render:{value:function(renderer){var stack=new Filter.PrimitivesStack;stack.add(new Filter.Primitives.X400),stack.render(renderer)}}},{identifier:{get:function(){return"x400"}}}),X400Filter}(Filter);module.exports=X400Filter},{"./filter":31}],68:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),FlipOperation=function(_Operation){function FlipOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FlipOperation),this.availableOptions={horizontal:{type:"boolean","default":!1},vertical:{type:"boolean","default":!1}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n      uniform bool u_flipVertical;\n      uniform bool u_flipHorizontal;\n\n      void main() {\n        vec2 texCoord = vec2(v_texCoord);\n        if (u_flipVertical) {\n          texCoord.y = 1.0 - texCoord.y;\n        }\n        if (u_flipHorizontal) {\n          texCoord.x = 1.0 - texCoord.x;\n        }\n        gl_FragColor = texture2D(u_image, texCoord);\n      }\n    ",_get(Object.getPrototypeOf(FlipOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FlipOperation,_Operation),_createClass(FlipOperation,{_renderWebGL:{value:function(renderer){renderer.runShader(null,this.fragmentShader,{uniforms:{u_flipVertical:{type:"f",value:this._options.vertical},u_flipHorizontal:{type:"f",value:this._options.horizontal}}})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),context=renderer.getContext(),scaleX=1,scaleY=1,translateX=0,translateY=0;this._options.horizontal&&(scaleX=-1,translateX=canvas.width),this._options.vertical&&(scaleY=-1,translateY=canvas.height),context.save(),context.translate(translateX,translateY),context.scale(scaleX,scaleY);var tempCanvas=renderer.cloneCanvas();context.drawImage(tempCanvas,0,0),context.restore()}}}),FlipOperation}(Operation);FlipOperation.prototype.identifier="flip",module.exports=FlipOperation},{"./operation":70}],69:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Color=_interopRequire(require("../lib/color")),FramesOperation=function(_Operation){function FramesOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,FramesOperation),this.availableOptions={color:{type:"color","default":new Color(0,0,0,1)},thickness:{type:"number","default":.02}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_frameImage;\n      uniform vec4 u_color;\n      uniform vec2 u_thickness;\n\n      void main() {\n        vec4 fragColor = texture2D(u_image, v_texCoord);\n        if (v_texCoord.x < u_thickness.x || v_texCoord.x > 1.0 - u_thickness.x ||\n          v_texCoord.y < u_thickness.y || v_texCoord.y > 1.0 - u_thickness.y) {\n            fragColor = mix(fragColor, u_color, u_color.a);\n          }\n\n        gl_FragColor = fragColor;\n      }\n    ",
_get(Object.getPrototypeOf(FramesOperation.prototype),"constructor",this).apply(this,args)}return _inherits(FramesOperation,_Operation),_createClass(FramesOperation,{_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),color=this._options.color,thickness=this._options.thickness*canvas.height,thicknessVec2=[thickness/canvas.width,thickness/canvas.height];renderer.runShader(null,this._fragmentShader,{uniforms:{u_color:{type:"4f",value:color.toGLColor()},u_thickness:{type:"2f",value:thicknessVec2}}})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),context=renderer.getContext(),color=this._options.color,thickness=this._options.thickness*canvas.height;context.save(),context.beginPath(),context.lineWidth=2*thickness,context.strokeStyle=color.toRGBA(),context.rect(0,0,canvas.width,canvas.height),context.stroke(),context.restore()}}}),FramesOperation}(Operation);FramesOperation.prototype.identifier="frames",module.exports=FramesOperation},{"../lib/color":13,"./operation":70}],70:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),Vector2=_interopRequire(require("../lib/math/vector2")),Color=_interopRequire(require("../lib/color")),EventEmitter=_interopRequire(require("../lib/event-emitter")),Operation=function(_EventEmitter){function Operation(kit,options){if(_classCallCheck(this,Operation),_get(Object.getPrototypeOf(Operation.prototype),"constructor",this).call(this),"ImglyKit"!==kit.constructor.name)throw new Error("Operation: First parameter for constructor has to be an ImglyKit instance.");this._kit=kit,this.availableOptions=_.extend(this.availableOptions||{},{numberFormat:{type:"string","default":"relative",available:["absolute","relative"]}}),this._dirty=!0,this._uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)}),this._initOptions(options||{})}return _inherits(Operation,_EventEmitter),_createClass(Operation,{validateSettings:{value:function(){var _this=this,identifier=this.identifier;return new Promise(function(resolve,reject){for(var optionName in _this.availableOptions){var optionConfig=_this.availableOptions[optionName];if(optionConfig.required&&"undefined"==typeof _this._options[optionName])return reject(new Error("Operation `"+identifier+"`: Option `"+optionName+"` is required."))}resolve()})}},render:{value:function(renderer){var renderFn=void 0;renderFn="webgl"===renderer.identifier?this._renderWebGL.bind(this):this._renderCanvas.bind(this),this._dirty?(renderFn(renderer),renderer.cache(this._uuid),this._dirty=!1):renderer.drawCached(this._uuid)}},_renderWebGL:{value:function(){throw new Error("Operation#_renderWebGL is abstract and not implemented in inherited class.")}},_renderCanvas:{value:function(){throw new Error("Operation#_renderCanvas is abstract and not implemented in inherited class.")}},_initOptions:{value:function(userOptions){this._options={};var optionName,option,capitalized,self=this;for(optionName in this.availableOptions)capitalized=optionName.charAt(0).toUpperCase()+optionName.slice(1),option=this.availableOptions[optionName],function(optionName){self["set"+capitalized]=function(value){self._setOption(optionName,value)},self["get"+capitalized]=function(){return self._getOption(optionName)}}(optionName,option),"undefined"!=typeof option["default"]&&this["set"+capitalized](option["default"]);for(optionName in userOptions){if("undefined"==typeof this.availableOptions[optionName])throw new Error("Invalid option: "+optionName);capitalized=optionName.charAt(0).toUpperCase()+optionName.slice(1),this["set"+capitalized](userOptions[optionName])}}},set:{value:function(options){for(var optionName in options)this._setOption(optionName,options[optionName],!1);this.emit("update")}},_getOption:{value:function(optionName){return this._options[optionName]}},_setOption:{value:function(optionName,value){var update=void 0===arguments[2]?!0:arguments[2],optionConfig=this.availableOptions[optionName],identifier=this.identifier;switch("undefined"!=typeof optionConfig.setter&&(value=optionConfig.setter.call(this,value)),"undefined"!=typeof optionConfig.validation&&optionConfig.validation(value),optionConfig.type){case"string":if("string"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a string.");var available=optionConfig.available;if("undefined"!=typeof available&&-1===available.indexOf(value))throw new Error("Operation `"+identifier+"`: Invalid value for `"+optionName+"` (valid values are: "+optionConfig.available.join(", ")+")");this._options[optionName]=value;break;case"number":if("number"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a number.");this._options[optionName]=value;break;case"boolean":if("boolean"!=typeof value)throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be a boolean.");this._options[optionName]=value;break;case"vector2":if(!(value instanceof Vector2))throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be an instance of ImglyKit.Vector2.");this._options[optionName]=value.clone();break;case"color":if(!(value instanceof Color))throw new Error("Operation `"+identifier+"`: Option `"+optionName+"` has to be an instance of ImglyKit.Color.");this._options[optionName]=value;break;case"object":this._options[optionName]=value}this._dirty=!0,update&&this.emit("update")}},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();return dimensions=dimensions||new Vector2(canvas.width,canvas.height)}},dirty:{set:function(dirty){this._dirty=dirty},get:function(){return this._dirty}}}),Operation}(EventEmitter);Operation.prototype.identifier=null;var extend=_interopRequire(require("../lib/extend"));Operation.extend=extend,module.exports=Operation},{"../lib/color":13,"../lib/event-emitter":14,"../lib/extend":15,"../lib/math/vector2":18,lodash:"lodash"}],71:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);if(null!==parent)return set(parent,property,value,receiver)}else{if("value"in desc&&desc.writable)return desc.value=value;var setter=desc.set;if(void 0!==setter)return setter.call(receiver,value)}},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),StackBlur=_interopRequire(require("../vendor/stack-blur")),RadialBlurOperation=function(_Operation){function RadialBlurOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,RadialBlurOperation),this.availableOptions={position:{type:"vector2","default":new Vector2(.5,.5)},gradientRadius:{type:"number","default":50},blurRadius:{type:"number","default":20}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      uniform float blurRadius;\n      uniform float gradientRadius;\n      uniform vec2 position;\n      uniform vec2 delta;\n      uniform vec2 texSize;\n      varying vec2 v_texCoord;\n\n      float random(vec3 scale, float seed) {\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n      }\n\n      void main() {\n          vec4 color = vec4(0.0);\n          float total = 0.0;\n\n          float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n          float radius = smoothstep(0.0, 1.0, abs(distance(v_texCoord * texSize, position)) / (gradientRadius * 2.0)) * blurRadius;\n          for (float t = -30.0; t <= 30.0; t++) {\n              float percent = (t + offset - 0.5) / 30.0;\n              float weight = 1.0 - abs(percent);\n              vec4 sample = texture2D(u_image, v_texCoord + delta * percent * radius / texSize);\n\n              sample.rgb *= sample.a;\n\n              color += sample * weight;\n              total += weight;\n          }\n\n          gl_FragColor = color / total;\n          gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n      }\n    ",_get(Object.getPrototypeOf(RadialBlurOperation.prototype),"constructor",this).apply(this,args),this._cachedBlurredCanvas=null,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius}return _inherits(RadialBlurOperation,_Operation),_createClass(RadialBlurOperation,{_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),position=this._options.position.clone();position.y=1-position.y,"relative"===this._options.numberFormat&&position.multiply(canvasSize);var uniforms={blurRadius:{type:"f",value:this._options.blurRadius},gradientRadius:{type:"f",value:this._options.gradientRadius},position:{type:"2f",value:[position.x,position.y]},texSize:{type:"2f",value:[canvas.width,canvas.height]},delta:{type:"2f",value:[1,1]}};renderer.runShader(null,this.fragmentShader,{uniforms:uniforms}),uniforms.delta.value=[-1,1],renderer.runShader(null,this.fragmentShader,{uniforms:uniforms})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),blurRadiusChanged=this._options.blurRadius!==this._lastBlurRadius,blurryCanvas=void 0;blurRadiusChanged||null===this._cachedBlurredCanvas?(blurryCanvas=this._blurCanvas(renderer),this._cachedBlurredCanvas=blurryCanvas,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius):blurryCanvas=this._cachedBlurredCanvas;var maskCanvas=this._createMask(renderer);this._applyMask(canvas,blurryCanvas,maskCanvas)}},_blurCanvas:{value:function(renderer){var newCanvas=renderer.cloneCanvas(),blurryContext=newCanvas.getContext("2d"),blurryImageData=blurryContext.getImageData(0,0,newCanvas.width,newCanvas.height);return StackBlur.stackBlurCanvasRGBA(blurryImageData,0,0,newCanvas.width,newCanvas.height,this._options.blurRadius),blurryContext.putImageData(blurryImageData,0,0),newCanvas}},_createMask:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),gradientRadius=this._options.gradientRadius,maskCanvas=renderer.createCanvas(canvas.width,canvas.height),maskContext=maskCanvas.getContext("2d"),position=this._options.position.clone();"relative"===this._options.numberFormat&&position.multiply(canvasSize);var gradient=maskContext.createRadialGradient(position.x,position.y,0,position.x,position.y,gradientRadius);return gradient.addColorStop(0,"#FFFFFF"),gradient.addColorStop(1,"#000000"),maskContext.fillStyle=gradient,maskContext.fillRect(0,0,canvas.width,canvas.height),maskCanvas}},_applyMask:{value:function(inputCanvas,blurryCanvas,maskCanvas){for(var index,alpha,inputContext=inputCanvas.getContext("2d"),blurryContext=blurryCanvas.getContext("2d"),maskContext=maskCanvas.getContext("2d"),inputImageData=inputContext.getImageData(0,0,inputCanvas.width,inputCanvas.height),pixels=inputImageData.data,blurryPixels=blurryContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,maskPixels=maskContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,y=0;y<inputCanvas.height;y++)for(var x=0;x<inputCanvas.width;x++)index=4*(y*inputCanvas.width+x),alpha=maskPixels[index]/255,pixels[index]=alpha*pixels[index]+(1-alpha)*blurryPixels[index],pixels[index+1]=alpha*pixels[index+1]+(1-alpha)*blurryPixels[index+1],pixels[index+2]=alpha*pixels[index+2]+(1-alpha)*blurryPixels[index+2];inputContext.putImageData(inputImageData,0,0)}},dirty:{set:function(dirty){_set(Object.getPrototypeOf(RadialBlurOperation.prototype),"dirty",dirty,this),this._cachedBlurredCanvas=null},get:function(){return _get(Object.getPrototypeOf(RadialBlurOperation.prototype),"dirty",this)}}}),RadialBlurOperation}(Operation);RadialBlurOperation.prototype.identifier="radial-blur",module.exports=RadialBlurOperation},{"../lib/math/vector2":18,"../vendor/stack-blur":103,"./operation":70}],72:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),RotationOperation=function(_Operation){function RotationOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,RotationOperation),this.availableOptions={degrees:{type:"number","default":0,validation:function(value){if(value%90!==0)throw new Error("RotationOperation: `rotation` has to be a multiple of 90.")}}},this.vertexShader="\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n      uniform mat3 u_matrix;\n\n      void main() {\n        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    ",_get(Object.getPrototypeOf(RotationOperation.prototype),"constructor",this).apply(this,args)}return _inherits(RotationOperation,_Operation),_createClass(RotationOperation,{_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),actualDegrees=this._options.degrees%360;if(actualDegrees%180!==0){var newDimensions=this.getNewDimensions(renderer);canvas.width=newDimensions.x,canvas.height=newDimensions.y}var radians=actualDegrees*(Math.PI/180),c=Math.cos(radians),s=Math.sin(radians),rotationMatrix=[c,-s,0,s,c,0,0,0,1];renderer.runShader(this.vertexShader,null,{uniforms:{u_matrix:{type:"mat3fv",value:rotationMatrix}}})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),actualDegrees=this._options.degrees%360,newDimensions=this.getNewDimensions(renderer),newCanvas=renderer.createCanvas();newCanvas.width=newDimensions.x,newCanvas.height=newDimensions.y;var newContext=newCanvas.getContext("2d");newContext.save(),newContext.translate(newCanvas.width/2,newCanvas.height/2),newContext.rotate(actualDegrees*(Math.PI/180));var tempCanvas=renderer.cloneCanvas();newContext.drawImage(tempCanvas,-canvas.width/2,-canvas.height/2),newContext.restore(),renderer.setCanvas(newCanvas)}},getNewDimensions:{value:function(renderer,dimensions){var canvas=renderer.getCanvas();dimensions=dimensions||new Vector2(canvas.width,canvas.height);var actualDegrees=this._options.degrees%360;if(actualDegrees%180!==0){var tempX=dimensions.x;dimensions.x=dimensions.y,dimensions.y=tempX}return dimensions}}}),RotationOperation}(Operation);RotationOperation.prototype.identifier="rotation",module.exports=RotationOperation},{"../lib/math/vector2":18,"./operation":70}],73:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),PrimitivesStack=_interopRequire(require("./filters/primitives-stack")),SaturationPrimitive=_interopRequire(require("./filters/primitives/saturation")),SaturationOperation=function(_Operation){function SaturationOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,SaturationOperation),this.availableOptions={saturation:{type:"number","default":1}},_get(Object.getPrototypeOf(SaturationOperation.prototype),"constructor",this).apply(this,args)}return _inherits(SaturationOperation,_Operation),_createClass(SaturationOperation,{_renderWebGL:{value:function(renderer){this._render(renderer)}},_renderCanvas:{value:function(renderer){this._render(renderer)}},_render:{value:function(renderer){var stack=new PrimitivesStack;stack.add(new SaturationPrimitive({saturation:this._options.saturation})),stack.render(renderer)}}}),SaturationOperation}(Operation);SaturationOperation.prototype.identifier="saturation",module.exports=SaturationOperation},{"./filters/primitives-stack":50,"./filters/primitives/saturation":59,"./operation":70}],74:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),StickersOperation=function(_Operation){function StickersOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,StickersOperation),this.availableOptions={sticker:{type:"string"},position:{type:"vector2","default":new Vector2(0,0)},size:{type:"vector2","default":new Vector2(0,0)}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_stickerImage;\n      uniform vec2 u_position;\n      uniform vec2 u_size;\n\n      void main() {\n        vec4 color0 = texture2D(u_image, v_texCoord);\n        vec2 relative = (v_texCoord - u_position) / u_size;\n\n        if (relative.x >= 0.0 && relative.x <= 1.0 &&\n          relative.y >= 0.0 && relative.y <= 1.0) {\n\n            vec4 color1 = texture2D(u_stickerImage, relative);\n            gl_FragColor = vec4(mix(color0.rgb, color1.rgb, color1.a), 1.0);\n\n        } else {\n\n          gl_FragColor = color0;\n\n        }\n      }\n    ",this._loadedStickers={},_get(Object.getPrototypeOf(StickersOperation.prototype),"constructor",this).apply(this,args)}return _inherits(StickersOperation,_Operation),_createClass(StickersOperation,{render:{value:function(renderer){var self=this;return this._loadSticker().then(function(image){return"webgl"===renderer.identifier?self._renderWebGL(renderer,image):self._renderCanvas(renderer,image)})}},_renderWebGL:{value:function(renderer,image){var canvas=renderer.getCanvas(),gl=renderer.getContext(),position=this._options.position.clone(),canvasSize=new Vector2(canvas.width,canvas.height);"absolute"===this._options.numberFormat&&position.divide(canvasSize);var size=new Vector2(image.width,image.height);if("undefined"!=typeof this._options.size){size.copy(this._options.size),"relative"===this._options.numberFormat&&size.multiply(canvasSize);var ratio=image.height/image.width;size.y=size.x*ratio}size.divide(canvasSize),position.y=1-position.y,position.y-=size.y,gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),gl.activeTexture(gl.TEXTURE0),renderer.runShader(null,this._fragmentShader,{uniforms:{u_stickerImage:{type:"i",value:this._textureIndex},u_position:{type:"2f",value:[position.x,position.y]},u_size:{type:"2f",value:[size.x,size.y]}}})}},_renderCanvas:{value:function(renderer,image){var canvas=renderer.getCanvas(),context=renderer.getContext(),canvasSize=new Vector2(canvas.width,canvas.height),scaledPosition=this._options.position.clone();"relative"===this._options.numberFormat&&scaledPosition.multiply(canvasSize);var size=new Vector2(image.width,image.height);"undefined"!=typeof this._options.size&&(size.copy(this._options.size),"relative"===this._options.numberFormat&&size.multiply(canvasSize)),context.drawImage(image,0,0,image.width,image.height,scaledPosition.x,scaledPosition.y,size.x,size.y)}},_loadSticker:{value:function(){var isBrowser="undefined"!=typeof window;return isBrowser?this._loadImageBrowser(this._options.sticker):this._loadImageNode(this._options.sticker)}},_loadImageBrowser:{value:function(fileName){var self=this;return new Promise(function(resolve,reject){if(self._loadedStickers[fileName])return resolve(self._loadedStickers[fileName]);var image=new Image;image.addEventListener("load",function(){self._loadedStickers[fileName]=image,resolve(image)}),image.addEventListener("error",function(){reject(new Error("Could not load sticker: "+fileName))}),image.src=self._kit.getAssetPath(fileName)})}},_loadImageNode:{value:function(fileName){var Canvas=require("canvas"),self=this,image=new Canvas.Image,path=self._kit.getAssetPath(fileName);return new Promise(function(resolve,reject){fs.readFile(path,function(err,buffer){return err?reject(err):(image.src=buffer,void resolve(image))})})}},stickers:{get:function(){return this._stickers}}}),StickersOperation}(Operation);StickersOperation.prototype.identifier="stickers",module.exports=StickersOperation},{"../lib/math/vector2":18,"./operation":70,canvas:"canvas"}],75:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),Color=_interopRequire(require("../lib/color")),TextOperation=function(_Operation){function TextOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,TextOperation),this.availableOptions={fontSize:{type:"number","default":.1},lineHeight:{type:"number","default":1.1},fontFamily:{type:"string","default":"Times New Roman"},fontWeight:{type:"string","default":"normal"},alignment:{type:"string","default":"left",available:["left","center","right"]},verticalAlignment:{type:"string","default":"top",available:["top","center","bottom"]},color:{type:"color","default":new Color(1,1,1,1)},backgroundColor:{type:"color","default":new Color(0,0,0,0)},position:{type:"vector2","default":new Vector2(0,0)},text:{type:"string",required:!0},maxWidth:{type:"number","default":1}},this._textureIndex=1,this._fragmentShader="\n      precision mediump float;\n      varying vec2 v_texCoord;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textImage;\n      uniform vec2 u_position;\n      uniform vec2 u_size;\n\n      void main() {\n        vec4 color0 = texture2D(u_image, v_texCoord);\n        vec2 relative = (v_texCoord - u_position) / u_size;\n\n        if (relative.x >= 0.0 && relative.x <= 1.0 &&\n          relative.y >= 0.0 && relative.y <= 1.0) {\n\n            vec4 color1 = texture2D(u_textImage, relative);\n            gl_FragColor = vec4(mix(color0.rgb, color1.rgb, color1.a), 1.0);\n\n        } else {\n\n          gl_FragColor = color0;\n\n        }\n      }\n    ",_get(Object.getPrototypeOf(TextOperation.prototype),"constructor",this).apply(this,args)}return _inherits(TextOperation,_Operation),_createClass(TextOperation,{_renderWebGL:{value:function(renderer){var textCanvas=this._renderTextCanvas(renderer),canvas=renderer.getCanvas(),gl=renderer.getContext(),position=this._options.position.clone(),canvasSize=new Vector2(canvas.width,canvas.height),size=new Vector2(textCanvas.width,textCanvas.height).divide(canvasSize);"absolute"===this._options.numberFormat&&position.divide(canvasSize),position.y=1-position.y,position.y-=size.y,"center"===this._options.verticalAlignment?position.y+=size.y/2:"bottom"===this._options.verticalAlignment&&(position.y+=size.y),"center"===this._options.alignment?position.x-=size.x/2:"right"===this._options.alignment&&(position.x-=size.x),gl.activeTexture(gl.TEXTURE0+this._textureIndex),this._texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this._texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textCanvas),gl.activeTexture(gl.TEXTURE0),renderer.runShader(null,this._fragmentShader,{uniforms:{u_textImage:{type:"i",value:this._textureIndex},u_position:{type:"2f",value:[position.x,position.y]},u_size:{type:"2f",value:[size.x,size.y]}}})}},_renderCanvas:{value:function(renderer){var textCanvas=this._renderTextCanvas(renderer),canvas=renderer.getCanvas(),context=renderer.getContext(),canvasSize=new Vector2(canvas.width,canvas.height),scaledPosition=this._options.position.clone();"relative"===this._options.numberFormat&&scaledPosition.multiply(canvasSize),"center"===this._options.verticalAlignment?scaledPosition.y-=textCanvas.height/2:"bottom"===this._options.verticalAlignment&&(scaledPosition.y-=textCanvas.height),
"center"===this._options.alignment?scaledPosition.x-=textCanvas.width/2:"right"===this._options.alignment&&(scaledPosition.x-=textCanvas.width),context.drawImage(textCanvas,scaledPosition.x,scaledPosition.y)}},_renderTextCanvas:{value:function(renderer){var line=void 0,lineNum=void 0,canvas=renderer.createCanvas(),context=canvas.getContext("2d"),outputCanvas=renderer.getCanvas(),canvasSize=new Vector2(outputCanvas.width,outputCanvas.height),maxWidth=this._options.maxWidth,actualFontSize=this._options.fontSize*canvasSize.y,actualLineHeight=this._options.lineHeight*actualFontSize;"relative"===this._options.numberFormat&&(maxWidth*=renderer.getCanvas().width),this._applyTextOptions(renderer,context);var boundingBox=new Vector2,lines=this._options.text.split("\n");if("undefined"!=typeof maxWidth)boundingBox.x=maxWidth,lines=this._buildOutputLines(context,maxWidth);else for(lineNum=0;lineNum<lines.length;lineNum++)line=lines[lineNum],boundingBox.x=Math.max(boundingBox.x,context.measureText(line).width);for(boundingBox.y=actualLineHeight*lines.length,canvas.width=boundingBox.x,canvas.height=boundingBox.y,context=canvas.getContext("2d"),context.fillStyle=this._options.backgroundColor.toRGBA(),context.fillRect(0,0,canvas.width,canvas.height),this._applyTextOptions(renderer,context),lineNum=0;lineNum<lines.length;lineNum++)line=lines[lineNum],this._drawText(context,line,actualLineHeight*lineNum);return canvas}},_applyTextOptions:{value:function(renderer,context){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),actualFontSize=this._options.fontSize*canvasSize.y;context.font=this._options.fontWeight+" "+actualFontSize+"px "+this._options.fontFamily,context.textBaseline="top",context.textAlign=this._options.alignment,context.fillStyle=this._options.color.toRGBA()}},_buildOutputLines:{value:function(context,maxWidth){for(var inputLines=this._options.text.split("\n"),outputLines=[],currentChars=[],lineNum=0;lineNum<inputLines.length;lineNum++){var inputLine=inputLines[lineNum],lineChars=inputLine.split("");0===lineChars.length&&outputLines.push("");for(var charNum=0;charNum<lineChars.length;charNum++){var currentChar=lineChars[charNum];currentChars.push(currentChar);var currentLine=currentChars.join(""),lineWidth=context.measureText(currentLine).width;if(lineWidth>maxWidth&&1===currentChars.length)outputLines.push(currentChars[0]),currentChars=[];else if(lineWidth>maxWidth){var lastWord=currentChars.pop();outputLines.push(currentChars.join("")),currentChars=[],currentChars=[lastWord]}else charNum===lineChars.length-1&&(outputLines.push(currentChars.join("")),currentChars=[])}currentChars.length&&(outputLines.push(currentChars.join("")),currentChars=[])}return outputLines}},_drawText:{value:function(context,text,y){var canvas=context.canvas;"center"===this._options.alignment?context.fillText(text,canvas.width/2,y):"left"===this._options.alignment?context.fillText(text,0,y):"right"===this._options.alignment&&context.fillText(text,canvas.width,y)}}}),TextOperation}(Operation);TextOperation.prototype.identifier="text",module.exports=TextOperation},{"../lib/color":13,"../lib/math/vector2":18,"./operation":70}],76:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);if(null!==parent)return set(parent,property,value,receiver)}else{if("value"in desc&&desc.writable)return desc.value=value;var setter=desc.set;if(void 0!==setter)return setter.call(receiver,value)}},_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Operation=_interopRequire(require("./operation")),Vector2=_interopRequire(require("../lib/math/vector2")),StackBlur=_interopRequire(require("../vendor/stack-blur")),TiltShiftOperation=function(_Operation){function TiltShiftOperation(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,TiltShiftOperation),this.availableOptions={start:{type:"vector2","default":new Vector2(0,.5)},end:{type:"vector2","default":new Vector2(1,.5)},blurRadius:{type:"number","default":30},gradientRadius:{type:"number","default":50}},this.fragmentShader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      uniform float blurRadius;\n      uniform float gradientRadius;\n      uniform vec2 start;\n      uniform vec2 end;\n      uniform vec2 delta;\n      uniform vec2 texSize;\n      varying vec2 v_texCoord;\n\n      float random(vec3 scale, float seed) {\n        return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n      }\n\n      void main() {\n          vec4 color = vec4(0.0);\n          float total = 0.0;\n\n          float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n          vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n          float radius = smoothstep(0.0, 1.0, abs(dot(v_texCoord * texSize - start, normal)) / gradientRadius) * blurRadius;\n          for (float t = -30.0; t <= 30.0; t++) {\n              float percent = (t + offset - 0.5) / 30.0;\n              float weight = 1.0 - abs(percent);\n              vec4 sample = texture2D(u_image, v_texCoord + delta * percent * radius / texSize);\n\n              sample.rgb *= sample.a;\n\n              color += sample * weight;\n              total += weight;\n          }\n\n          gl_FragColor = color / total;\n          gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n      }\n    ",_get(Object.getPrototypeOf(TiltShiftOperation.prototype),"constructor",this).apply(this,args),this._cachedBlurredCanvas=null,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius}return _inherits(TiltShiftOperation,_Operation),_createClass(TiltShiftOperation,{_renderWebGL:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),start=this._options.start.clone(),end=this._options.end.clone();"relative"===this._options.numberFormat&&(start.multiply(canvasSize),end.multiply(canvasSize)),start.y=canvasSize.y-start.y,end.y=canvasSize.y-end.y;var delta=end.clone().subtract(start),d=Math.sqrt(delta.x*delta.x+delta.y*delta.y),uniforms={blurRadius:{type:"f",value:this._options.blurRadius},gradientRadius:{type:"f",value:this._options.gradientRadius},start:{type:"2f",value:[start.x,start.y]},end:{type:"2f",value:[end.x,end.y]},delta:{type:"2f",value:[delta.x/d,delta.y/d]},texSize:{type:"2f",value:[canvas.width,canvas.height]}};renderer.runShader(null,this.fragmentShader,{uniforms:uniforms}),uniforms.delta.value=[-delta.y/d,delta.x/d],renderer.runShader(null,this.fragmentShader,{uniforms:uniforms})}},_renderCanvas:{value:function(renderer){var canvas=renderer.getCanvas(),optionsChanged=this._options.blurRadius!==this._lastBlurRadius||this._options.gradientRadius!==this._lastGradientRadius,blurryCanvas=void 0;optionsChanged||null===this._cachedBlurredCanvas?(blurryCanvas=this._blurCanvas(renderer),this._cachedBlurredCanvas=blurryCanvas,this._lastBlurRadius=this._options.blurRadius,this._lastGradientRadius=this._options.gradientRadius):blurryCanvas=this._cachedBlurredCanvas;var maskCanvas=this._createMask(renderer);this._applyMask(canvas,blurryCanvas,maskCanvas)}},_blurCanvas:{value:function(renderer){var newCanvas=renderer.cloneCanvas(),blurryContext=newCanvas.getContext("2d"),blurryImageData=blurryContext.getImageData(0,0,newCanvas.width,newCanvas.height);return StackBlur.stackBlurCanvasRGBA(blurryImageData,0,0,newCanvas.width,newCanvas.height,this._options.blurRadius),blurryContext.putImageData(blurryImageData,0,0),newCanvas}},_createMask:{value:function(renderer){var canvas=renderer.getCanvas(),canvasSize=new Vector2(canvas.width,canvas.height),gradientRadius=this._options.gradientRadius,maskCanvas=renderer.createCanvas(canvas.width,canvas.height),maskContext=maskCanvas.getContext("2d"),start=this._options.start.clone(),end=this._options.end.clone();"relative"===this._options.numberFormat&&(start.multiply(canvasSize),end.multiply(canvasSize));var dist=end.clone().subtract(start),middle=start.clone().add(dist.clone().divide(2)),totalDist=Math.sqrt(Math.pow(dist.x,2)+Math.pow(dist.y,2)),factor=dist.clone().divide(totalDist),gradientStart=middle.clone().add(gradientRadius*factor.y,-gradientRadius*factor.x),gradientEnd=middle.clone().add(-gradientRadius*factor.y,gradientRadius*factor.x),gradient=maskContext.createLinearGradient(gradientStart.x,gradientStart.y,gradientEnd.x,gradientEnd.y);return gradient.addColorStop(0,"#000000"),gradient.addColorStop(.5,"#FFFFFF"),gradient.addColorStop(1,"#000000"),maskContext.fillStyle=gradient,maskContext.fillRect(0,0,canvas.width,canvas.height),maskCanvas}},_applyMask:{value:function(inputCanvas,blurryCanvas,maskCanvas){for(var inputContext=inputCanvas.getContext("2d"),blurryContext=blurryCanvas.getContext("2d"),maskContext=maskCanvas.getContext("2d"),inputImageData=inputContext.getImageData(0,0,inputCanvas.width,inputCanvas.height),pixels=inputImageData.data,blurryPixels=blurryContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,maskPixels=maskContext.getImageData(0,0,inputCanvas.width,inputCanvas.height).data,i=0;i<maskPixels.length;i++){var alpha=maskPixels[i]/255;pixels[i]=alpha*pixels[i]+(1-alpha)*blurryPixels[i]}inputContext.putImageData(inputImageData,0,0)}},dirty:{set:function(dirty){_set(Object.getPrototypeOf(TiltShiftOperation.prototype),"dirty",dirty,this),this._cachedBlurredCanvas=null},get:function(){return _get(Object.getPrototypeOf(TiltShiftOperation.prototype),"dirty",this)}}}),TiltShiftOperation}(Operation);TiltShiftOperation.prototype.identifier="tilt-shift",module.exports=TiltShiftOperation},{"../lib/math/vector2":18,"../vendor/stack-blur":103,"./operation":70}],77:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Renderer=_interopRequire(require("./renderer")),Vector2=_interopRequire(require("../lib/math/vector2")),CanvasRenderer=function(_Renderer){function CanvasRenderer(){_classCallCheck(this,CanvasRenderer),null!=_Renderer&&_Renderer.apply(this,arguments)}return _inherits(CanvasRenderer,_Renderer),_createClass(CanvasRenderer,{cache:{value:function(identifier){this._cache[identifier]={data:this._context.getImageData(0,0,this._canvas.width,this._canvas.height),size:new Vector2(this._canvas.width,this._canvas.height)}}},drawCached:{value:function(identifier){var _cache$identifier=this._cache[identifier],data=_cache$identifier.data,size=_cache$identifier.size;this._canvas.width=size.x,this._canvas.height=size.y,this._context.putImageData(data,0,0)}},_getContext:{value:function(){return this._canvas.getContext("2d")}},drawImage:{value:function(image){this._context.drawImage(image,0,0,image.width,image.height,0,0,this._canvas.width,this._canvas.height)}},resizeTo:{value:function(dimensions){var newCanvas=this.createCanvas();newCanvas.width=dimensions.x,newCanvas.height=dimensions.y;var newContext=newCanvas.getContext("2d");newContext.drawImage(this._canvas,0,0,this._canvas.width,this._canvas.height,0,0,newCanvas.width,newCanvas.height),this.setCanvas(newCanvas)}},cloneCanvas:{value:function(){var canvas=this.createCanvas(),context=canvas.getContext("2d");return canvas.width=this._canvas.width,canvas.height=this._canvas.height,context.drawImage(this._canvas,0,0),canvas}},reset:{value:function(){var resetCache=void 0===arguments[0]?!1:arguments[0];resetCache&&(this._cache=[])}}},{identifier:{get:function(){return"canvas"}},isSupported:{value:function(){var elem=this.prototype.createCanvas();return!(!elem.getContext||!elem.getContext("2d"))}}}),CanvasRenderer}(Renderer);module.exports=CanvasRenderer},{"../lib/math/vector2":18,"./renderer":78}],78:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Vector2=_interopRequire(require("../lib/math/vector2")),EventEmitter=_interopRequire(require("../lib/event-emitter")),Renderer=function(_EventEmitter){function Renderer(dimensions,canvas){_classCallCheck(this,Renderer),_get(Object.getPrototypeOf(Renderer.prototype),"constructor",this).call(this),this._canvas=canvas||this.createCanvas(),canvas||this.setSize(dimensions),this._context=this._getContext(),this._cache={}}return _inherits(Renderer,_EventEmitter),_createClass(Renderer,{identifier:{get:function(){return null}},cache:{value:function(){}},drawCached:{value:function(){}},createCanvas:{value:function(width,height){var canvas,isBrowser="undefined"!=typeof window;if(isBrowser)canvas=document.createElement("canvas");else{var Canvas=require("canvas");canvas=new Canvas}return"undefined"!=typeof width&&(canvas.width=width),"undefined"!=typeof height&&(canvas.height=height),canvas}},getSize:{value:function(){return new Vector2(this._canvas.width,this._canvas.height)}},setSize:{value:function(dimensions){this._canvas.width=dimensions.x,this._canvas.height=dimensions.y}},_getContext:{value:function(){throw new Error("Renderer#_getContext is abstract and not implemented in inherited class.")}},resizeTo:{value:function(){throw new Error("Renderer#resizeTo is abstract and not implemented in inherited class.")}},drawImage:{value:function(){throw new Error("Renderer#drawImage is abstract and not implemented in inherited class.")}},renderFinal:{value:function(){}},getCanvas:{value:function(){return this._canvas}},getContext:{value:function(){return this._context}},setCanvas:{value:function(canvas){this._canvas=canvas,this._context=this._getContext(),this.emit("new-canvas",this._canvas)}},setContext:{value:function(context){this._context=context}},reset:{value:function(){void 0===arguments[0]?!1:arguments[0]}}},{isSupported:{value:function(){throw new Error("Renderer#isSupported is abstract and not implemented in inherited class.")}}}),Renderer}(EventEmitter);module.exports=Renderer},{"../lib/event-emitter":14,"../lib/math/vector2":18,canvas:"canvas"}],79:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Renderer=_interopRequire(require("./renderer")),Vector2=_interopRequire(require("../lib/math/vector2")),WebGLRenderer=function(_Renderer){function WebGLRenderer(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,WebGLRenderer),_get(Object.getPrototypeOf(WebGLRenderer.prototype),"constructor",this).apply(this,args),this._defaultProgram=this.setupGLSLProgram(),this.reset()}return _inherits(WebGLRenderer,_Renderer),_createClass(WebGLRenderer,{identifier:{get:function(){return"webgl"}},cache:{value:function(identifier){var size=new Vector2(this._canvas.width,this._canvas.height),fbo=void 0,texture=void 0,cacheObject=void 0;cacheObject=this._cache[identifier]?this._cache[identifier]:this._createFramebuffer(),fbo=cacheObject.fbo,texture=cacheObject.texture;var gl=this._context;gl.useProgram(this._defaultProgram),gl.bindTexture(gl.TEXTURE_2D,texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.viewport(0,0,size.x,size.y),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture),gl.drawArrays(gl.TRIANGLES,0,6),this._cache[identifier]={fbo:fbo,texture:texture,size:size}}},_drawCachedFinal:{value:function(identifier){var _cache$identifier=this._cache[identifier],texture=_cache$identifier.texture,size=_cache$identifier.size,gl=this._context;gl.useProgram(this._defaultProgram),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.bindTexture(gl.TEXTURE_2D,texture),this._canvas.width=size.x,this._canvas.height=size.y,gl.viewport(0,0,size.x,size.y),gl.drawArrays(gl.TRIANGLES,0,6)}},drawCached:{value:function(identifier){var _cache$identifier=this._cache[identifier],texture=_cache$identifier.texture,size=_cache$identifier.size,fbo=this.getCurrentFramebuffer(),currentTexture=this.getCurrentTexture(),gl=this._context;gl.useProgram(this._defaultProgram),this._canvas.width=size.x,this._canvas.height=size.y;for(var i=0;i<this._textures.length;i++){var otherTexture=this._textures[i];gl.bindTexture(gl.TEXTURE_2D,otherTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null)}gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.bindTexture(gl.TEXTURE_2D,currentTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,size.x,size.y,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindTexture(gl.TEXTURE_2D,texture),gl.viewport(0,0,size.x,size.y),gl.drawArrays(gl.TRIANGLES,0,6),this.setLastTexture(currentTexture),this.selectNextBuffer()}},defaultVertexShader:{get:function(){var shader="\n      attribute vec2 a_position;\n      attribute vec2 a_texCoord;\n      varying vec2 v_texCoord;\n\n      void main() {\n        gl_Position = vec4(a_position, 0, 1);\n        v_texCoord = a_texCoord;\n      }\n    ";return shader}},defaultFragmentShader:{get:function(){var shader="\n      precision mediump float;\n      uniform sampler2D u_image;\n      varying vec2 v_texCoord;\n\n      void main() {\n        gl_FragColor = texture2D(u_image, v_texCoord);\n      }\n    ";return shader}},_getContext:{value:function(){return this._canvas.getContext("webgl")||this._canvas.getContext("webgl-experimental")}},drawImage:{value:function(image){var gl=this._context;gl.useProgram(this._defaultProgram);var texture=this.createTexture();gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),this._inputTexture=texture,this.setLastTexture(texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,image),gl.drawArrays(gl.TRIANGLES,0,6)}},runShader:{value:function(vertexShader,fragmentShader,options){"undefined"==typeof options&&(options={}),"undefined"==typeof options.uniforms&&(options.uniforms={});var gl=this._context,program=this.setupGLSLProgram(vertexShader,fragmentShader);gl.useProgram(program);var fbo=this.getCurrentFramebuffer(),currentTexture=this.getCurrentTexture();gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.bindTexture(gl.TEXTURE_2D,currentTexture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._canvas.width,this._canvas.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture);for(var name in options.uniforms){var location=gl.getUniformLocation(program,name),uniform=options.uniforms[name];switch(uniform.type){case"i":case"1i":gl.uniform1i(location,uniform.value);break;case"f":case"1f":gl.uniform1f(location,uniform.value);break;case"2f":gl.uniform2f(location,uniform.value[0],uniform.value[1]);break;case"3f":gl.uniform3f(location,uniform.value[0],uniform.value[1],uniform.value[2]);break;case"4f":gl.uniform4f(location,uniform.value[0],uniform.value[1],uniform.value[2],uniform.value[3]);break;case"2fv":gl.uniform2fv(location,uniform.value);break;case"mat3fv":gl.uniformMatrix3fv(location,!1,uniform.value);break;default:throw new Error("Unknown uniform type: "+uniform.type)}}gl.drawArrays(gl.TRIANGLES,0,6),this.setLastTexture(currentTexture),this.selectNextBuffer()}},renderFinal:{value:function(){var gl=this._context,program=this._defaultProgram;gl.useProgram(program),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.bindTexture(gl.TEXTURE_2D,this._lastTexture),gl.drawArrays(gl.TRIANGLES,0,6)}},setupGLSLProgram:{value:function(vertexShader,fragmentShader){var gl=this._context,shaders=[];vertexShader=this._createShader(gl.VERTEX_SHADER,vertexShader||WebGLRenderer.prototype.defaultVertexShader),shaders.push(vertexShader),fragmentShader=this._createShader(gl.FRAGMENT_SHADER,fragmentShader||WebGLRenderer.prototype.defaultFragmentShader),shaders.push(fragmentShader);for(var program=gl.createProgram(),i=0;i<shaders.length;i++)gl.attachShader(program,shaders[i]);gl.linkProgram(program);var linked=gl.getProgramParameter(program,gl.LINK_STATUS);if(!linked){var lastError=gl.getProgramInfoLog(program);throw gl.deleteProgram(program),new Error("WebGL program linking error: "+lastError)}var positionLocation=gl.getAttribLocation(program,"a_position"),texCoordLocation=gl.getAttribLocation(program,"a_texCoord"),texCoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,texCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),gl.STATIC_DRAW),gl.enableVertexAttribArray(texCoordLocation),gl.vertexAttribPointer(texCoordLocation,2,gl.FLOAT,!1,0,0);var buffer=gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.enableVertexAttribArray(positionLocation),gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,!1,0,0),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW),program}},_createShader:{value:function(shaderType,shaderSource){var gl=this._context,shader=gl.createShader(shaderType);gl.shaderSource(shader,shaderSource),gl.compileShader(shader);var compiled=gl.getShaderParameter(shader,gl.COMPILE_STATUS);if(!compiled){var lastError=gl.getShaderInfoLog(shader);throw gl.deleteShader(shader),new Error("WebGL shader compilation error: "+lastError)}return shader}},createTexture:{value:function(){var gl=this._context,texture=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),texture}},_createFramebuffers:{value:function(){for(var i=0;2>i;i++){var _createFramebuffer=this._createFramebuffer(),fbo=_createFramebuffer.fbo,texture=_createFramebuffer.texture;this._textures.push(texture),this._framebuffers.push(fbo)}}},_createFramebuffer:{value:function(){var gl=this._context,texture=this.createTexture();gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this._canvas.width,this._canvas.height,0,gl.RGBA,gl.UNSIGNED_BYTE,null);var fbo=gl.createFramebuffer();return gl.bindFramebuffer(gl.FRAMEBUFFER,fbo),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0),{fbo:fbo,texture:texture}}},resizeTo:{value:function(dimensions){var gl=this._context;this._canvas.width=dimensions.x,this._canvas.height=dimensions.y,gl.viewport(0,0,this._canvas.width,this._canvas.height),gl.drawArrays(gl.TRIANGLES,0,6)}},getCurrentFramebuffer:{value:function(){return this._framebuffers[this._bufferIndex%2]}},getCurrentTexture:{value:function(){return this._textures[this._bufferIndex%2]}},selectNextBuffer:{value:function(){this._bufferIndex++}},getDefaultProgram:{value:function(){return this._defaultProgram}},getLastTexture:{value:function(){return this._lastTexture}},getTextures:{value:function(){return this._textures}},setLastTexture:{value:function(texture){this._lastTexture=texture}},reset:{value:function(){var resetCache=void 0===arguments[0]?!1:arguments[0];this._lastTexture=null,this._textures=[],this._framebuffers=[],this._bufferIndex=0,resetCache&&(this._cache=[]),this._createFramebuffers(),this.setLastTexture(this._inputTexture)}}},{isSupported:{value:function(){return!("undefined"==typeof window||!window.WebGLRenderingContext)}}}),WebGLRenderer}(Renderer);module.exports=WebGLRenderer},{"../lib/math/vector2":18,"./renderer":78}],80:[function(require,module){"use strict";var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Helpers=function(){function Helpers(kit,ui,options){_classCallCheck(this,Helpers),this._kit=kit,this._ui=ui,this._options=options}return _createClass(Helpers,{assetPath:{value:function(asset){return this._options.assetsUrl+"/"+asset}}}),Helpers}();module.exports=Helpers},{}],81:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},dot=_interopRequire(require("dot")),Utils=_interopRequire(require("../../lib/utils")),EventEmitter=_interopRequire(require("../../lib/event-emitter")),Helpers=_interopRequire(require("./helpers")),BaseUI=function(_EventEmitter){function BaseUI(kit,options){_classCallCheck(this,BaseUI),_get(Object.getPrototypeOf(BaseUI.prototype),"constructor",this).call(this),this._kit=kit,this._options=options,this._options.ui=this._options.ui||{},this._operations=[],this._helpers=new Helpers(this.kit,this,options),this.selectOperations(null)}return _inherits(BaseUI,_EventEmitter),_createClass(BaseUI,{run:{value:function(){this._attach()}},identifier:{get:function(){return null}},_attach:{value:function(){if(null===this._options.container)throw new Error("BaseUI#attach: No container set.");var html=this._render();this._options.container.innerHTML=html,this._options.container.style.position="relative"}},_render:{value:function(){if("undefined"==typeof this._template)throw new Error("BaseUI#_render: No template set.");var renderFn=dot.template(this._template);return renderFn(this.context)}},selectOperations:{value:function(selector){var registeredOperations=this._kit.registeredOperations,operationIdentifiers=Object.keys(registeredOperations),selectedOperations=Utils.select(operationIdentifiers,selector);this._operations=selectedOperations.map(function(identifier){return registeredOperations[identifier]})}},addOperation:{value:function(operation){this._operations.push(operation)}},isOperationSelected:{value:function(identifier){var operationIdentifiers=this._operations.map(function(operation){return operation.prototype.identifier});return-1!==operationIdentifiers.indexOf(identifier)}},context:{get:function(){return{operations:this._operations,helpers:this._helpers,options:this._options}}},container:{get:function(){
return this._options.container}},operations:{get:function(){return this._operations}},options:{get:function(){return this._options}},canvas:{get:function(){return this._canvas}},helpers:{get:function(){return this._helpers}},image:{get:function(){return this._options.image}}}),BaseUI}(EventEmitter);module.exports=BaseUI},{"../../lib/event-emitter":14,"../../lib/utils":20,"./helpers":80,dot:10}],82:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Slider=_interopRequire(require("../lib/slider")),BrightnessControl=function(_Control){function BrightnessControl(){_classCallCheck(this,BrightnessControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(BrightnessControl,_Control),_createClass(BrightnessControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)}},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.brightness,this._operation=this._ui.getOrCreateOperation("brightness");var brightness=this._operation.getBrightness();this._initialBrightness=brightness;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:-1,maxValue:1,defaultValue:brightness}),this._slider.on("update",this._onUpdate.bind(this)),this._slider.setValue(this._initialBrightness)}},_onBack:{value:function(){var currentBrightness=this._operation.getBrightness();this._initialBrightness!==currentBrightness&&this._ui.addHistory(this._operation,{brightness:this._initialBrightness},this._operationExistedBefore),1===currentBrightness&&this._ui.removeOperation("brightness"),this._ui.canvas.render()}},_onUpdate:{value:function(value){this._operation.setBrightness(value),this._ui.canvas.render()}}}),BrightnessControl}(Control);BrightnessControl.prototype.identifier="brightness",module.exports=BrightnessControl},{"../lib/slider":100,"./control":84}],83:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Slider=_interopRequire(require("../lib/slider")),ContrastControl=function(_Control){function ContrastControl(){_classCallCheck(this,ContrastControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(ContrastControl,_Control),_createClass(ContrastControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)}},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.contrast,this._operation=this._ui.getOrCreateOperation("contrast");var contrast=this._operation.getContrast();this._initialContrast=contrast;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:0,maxValue:2,defaultValue:contrast}),this._slider.on("update",this._onUpdate.bind(this)),this._slider.setValue(this._initialContrast)}},_onBack:{value:function(){var currentContrast=this._operation.getContrast();this._initialContrast!==currentContrast&&this._ui.addHistory(this._operation,{contrast:this._initialContrast},this._operationExistedBefore),1===currentContrast&&this._ui.removeOperation("contrast"),this._ui.canvas.render()}},_onUpdate:{value:function(value){this._operation.setContrast(value),this._ui.canvas.render()}}}),ContrastControl}(Control);ContrastControl.prototype.identifier="contrast",module.exports=ContrastControl},{"../lib/slider":100,"./control":84}],84:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},dot=_interopRequire(require("dot")),Helpers=_interopRequire(require("../../base/helpers")),EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Scrollbar=_interopRequire(require("../lib/scrollbar")),Control=function(_EventEmitter){function Control(kit,ui,operation){_classCallCheck(this,Control),_get(Object.getPrototypeOf(Control.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._operation=operation,this._helpers=new Helpers(this._kit,this._ui,this._ui.options),this._partialTemplates=[],this._active=!1,this.init()}return _inherits(Control,_EventEmitter),_createClass(Control,{setContainers:{value:function(controlsContainer,canvasControlsContainer){this._controlsContainer=controlsContainer,this._canvasControlsContainer=canvasControlsContainer}},init:{value:function(){}},_renderAllControls:{value:function(){this._renderControls(),this._renderCanvasControls(),this._initScrollbar()}},_renderControls:{value:function(){if("undefined"==typeof this._controlsTemplate)throw new Error("Control#_renderOverviewControls: Control needs to define this._controlsTemplate.");var template=this._partialTemplates.concat([this._controlsTemplate]).join("\r\n"),renderFn=dot.template(template),html=renderFn(this.context);"undefined"!=typeof this._controls&&null!==this._controls.parentNode&&this._controls.parentNode.removeChild(this._controls),this._controls=document.createElement("div"),this._controls.innerHTML=html,this._controlsContainer.appendChild(this._controls)}},_renderCanvasControls:{value:function(){if("undefined"!=typeof this._canvasControlsTemplate){var template=this._partialTemplates.concat([this._canvasControlsTemplate]).join("\r\n"),renderFn=dot.template(template),html=renderFn(this.context);this._canvasControls=document.createElement("div"),this._canvasControls.innerHTML=html,this._canvasControlsContainer.appendChild(this._canvasControls)}}},_initScrollbar:{value:function(){var list=this._controls.querySelector(".imglykit-controls-list");list&&(this._scrollbar=new Scrollbar(list.parentNode))}},_removeControls:{value:function(){this._controls.parentNode.removeChild(this._controls),this._canvasControls&&this._canvasControls.parentNode.removeChild(this._canvasControls),this._scrollbar&&this._scrollbar.remove()}},_handleBackAndDoneButtons:{value:function(){this._backButton=this._controls.querySelector(".imglykit-controls-back"),this._backButton&&this._backButton.addEventListener("click",this._onBackButtonClick.bind(this)),this._doneButton=this._controls.querySelector(".imglykit-controls-done"),this._doneButton&&this._doneButton.addEventListener("click",this._onDoneButtonClick.bind(this))}},_onBackButtonClick:{value:function(){this._onBack(),this.emit("back")}},_onDoneButtonClick:{value:function(){this._onDone(),this.emit("back")}},_highlightDoneButton:{value:function(){this._doneButton.classList.add("highlighted")}},enter:{value:function(){this._active=!0,this._ui.hideZoom(),this._renderAllControls(),this._handleBackAndDoneButtons(),this._enableCanvasControls(),this._onEnter()}},leave:{value:function(){this._active=!1,this._ui.showZoom(),this._removeControls(),this._disableCanvasControls(),this._onLeave()}},_enableCanvasControls:{value:function(){this._canvasControlsContainer.classList.remove("imglykit-canvas-controls-disabled")}},_disableCanvasControls:{value:function(){this._canvasControlsContainer.classList.add("imglykit-canvas-controls-disabled")}},_onEnter:{value:function(){}},_onLeave:{value:function(){}},_onBack:{value:function(){}},_onDone:{value:function(){}},onZoom:{value:function(){}},context:{get:function(){return{helpers:this._helpers}}}}),Control}(EventEmitter);Control.prototype.identifier=null;var extend=_interopRequire(require("../../../lib/extend"));Control.extend=extend,module.exports=Control},{"../../../lib/event-emitter":14,"../../../lib/extend":15,"../../base/helpers":80,"../lib/scrollbar":98,dot:10}],85:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),CropControl=function(_Control){function CropControl(){_classCallCheck(this,CropControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(CropControl,_Control),_createClass(CropControl,{init:{value:function(){this._availableRatios={},this._ratios={};var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.ratios) { }}\n        {{ var ratio = it.ratios[identifier]; }}\n        {{ var enabled = ratio.selected; }}\n        <li data-identifier="{{= identifier}}" data-ratio="{{= ratio.ratio}}"{{? enabled}} data-selected{{?}}>\n          <img src="{{=it.helpers.assetPath(\'ui/night/crop/\' + identifier + \'.png\')}}" />\n        </li>\n      {{ } }}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-crop-container">\n  <div class="imglykit-canvas-crop-top">\n    <div class="imglykit-canvas-crop-top-left"></div>\n    <div class="imglykit-canvas-crop-top-center"></div>\n    <div class="imglykit-canvas-crop-top-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-center">\n    <div class="imglykit-canvas-crop-center-left"></div>\n    <div class="imglykit-canvas-crop-center-center">\n      <div class="imglykit-canvas-crop-knobs">\n        <div data-corner="top-left"></div>\n        <div data-corner="top-right"></div>\n        <div data-corner="bottom-left"></div>\n        <div data-corner="bottom-right"></div>\n      </div>\n    </div>\n    <div class="imglykit-canvas-crop-center-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-bottom">\n    <div class="imglykit-canvas-crop-bottom-left"></div>\n    <div class="imglykit-canvas-crop-bottom-center"></div>\n    <div class="imglykit-canvas-crop-bottom-right"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._onKnobDown=this._onKnobDown.bind(this),this._onKnobDrag=this._onKnobDrag.bind(this),this._onKnobUp=this._onKnobUp.bind(this),this._onCenterDown=this._onCenterDown.bind(this),this._onCenterDrag=this._onCenterDrag.bind(this),this._onCenterUp=this._onCenterUp.bind(this),this._addDefaultRatios(),this.selectRatios(null)}},selectRatios:{value:function(selector){this._ratios={};for(var ratioIdentifiers=Object.keys(this._availableRatios),selectedRatios=Utils.select(ratioIdentifiers,selector),i=0;i<selectedRatios.length;i++){var identifier=selectedRatios[i];this._ratios[identifier]=this._availableRatios[identifier]}this._active&&this._renderControls()}},_addDefaultRatios:{value:function(){this.addRatio("custom","*",!0),this.addRatio("square","1"),this.addRatio("4-3","1.33"),this.addRatio("16-9","1.77")}},addRatio:{value:function(identifier,ratio,selected){this._availableRatios[identifier]={ratio:ratio,selected:selected}}},_onEnter:{value:function(){var _this=this;_get(Object.getPrototypeOf(CropControl.prototype),"_onEnter",this).call(this),this._operationExistedBefore=!!this._ui.operations.crop,this._operation=this._ui.getOrCreateOperation("crop"),this._defaultStart=new Vector2(.1,.1),this._defaultEnd=new Vector2(.9,.9),this._initialOptions={start:this._operation.getStart(),end:this._operation.getEnd()},this._start=this._initialOptions.start||this._defaultStart,this._end=this._initialOptions.end||this._defaultEnd,this._minimumSize=new Vector2(50,50),this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(!1);var prefix=".imglykit-canvas-crop",container=this._canvasControls,knobsContainer=container.querySelector(""+prefix+"-knobs");this._initialStart=this._operation.getStart().clone(),this._initialEnd=this._operation.getEnd().clone(),this._operation.set({start:new Vector2(0,0),end:new Vector2(1,1)}),this._knobs={topLeft:knobsContainer.querySelector("[data-corner=top-left]"),topRight:knobsContainer.querySelector("[data-corner=top-right]"),bottomLeft:knobsContainer.querySelector("[data-corner=bottom-left]"),bottomRight:knobsContainer.querySelector("[data-corner=bottom-right]")},this._areas={topLeft:this._canvasControls.querySelector(""+prefix+"-top-left"),topCenter:this._canvasControls.querySelector(""+prefix+"-top-center"),centerLeft:this._canvasControls.querySelector(""+prefix+"-center-left"),centerCenter:this._canvasControls.querySelector(""+prefix+"-center-center")},this._handleControls(),this._handleKnobs(),this._handleCenter(),this._ui.canvas.render().then(function(){_this._updateDOM()})}},_handleControls:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("ul > li");this._ratioItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._ratioItems.length;i++){var _item$dataset;!function(i){var item=_this._ratioItems[i];_item$dataset=item.dataset;var selected=_item$dataset.selected,ratio=_item$dataset.ratio,identifier=_item$dataset.identifier;"undefined"==typeof selected||_this._operationExistedBefore||(_this._setRatio(identifier,ratio,!1),_this._selectRatio(item)),item.addEventListener("click",function(e){e.preventDefault(),_this._onRatioClick(item)})}(i)}}},_onRatioClick:{value:function(item){this._unselectAllRatios(),this._selectRatio(item)}},_unselectAllRatios:{value:function(){for(var i=0;i<this._ratioItems.length;i++){var item=this._ratioItems[i];item.classList.remove("imglykit-controls-item-active")}}},_selectRatio:{value:function(item){item.classList.add("imglykit-controls-item-active");var _item$dataset=item.dataset,ratio=_item$dataset.ratio,identifier=_item$dataset.identifier;this._setRatio(identifier,ratio)}},_setRatio:{value:function(identifier,ratio){var resize=void 0===arguments[2]?!0:arguments[2],canvasSize=this._ui.canvas.size;if(this._selectedRatio=identifier,"*"===ratio)this._ratio=null,this._start=new Vector2(.1,.1),this._end=new Vector2(.9,.9);else if("original"===ratio?this._ratio=canvasSize.x/canvasSize.y:(ratio=parseFloat(ratio),this._ratio=ratio),resize)if(canvasSize.x/canvasSize.y<=this._ratio){this._start.x=.1,this._end.x=.9;var height=1/canvasSize.y*(canvasSize.x/this._ratio)*.8;this._start.y=(1-height)/2,this._end.y=1-this._start.y}else{this._start.y=.1,this._end.y=.9;var width=1/canvasSize.x*this._ratio*canvasSize.y*.8;this._start.x=(1-width)/2,this._end.x=1-this._start.x}this._updateDOM()}},_updateDOM:{value:function(){var canvasSize=this._ui.canvas.size,startAbsolute=this._start.clone().multiply(canvasSize),endAbsolute=this._end.clone().multiply(canvasSize),size=endAbsolute.clone().subtract(startAbsolute),top=Math.max(1,startAbsolute.y),left=Math.max(1,startAbsolute.x),width=Math.max(1,size.x),height=Math.max(1,size.y);this._areas.topLeft.style.width=""+left+"px",this._areas.topCenter.style.width=""+width+"px",this._areas.topLeft.style.height=""+top+"px",this._areas.centerLeft.style.height=""+height+"px"}},_handleKnobs:{value:function(){var _this=this;for(var identifier in this._knobs)!function(identifier){var knob=_this._knobs[identifier];knob.addEventListener("mousedown",function(e){_this._onKnobDown(e,knob)}),knob.addEventListener("touchstart",function(e){_this._onKnobDown(e,knob)})}(identifier)}},_onKnobDown:{value:function(e,knob){e.preventDefault(),e.stopPropagation(),this._currentKnob=knob,this._initialMousePosition=Utils.getEventPosition(e),this._startBeforeDrag=this._start.clone(),this._endBeforeDrag=this._end.clone(),document.addEventListener("mousemove",this._onKnobDrag),document.addEventListener("touchmove",this._onKnobDrag),document.addEventListener("mouseup",this._onKnobUp),document.addEventListener("touchend",this._onKnobUp)}},_onKnobDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),corner=this._currentKnob.dataset.corner,canvasSize=this._ui.canvas.size,absoluteStart=this._startBeforeDrag.clone().multiply(canvasSize),absoluteEnd=this._endBeforeDrag.clone().multiply(canvasSize),maxHeight=canvasSize.y,width=void 0,height=void 0,maximum=void 0,minimum=void 0;switch(corner){case"top-left":absoluteStart.add(mouseDiff),maximum=absoluteEnd.clone().subtract(this._minimumSize),absoluteStart.clamp(null,maximum);break;case"top-right":absoluteEnd.x+=mouseDiff.x,absoluteStart.y+=mouseDiff.y,absoluteEnd.x=Math.max(absoluteStart.x+this._minimumSize.x,absoluteEnd.x),absoluteStart.y=Math.min(absoluteEnd.y-this._minimumSize.y,absoluteStart.y);break;case"bottom-right":absoluteEnd.add(mouseDiff),minimum=absoluteStart.clone().add(this._minimumSize),absoluteEnd.clamp(minimum),maxHeight=canvasSize.y-absoluteStart.y;break;case"bottom-left":absoluteStart.x+=mouseDiff.x,absoluteEnd.y+=mouseDiff.y,absoluteStart.x=Math.min(absoluteEnd.x-this._minimumSize.x,absoluteStart.x),absoluteEnd.y=Math.max(absoluteStart.y+this._minimumSize.y,absoluteEnd.y)}if(this._start.copy(absoluteStart).divide(canvasSize),this._end.copy(absoluteEnd).divide(canvasSize),this._start.clamp(0,1),this._end.clamp(0,1),null!==this._ratio)switch(corner){case"top-left":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._start.y=this._end.y-height/canvasSize.y,this._start.y<=0&&(this._start.y=0,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._start.x=this._end.x-width/canvasSize.x);break;case"top-right":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._start.y=this._end.y-height/canvasSize.y,this._start.y<=0&&(this._start.y=0,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._end.x=this._start.x+width/canvasSize.x);break;case"bottom-right":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._end.y=this._start.y+height/canvasSize.y,this._end.y>=1&&(this._end.y=1,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._end.x=this._start.x+width/canvasSize.x);break;case"bottom-left":width=(this._end.x-this._start.x)*canvasSize.x,height=width/this._ratio,this._end.y=this._start.y+height/canvasSize.y,this._end.y>=1&&(this._end.y=1,height=(this._end.y-this._start.y)*canvasSize.y,width=height*this._ratio,this._start.x=this._end.x-width/canvasSize.x)}this._updateDOM()}},_onKnobUp:{value:function(){this._currentKnob=null,document.removeEventListener("mousemove",this._onKnobDrag),document.removeEventListener("touchmove",this._onKnobDrag),document.removeEventListener("mouseup",this._onKnobUp),document.removeEventListener("touchend",this._onKnobUp)}},_handleCenter:{value:function(){this._areas.centerCenter.addEventListener("mousedown",this._onCenterDown),this._areas.centerCenter.addEventListener("touchstart",this._onCenterDown)}},_onCenterDown:{value:function(e){this._initialMousePosition=Utils.getEventPosition(e),this._startBeforeDrag=this._start.clone(),this._endBeforeDrag=this._end.clone(),document.addEventListener("mousemove",this._onCenterDrag),document.addEventListener("touchmove",this._onCenterDrag),document.addEventListener("mouseup",this._onCenterUp),document.addEventListener("touchend",this._onCenterUp)}},_onCenterDrag:{value:function(e){var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),canvasSize=this._ui.canvas.size,cropSize=this._endBeforeDrag.clone().subtract(this._startBeforeDrag),absoluteCropSize=cropSize.clone().multiply(canvasSize),absoluteStart=this._startBeforeDrag.clone().multiply(canvasSize),absoluteEnd=this._endBeforeDrag.clone().multiply(canvasSize);absoluteStart.add(mouseDiff);var maxStart=canvasSize.clone().subtract(absoluteCropSize);absoluteStart.clamp(new Vector2(0,0),maxStart),absoluteEnd.copy(absoluteStart).add(absoluteCropSize),this._start.copy(absoluteStart).divide(canvasSize),this._end.copy(absoluteEnd).divide(canvasSize),this._updateDOM()}},_onCenterUp:{value:function(){document.removeEventListener("mousemove",this._onCenterDrag),document.removeEventListener("touchmove",this._onCenterDrag),document.removeEventListener("mouseup",this._onCenterUp),document.removeEventListener("touchend",this._onCenterUp)}},_onBack:{value:function(){this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operationExistedBefore?this._operation.set({start:this._initialStart,end:this._initialEnd}):this._ui.removeOperation("crop"),this._ui.canvas.render()}},_onDone:{value:function(){this._operation.set({start:this._start,end:this._end}),this._ui.canvas.zoomToFit(!0),this._ui.addHistory(this._operation,{start:this._initialStart.clone(),end:this._initialEnd.clone()},this._operationExistedBefore)}},context:{get:function(){var context=_get(Object.getPrototypeOf(CropControl.prototype),"context",this);return context.ratios=this._ratios,context}},selectedRatio:{get:function(){return this._selectedRatio}}}),CropControl}(Control);CropControl.prototype.identifier="crop",module.exports=CropControl},{"../../../lib/math/vector2":18,"../../../lib/utils":20,"./control":84}],86:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Utils=_interopRequire(require("../../../lib/utils")),FiltersControl=function(_Control){function FiltersControl(){_classCallCheck(this,FiltersControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(FiltersControl,_Control),_createClass(FiltersControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.filters) { }}\n        {{ var filter = it.filters[identifier]; }}\n        {{ var name = filter.prototype.name; }}\n        {{ var enabled = it.activeFilter.identifier === identifier; }}\n        <li data-identifier="{{= identifier}}" class="imglykit-controls-item-with-label{{? enabled}} imglykit-controls-item-active{{?}}">\n          <img src="{{=it.helpers.assetPath(\'ui/night/filters/\' + identifier + \'.png\')}}" />\n          <div class="imglykit-controls-item-label">{{= name }}</div>\n        </li>\n      {{ } }}\n    </ul>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._availableFilters={},this._filters={},this._addDefaultFilters(),this.selectFilters(null)}},_renderAllControls:{value:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];this._operationExistedBefore=!!this._ui.operations.filters,this._operation=this._ui.getOrCreateOperation("filters"),_get(Object.getPrototypeOf(FiltersControl.prototype),"_renderAllControls",this).apply(this,args)}},_onEnter:{value:function(){var _this=this;this._initialFilter=this._operation.getFilter(),this._defaultFilter=this._operation.availableOptions.filter["default"];var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)})}(i)}},_onBack:{value:function(){var currentFilter=this._operation.getFilter();currentFilter!==this._initialFilter&&this._ui.addHistory(this._operation,{filter:this._initialFilter},this._operationExistedBefore),currentFilter===this._defaultFilter&&this._ui.removeOperation("filters"),this._ui.canvas.render()}},_onListItemClick:{value:function(item){this._deactivateAllItems();var identifier=item.dataset.identifier;this._operation.setFilter(this._filters[identifier]),this._ui.canvas.render(),item.classList.add("imglykit-controls-item-active")}},_deactivateAllItems:{value:function(){for(var i=0;i<this._listItems.length;i++){var listItem=this._listItems[i];listItem.classList.remove("imglykit-controls-item-active")}}},_addDefaultFilters:{value:function(){this.addFilter(require("../../../operations/filters/identity-filter")),this.addFilter(require("../../../operations/filters/k1-filter")),this.addFilter(require("../../../operations/filters/k2-filter")),this.addFilter(require("../../../operations/filters/k6-filter")),this.addFilter(require("../../../operations/filters/kdynamic-filter")),this.addFilter(require("../../../operations/filters/fridge-filter")),this.addFilter(require("../../../operations/filters/breeze-filter")),this.addFilter(require("../../../operations/filters/orchid-filter")),this.addFilter(require("../../../operations/filters/chest-filter")),this.addFilter(require("../../../operations/filters/front-filter")),this.addFilter(require("../../../operations/filters/fixie-filter")),this.addFilter(require("../../../operations/filters/x400-filter")),this.addFilter(require("../../../operations/filters/bw-filter")),this.addFilter(require("../../../operations/filters/bwhard-filter")),this.addFilter(require("../../../operations/filters/lenin-filter")),this.addFilter(require("../../../operations/filters/quozi-filter")),this.addFilter(require("../../../operations/filters/pola669-filter")),this.addFilter(require("../../../operations/filters/pola-filter")),this.addFilter(require("../../../operations/filters/food-filter")),this.addFilter(require("../../../operations/filters/glam-filter")),this.addFilter(require("../../../operations/filters/celsius-filter")),this.addFilter(require("../../../operations/filters/texas-filter")),this.addFilter(require("../../../operations/filters/morning-filter")),this.addFilter(require("../../../operations/filters/lomo-filter")),this.addFilter(require("../../../operations/filters/gobblin-filter")),this.addFilter(require("../../../operations/filters/mellow-filter")),this.addFilter(require("../../../operations/filters/sunny-filter")),
this.addFilter(require("../../../operations/filters/a15-filter")),this.addFilter(require("../../../operations/filters/semired-filter"))}},addFilter:{value:function(filter){this._availableFilters[filter.identifier]=filter}},selectFilters:{value:function(selector){this._filters={};for(var filterIdentifiers=Object.keys(this._availableFilters),selectedFilters=Utils.select(filterIdentifiers,selector),i=0;i<selectedFilters.length;i++){var identifier=selectedFilters[i];this._filters[identifier]=this._availableFilters[identifier]}this._active&&this._renderControls()}},context:{get:function(){var context=_get(Object.getPrototypeOf(FiltersControl.prototype),"context",this);return context.filters=this._filters,context.activeFilter=this._operation.getFilter(),context}}}),FiltersControl}(Control);FiltersControl.prototype.identifier="filters",module.exports=FiltersControl},{"../../../lib/utils":20,"../../../operations/filters/a15-filter":25,"../../../operations/filters/breeze-filter":26,"../../../operations/filters/bw-filter":27,"../../../operations/filters/bwhard-filter":28,"../../../operations/filters/celsius-filter":29,"../../../operations/filters/chest-filter":30,"../../../operations/filters/fixie-filter":32,"../../../operations/filters/food-filter":33,"../../../operations/filters/fridge-filter":34,"../../../operations/filters/front-filter":35,"../../../operations/filters/glam-filter":36,"../../../operations/filters/gobblin-filter":37,"../../../operations/filters/identity-filter":38,"../../../operations/filters/k1-filter":39,"../../../operations/filters/k2-filter":40,"../../../operations/filters/k6-filter":41,"../../../operations/filters/kdynamic-filter":42,"../../../operations/filters/lenin-filter":43,"../../../operations/filters/lomo-filter":44,"../../../operations/filters/mellow-filter":45,"../../../operations/filters/morning-filter":46,"../../../operations/filters/orchid-filter":47,"../../../operations/filters/pola-filter":48,"../../../operations/filters/pola669-filter":49,"../../../operations/filters/quozi-filter":63,"../../../operations/filters/semired-filter":64,"../../../operations/filters/sunny-filter":65,"../../../operations/filters/texas-filter":66,"../../../operations/filters/x400-filter":67,"./control":84}],87:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),FlipControl=function(_Control){function FlipControl(){_classCallCheck(this,FlipControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(FlipControl,_Control),_createClass(FlipControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      <li data-direction="horizontal">\n        <img src="{{=it.helpers.assetPath(\'ui/night/flip/horizontal.png\')}}" />\n      </li>\n      <li data-direction="vertical">\n        <img src="{{=it.helpers.assetPath(\'ui/night/flip/vertical.png\')}}" />\n      </li>\n    </ul>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.flip,this._operation=this._ui.getOrCreateOperation("flip"),this._initialHorizontal=this._operation.getHorizontal(),this._initialVertical=this._operation.getVertical();var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)});var direction=listItem.dataset.direction;"horizontal"===direction&&_this._operation.getHorizontal()?_this._toggleItem(listItem,!0):"vertical"===direction&&_this._operation.getVertical()&&_this._toggleItem(listItem,!0)}(i)}},_onListItemClick:{value:function(item){var direction=item.dataset.direction,active=!1;if("horizontal"===direction){var currentHorizontal=this._operation.getHorizontal();this._operation.setHorizontal(!currentHorizontal),this._ui.canvas.render(),active=!currentHorizontal}else if("vertical"===direction){var currentVertical=this._operation.getVertical();this._operation.setVertical(!currentVertical),this._ui.canvas.render(),active=!currentVertical}this._toggleItem(item,active)}},_toggleItem:{value:function(item,active){var activeClass="imglykit-controls-item-active";active?item.classList.add(activeClass):item.classList.remove(activeClass)}},_onBack:{value:function(){var currentVertical=this._operation.getVertical(),currentHorizontal=this._operation.getHorizontal();(this._initialVertical!==currentVertical||this._initialHorizontal!==currentHorizontal)&&this._ui.addHistory(this._operation,{vertical:this._initialVertical,horizontal:this._initialHorizontal},this._operationExistedBefore),currentVertical||currentHorizontal||this._ui.removeOperation("flip"),this._ui.canvas.render()}}}),FlipControl}(Control);FlipControl.prototype.identifier="flip",module.exports=FlipControl},{"./control":84}],88:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),ColorPicker=_interopRequire(require("../lib/color-picker")),FramesControl=function(_Control){function FramesControl(){_classCallCheck(this,FramesControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(FramesControl,_Control),_createClass(FramesControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerLabel = "Color";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n    <div class="imglykit-controls-done-highlighted">\n      <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done-highlighted.png\') }}" />\n    </div>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(SimpleSlider.template),this._partialTemplates.push(ColorPicker.template)}},_onEnter:{value:function(){this._operationExistedBefore=!!this._ui.operations.frames,this._operation=this._ui.getOrCreateOperation("frames"),this._initialOptions={thickness:this._operation.getThickness(),color:this._operation.getColor()},this._ui.canvas.render();var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new SimpleSlider(sliderElement,{minValue:0,maxValue:.5}),this._slider.on("update",this._onThicknessUpdate.bind(this)),this._slider.setValue(this._initialOptions.thickness);var colorPickerElement=this._controls.querySelector(".imglykit-color-picker");this._colorPicker=new ColorPicker(this._ui,colorPickerElement),this._colorPicker.on("update",this._onColorUpdate.bind(this)),this._colorPicker.setValue(this._initialOptions.color)}},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialOptions):this._ui.removeOperation("frames"),this._ui.canvas.render()}},_onThicknessUpdate:{value:function(value){this._operation.setThickness(value),this._ui.canvas.render(),this._highlightDoneButton()}},_onColorUpdate:{value:function(value){this._operation.setColor(value),this._ui.canvas.render(),this._highlightDoneButton()}},_onDone:{value:function(){this._ui.addHistory(this._operation,{color:this._initialOptions.color,thickness:this._initialOptions.thickness},this._operationExistedBefore)}}}),FramesControl}(Control);FramesControl.prototype.identifier="frames",module.exports=FramesControl},{"../lib/color-picker":96,"../lib/simple-slider":99,"./control":84}],89:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),RadialBlurControl=function(_Control){function RadialBlurControl(){_classCallCheck(this,RadialBlurControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(RadialBlurControl,_Control),_createClass(RadialBlurControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-radial-blur">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div class="imglykit-controls-icon">\n    <img src="{{=it.helpers.assetPath(\'ui/night/blur/blur.png\')}}" />\n  </div>\n\n  <div>\n    {{var sliderId = "imglykit-blur-radius-slider";}}\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n    <div class="imglykit-controls-done-highlighted">\n      <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done-highlighted.png\') }}" />\n    </div>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-radial-blur-container">\n  <div class="imglykit-canvas-radial-blur-dot" id="imglykit-radial-blur-position"></div>\n  <div class="imglykit-canvas-radial-blur-dot" id="imglykit-radial-blur-gradient"></div>\n  <div class="imglykit-canvas-radial-blur-circle-container">\n    <div class="imglykit-canvas-radial-blur-circle"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(SimpleSlider.template)}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations["radial-blur"],this._operation=this._ui.getOrCreateOperation("radial-blur"),this._initialSettings={position:this._operation.getPosition().clone(),gradientRadius:this._operation.getGradientRadius(),blurRadius:this._operation.getBlurRadius()},this._onPositionKnobDown=this._onPositionKnobDown.bind(this),this._onPositionKnobDrag=this._onPositionKnobDrag.bind(this),this._onPositionKnobUp=this._onPositionKnobUp.bind(this),this._onGradientKnobDown=this._onGradientKnobDown.bind(this),this._onGradientKnobDrag=this._onGradientKnobDrag.bind(this),this._onGradientKnobUp=this._onGradientKnobUp.bind(this),this._positionKnob=this._canvasControls.querySelector("#imglykit-radial-blur-position"),this._gradientKnob=this._canvasControls.querySelector("#imglykit-radial-blur-gradient"),this._circle=this._canvasControls.querySelector(".imglykit-canvas-radial-blur-circle"),this._handleKnobs(),this._initSliders(),this._ui.canvas.render().then(function(){_this._updateDOM()})}},_initSliders:{value:function(){var blurRadiusSlider=this._controls.querySelector("#imglykit-blur-radius-slider");this._blurRadiusSlider=new SimpleSlider(blurRadiusSlider,{minValue:0,maxValue:40}),this._blurRadiusSlider.on("update",this._onBlurRadiusUpdate.bind(this)),this._blurRadiusSlider.setValue(this._initialSettings.blurRadius)}},_onBlurRadiusUpdate:{value:function(value){this._operation.setBlurRadius(value),this._ui.canvas.render(),this._highlightDoneButton()}},_handleKnobs:{value:function(){var canvasSize=this._ui.canvas.size,position=this._operation.getPosition().clone().multiply(canvasSize);this._gradientKnobPosition=position.clone().add(this._initialSettings.gradientRadius,0),this._positionKnob.addEventListener("mousedown",this._onPositionKnobDown),this._positionKnob.addEventListener("touchstart",this._onPositionKnobDown),this._gradientKnob.addEventListener("mousedown",this._onGradientKnobDown),this._gradientKnob.addEventListener("touchstart",this._onGradientKnobDown)}},_onPositionKnobDown:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size;this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._operation.getPosition().clone(),this._gradientKnobDistance=this._gradientKnobPosition.clone().subtract(this._initialPosition.clone().multiply(canvasSize)),document.addEventListener("mousemove",this._onPositionKnobDrag),document.addEventListener("touchmove",this._onPositionKnobDrag),document.addEventListener("mouseup",this._onPositionKnobUp),document.addEventListener("touchend",this._onPositionKnobUp)}},_onPositionKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),newPosition=this._initialPosition.clone().multiply(canvasSize).add(diff),maxPosition=canvasSize.clone().subtract(this._gradientKnobDistance);newPosition.clamp(new Vector2(0,0),maxPosition),this._gradientKnobPosition.copy(newPosition).add(this._gradientKnobDistance),newPosition.divide(canvasSize),this._operation.setPosition(newPosition),this._updateDOM(),this._ui.canvas.render()}},_onPositionKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onPositionKnobDrag),document.removeEventListener("touchmove",this._onPositionKnobDrag),document.removeEventListener("mouseup",this._onPositionKnobUp),document.removeEventListener("touchend",this._onPositionKnobUp)}},_onGradientKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialGradientKnobPosition=this._gradientKnobPosition.clone(),document.addEventListener("mousemove",this._onGradientKnobDrag),document.addEventListener("touchmove",this._onGradientKnobDrag),document.addEventListener("mouseup",this._onGradientKnobUp),document.addEventListener("touchend",this._onGradientKnobUp)}},_onGradientKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition);this._gradientKnobPosition=this._initialGradientKnobPosition.clone().add(diff),this._gradientKnobPosition.clamp(new Vector2(0,0),canvasSize);var position=this._operation.getPosition().clone().multiply(canvasSize),distance=this._gradientKnobPosition.clone().subtract(position),gradientRadius=Math.sqrt(Math.pow(distance.x,2)+Math.pow(distance.y,2));this._operation.setGradientRadius(gradientRadius),this._updateDOM(),this._ui.canvas.render()}},_onGradientKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onGradientKnobDrag),document.removeEventListener("touchmove",this._onGradientKnobDrag),document.removeEventListener("mouseup",this._onGradientKnobUp),document.removeEventListener("touchend",this._onGradientKnobUp)}},_updateDOM:{value:function(){var canvasSize=this._ui.canvas.size,position=this._operation.getPosition().clone().multiply(canvasSize);this._positionKnob.style.left=""+position.x+"px",this._positionKnob.style.top=""+position.y+"px",this._gradientKnob.style.left=""+this._gradientKnobPosition.x+"px",this._gradientKnob.style.top=""+this._gradientKnobPosition.y+"px";var circleSize=2*this._operation.getGradientRadius();this._circle.style.left=""+position.x+"px",this._circle.style.top=""+position.y+"px",this._circle.style.width=""+circleSize+"px",this._circle.style.height=""+circleSize+"px",this._circle.style.marginLeft="-"+circleSize/2+"px",this._circle.style.marginTop="-"+circleSize/2+"px"}},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialSettings):this._ui.removeOperation("radial-blur"),this._ui.canvas.render()}},_onDone:{value:function(){this._ui.addHistory(this._operation,{position:this._initialSettings.position.clone(),gradientRadius:this._initialSettings.gradientRadius,blurRadius:this._initialSettings.blurRadius},this._operationExistedBefore)}}}),RadialBlurControl}(Control);RadialBlurControl.prototype.identifier="radial-blur",module.exports=RadialBlurControl},{"../../../lib/math/vector2":18,"../../../lib/utils":20,"../lib/simple-slider":99,"./control":84}],90:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),RotationControl=function(_Control){function RotationControl(){_classCallCheck(this,RotationControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(RotationControl,_Control),_createClass(RotationControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-rotation">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      <li data-degrees="-90">\n        <img src="{{=it.helpers.assetPath(\'ui/night/rotation/left.png\')}}" />\n      </li>\n      <li data-degrees="90">\n        <img src="{{=it.helpers.assetPath(\'ui/night/rotation/right.png\')}}" />\n      </li>\n    </ul>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-crop-container imglykit-canvas-crop-container-hidden">\n  <div class="imglykit-canvas-crop-top">\n    <div class="imglykit-canvas-crop-top-left"></div>\n    <div class="imglykit-canvas-crop-top-center"></div>\n    <div class="imglykit-canvas-crop-top-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-center">\n    <div class="imglykit-canvas-crop-center-left"></div>\n    <div class="imglykit-canvas-crop-center-center imglykit-canvas-crop-center-center-nomove">\n\n    </div>\n    <div class="imglykit-canvas-crop-center-right"></div>\n  </div>\n\n  <div class="imglykit-canvas-crop-bottom">\n    <div class="imglykit-canvas-crop-bottom-left"></div>\n    <div class="imglykit-canvas-crop-bottom-center"></div>\n    <div class="imglykit-canvas-crop-bottom-right"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.rotation,this._operation=this._ui.getOrCreateOperation("rotation"),this._cropOperation=this._ui.operations.crop,this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(!1),this._cropOperation&&(this._initialStart=this._cropOperation.getStart().clone(),this._initialEnd=this._cropOperation.getEnd().clone(),this._cropOperation.set({start:new Vector2(0,0),end:new Vector2(1,1)})),this._initialDegrees=this._operation.getDegrees();var listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i];listItem.addEventListener("click",function(){_this._onListItemClick(listItem)})}(i);var prefix=".imglykit-canvas-crop";this._cropAreas={topLeft:this._canvasControls.querySelector(""+prefix+"-top-left"),topCenter:this._canvasControls.querySelector(""+prefix+"-top-center"),centerLeft:this._canvasControls.querySelector(""+prefix+"-center-left"),centerCenter:this._canvasControls.querySelector(""+prefix+"-center-center")},this._ui.canvas.render().then(function(){_this._showCropContainer(),_this._updateCropDOM()})}},_showCropContainer:{value:function(){var container=this._canvasControls.querySelector(".imglykit-canvas-crop-container");container.classList.remove("imglykit-canvas-crop-container-hidden")}},_onListItemClick:{value:function(item){var _this=this,degrees=item.dataset.degrees;degrees=parseInt(degrees);var currentDegrees=this._operation.getDegrees();this._operation.setDegrees(currentDegrees+degrees),this._ui.canvas.zoomToFit().then(function(){_this._updateCropDOM()})}},onZoom:{value:function(){this._updateCropDOM()}},_updateCropDOM:{value:function(){var start=void 0,end=void 0;this._cropOperation?(start=this._initialStart.clone(),end=this._initialEnd.clone()):(start=new Vector2(0,0),end=new Vector2(1,1));var canvasSize=this._ui.canvas.size,startAbsolute=start.multiply(canvasSize),endAbsolute=end.multiply(canvasSize),size=endAbsolute.clone().subtract(startAbsolute),top=Math.max(1,startAbsolute.y),left=Math.max(1,startAbsolute.x),width=Math.max(1,size.x),height=Math.max(1,size.y);this._cropAreas.topLeft.style.width=""+left+"px",this._cropAreas.topCenter.style.width=""+width+"px",this._cropAreas.topLeft.style.height=""+top+"px",this._cropAreas.centerLeft.style.height=""+height+"px"}},_onBack:{value:function(){var currentDegrees=this._operation.getDegrees();this._initialDegrees!==currentDegrees&&this._ui.addHistory(this._operation,{degrees:this._initialDegrees},this._operationExistedBefore),0===currentDegrees&&this._ui.removeOperation("rotation"),this._cropOperation&&this._cropOperation.set({start:this._initialStart,end:this._initialEnd}),this._ui.canvas.render()}}}),RotationControl}(Control);RotationControl.prototype.identifier="rotation",module.exports=RotationControl},{"../../../lib/math/vector2":18,"./control":84}],91:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Slider=_interopRequire(require("../lib/slider")),Control=_interopRequire(require("./control")),SaturationControl=function(_Control){function SaturationControl(){_classCallCheck(this,SaturationControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(SaturationControl,_Control),_createClass(SaturationControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-filters">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    {{#def.slider}}\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate,this._partialTemplates.push(Slider.template)}},_onEnter:{value:function(){_get(Object.getPrototypeOf(SaturationControl.prototype),"_onEnter",this).call(this),this._operationExistedBefore=!!this._ui.operations.saturation,this._operation=this._ui.getOrCreateOperation("saturation");var saturation=this._operation.getSaturation();this._initialSaturation=saturation;var sliderElement=this._controls.querySelector(".imglykit-slider");this._slider=new Slider(sliderElement,{minValue:0,maxValue:2,defaultValue:saturation}),this._slider.on("update",this._onUpdate.bind(this)),this._slider.setValue(this._initialSaturation)}},_onBack:{value:function(){var currentSaturation=this._operation.getSaturation();this._initialSaturation!==currentSaturation&&this._ui.addHistory(this._operation,{saturation:this._initialSaturation},this._operationExistedBefore),1===currentSaturation&&this._ui.removeOperation("saturation"),this._ui.canvas.render()}},_onUpdate:{value:function(value){this._operation.setSaturation(value),this._ui.canvas.render()}}}),SaturationControl}(Control);SaturationControl.prototype.identifier="saturation",module.exports=SaturationControl},{"../lib/slider":100,"./control":84}],92:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),StickersControl=function(_Control){function StickersControl(){_classCallCheck(this,StickersControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(StickersControl,_Control),_createClass(StickersControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-stickers">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{ for(var identifier in it.stickers) { }}\n        {{ var stickerPath = it.stickers[identifier]; }}\n        {{ var enabled = it.activeSticker === identifier; }}\n        <li data-identifier="{{= identifier}}"{{? enabled}} class="imglykit-controls-item-active"{{?}} style="background-image: url(\'{{=it.helpers.assetPath(stickerPath)}}\');">\n        </li>\n      {{ } }}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n    <div class="imglykit-controls-done-highlighted">\n      <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done-highlighted.png\') }}" />\n    </div>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-stickers-container">\n  <div class="imglykit-canvas-stickers">\n    <img class="imglykit-canvas-sticker-image" />\n    <div class="imglykit-knob"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._availableStickers={},this._stickers={},this._addDefaultStickers(),this.selectStickers(null)}},_addDefaultStickers:{value:function(){this.addSticker("glasses-nerd","stickers/sticker-glasses-nerd.png"),this.addSticker("glasses-normal","stickers/sticker-glasses-normal.png"),this.addSticker("glasses-shutter-green","stickers/sticker-glasses-shutter-green.png"),this.addSticker("glasses-shutter-yellow","stickers/sticker-glasses-shutter-yellow.png"),this.addSticker("glasses-sun","stickers/sticker-glasses-sun.png"),this.addSticker("hat-cap","stickers/sticker-hat-cap.png"),this.addSticker("hat-cylinder","stickers/sticker-hat-cylinder.png"),this.addSticker("hat-party","stickers/sticker-hat-party.png"),this.addSticker("hat-sheriff","stickers/sticker-hat-sheriff.png"),
this.addSticker("heart","stickers/sticker-heart.png"),this.addSticker("mustache-long","stickers/sticker-mustache-long.png"),this.addSticker("mustache1","stickers/sticker-mustache1.png"),this.addSticker("mustache2","stickers/sticker-mustache2.png"),this.addSticker("mustache3","stickers/sticker-mustache3.png"),this.addSticker("pipe","stickers/sticker-pipe.png"),this.addSticker("snowflake","stickers/sticker-snowflake.png"),this.addSticker("star","stickers/sticker-star.png")}},addSticker:{value:function(identifier,path){this._availableStickers[identifier]=path}},selectStickers:{value:function(selector){this._stickers={};for(var stickerIdentifiers=Object.keys(this._availableStickers),selectedStickers=Utils.select(stickerIdentifiers,selector),i=0;i<selectedStickers.length;i++){var identifier=selectedStickers[i];this._stickers[identifier]=this._availableStickers[identifier]}this._active&&this._renderControls()}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.stickers,this._operation=this._ui.getOrCreateOperation("stickers"),this._ui.removeOperation("stickers"),this._initialSettings={sticker:this._operation.getSticker(),position:this._operation.getPosition().clone(),size:this._operation.getSize().clone()};var canvasSize=this._ui.canvas.size;this._size=this._initialSettings.size.clone(),this._position=this._initialSettings.position.clone().multiply(canvasSize),this._initialZoomLevel=this._ui.canvas.zoomLevel,this._ui.canvas.zoomToFit(),this._container=this._canvasControls.querySelector(".imglykit-canvas-stickers"),this._stickerImage=this._canvasControls.querySelector("img"),this._stickerImage.addEventListener("load",function(){_this._stickerSize=new Vector2(_this._stickerImage.width,_this._stickerImage.height),_this._onStickerLoad()}),this._knob=this._canvasControls.querySelector("div.imglykit-knob"),this._onImageDown=this._onImageDown.bind(this),this._onImageDrag=this._onImageDrag.bind(this),this._onImageUp=this._onImageUp.bind(this),this._onKnobDown=this._onKnobDown.bind(this),this._onKnobDrag=this._onKnobDrag.bind(this),this._onKnobUp=this._onKnobUp.bind(this),this._handleListItems(),this._handleImage(),this._handleKnob()}},_handleListItems:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i],identifier=listItem.dataset.identifier;listItem.addEventListener("click",function(){_this._onListItemClick(listItem)}),(!_this._operationExistedBefore&&0===i||_this._operationExistedBefore&&_this._stickers[identifier]===_this._initialSettings.sticker)&&_this._onListItemClick(listItem,!1)}(i)}},_applySettings:{value:function(){var ratio=this._stickerSize.y/this._stickerSize.x;this._size.y=this._size.x*ratio,this._stickerImage.style.width=""+this._size.x+"px",this._stickerImage.style.height=""+this._size.y+"px",this._container.style.left=""+this._position.x+"px",this._container.style.top=""+this._position.y+"px"}},_onBack:{value:function(){this._operationExistedBefore?(this._operation=this._ui.getOrCreateOperation("stickers"),this._operation.set(this._initialSettings)):this._ui.removeOperation("stickers"),this._ui.canvas.setZoomLevel(this._initialZoomLevel)}},_onDone:{value:function(){var canvasSize=this._ui.canvas.size,position=this._position.clone().divide(canvasSize),size=this._size.clone().divide(canvasSize);this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operation=this._ui.getOrCreateOperation("stickers"),this._operation.set({sticker:this._availableStickers[this._sticker],position:position,size:size}),this._ui.canvas.render(),this._ui.addHistory(this,{sticker:this._initialSettings.sticker,position:this._initialSettings.position.clone(),size:this._initialSettings.size.clone()},this._operationExistedBefore)}},_handleKnob:{value:function(){this._knob.addEventListener("mousedown",this._onKnobDown),this._knob.addEventListener("touchstart",this._onKnobDown)}},_onKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialSize=this._size.clone(),document.addEventListener("mousemove",this._onKnobDrag),document.addEventListener("touchmove",this._onKnobDrag),document.addEventListener("mouseup",this._onKnobUp),document.addEventListener("touchend",this._onKnobUp)}},_onKnobDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),size=this._initialSize.clone(),ratio=this._stickerImage.height/this._stickerImage.width;size.x+=diff.x,size.y=size.x*ratio,this._size.copy(size),this._applySettings(),this._highlightDoneButton()}},_onKnobUp:{value:function(){document.removeEventListener("mousemove",this._onKnobDrag),document.removeEventListener("touchmove",this._onKnobDrag),document.removeEventListener("mouseup",this._onKnobUp),document.removeEventListener("touchend",this._onKnobUp)}},_handleImage:{value:function(){this._stickerImage.addEventListener("mousedown",this._onImageDown),this._stickerImage.addEventListener("touchstart",this._onImageDown)}},_onImageDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._position.clone(),document.addEventListener("mousemove",this._onImageDrag),document.addEventListener("touchmove",this._onImageDrag),document.addEventListener("mouseup",this._onImageUp),document.addEventListener("touchend",this._onImageUp)}},_onImageDrag:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),position=this._initialPosition.clone();position.add(diff),this._position.copy(position),this._applySettings(),this._highlightDoneButton()}},_onImageUp:{value:function(){document.removeEventListener("mousemove",this._onImageDrag),document.removeEventListener("touchmove",this._onImageDrag),document.removeEventListener("mouseup",this._onImageUp),document.removeEventListener("touchend",this._onImageUp)}},_onStickerLoad:{value:function(){this._size=new Vector2(this._stickerImage.width,this._stickerImage.height),"undefined"==typeof this._position&&(this._position=new Vector2(0,0)),this._applySettings()}},_onListItemClick:{value:function(item){var manually=void 0===arguments[1]?!0:arguments[1];this._deactivateAllItems();var identifier=item.dataset.identifier,stickerPath=this._availableStickers[identifier];stickerPath=this._kit.getAssetPath(stickerPath);try{this._stickerImage.attributes.removeNamedItem("style")}catch(e){}this._sticker=identifier,this._stickerImage.src=stickerPath,item.classList.add("imglykit-controls-item-active"),manually&&this._highlightDoneButton()}},_deactivateAllItems:{value:function(){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._listItems[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var listItem=_step.value;listItem.classList.remove("imglykit-controls-item-active")}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},context:{get:function(){var context=_get(Object.getPrototypeOf(StickersControl.prototype),"context",this);return context.stickers=this._stickers,context}}}),StickersControl}(Control);StickersControl.prototype.identifier="stickers",module.exports=StickersControl},{"../../../lib/math/vector2":18,"../../../lib/utils":20,"./control":84}],93:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),ColorPicker=_interopRequire(require("../lib/color-picker")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),TextControl=function(_Control){function TextControl(){_classCallCheck(this,TextControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(TextControl,_Control),_createClass(TextControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-text">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div>\n    <ul class="imglykit-controls-list imgly-controls-list-with-buttons">\n      {{~it.fonts :value:index}}\n        <li data-name="{{= value.name}}" data-weight="{{= value.weight}}" style="font-family: {{= value.name}}; font-weight: {{= value.weight}}">{{= value.name.substr(0, 2)}}</li>\n      {{~}}\n    </ul>\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerId = "imglykit-text-foreground-color-picker";}}\n    {{var colorpickerLabel = "Foreground";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button">\n    {{var colorpickerId = "imglykit-text-background-color-picker";}}\n    {{var colorpickerLabel = "Background";}}\n    {{#def.colorpicker}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n    <div class="imglykit-controls-done-highlighted">\n      <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done-highlighted.png\') }}" />\n    </div>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-text-container">\n  <div class="imglykit-canvas-text">\n    <div class="imglykit-crosshair">\n      <img src="{{=it.helpers.assetPath(\'ui/night/crosshair.png\')}}" />\n    </div>\n    <div class="imglykit-canvas-text-textarea">\n      <textarea></textarea>\n      <div class="imglykit-knob"></div>\n    </div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(ColorPicker.template),this._fonts=[],this._addFonts()}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations.text,this._operation=this._ui.getOrCreateOperation("text"),this._ui.removeOperation("text");var canvasSize=this._ui.canvas.size;this._initialSettings={lineHeight:this._operation.getLineHeight(),fontSize:this._operation.getFontSize(),fontFamily:this._operation.getFontFamily(),fontWeight:this._operation.getFontWeight(),color:this._operation.getColor(),position:this._operation.getPosition(),text:this._operation.getText()||"",maxWidth:this._operation.getMaxWidth(),backgroundColor:this._operation.getBackgroundColor()},this._settings={lineHeight:this._initialSettings.lineHeight,fontSize:this._initialSettings.fontSize,fontFamily:this._initialSettings.fontFamily,fontWeight:this._initialSettings.fontWeight,color:this._initialSettings.color.clone(),position:this._initialSettings.position.clone().multiply(canvasSize),text:this._initialSettings.text,maxWidth:this._initialSettings.maxWidth*canvasSize.x,backgroundColor:this._initialSettings.backgroundColor.clone()},this._initialZoomLevel=this._ui.canvas.zoomLevel,this._container=this._canvasControls.querySelector(".imglykit-canvas-text"),this._textarea=this._canvasControls.querySelector("textarea"),this._textarea.focus(),this._moveKnob=this._canvasControls.querySelector(".imglykit-crosshair"),this._resizeKnob=this._canvasControls.querySelector(".imglykit-knob"),this._operationExistedBefore&&(this._settings.position.x-=2,this._settings.position.y-=2),this._onTextareaKeyUp=this._onTextareaKeyUp.bind(this),this._onResizeKnobDown=this._onResizeKnobDown.bind(this),this._onResizeKnobDrag=this._onResizeKnobDrag.bind(this),this._onResizeKnobUp=this._onResizeKnobUp.bind(this),this._onMoveKnobDown=this._onMoveKnobDown.bind(this),this._onMoveKnobDrag=this._onMoveKnobDrag.bind(this),this._onMoveKnobUp=this._onMoveKnobUp.bind(this),this._onForegroundColorUpdate=this._onForegroundColorUpdate.bind(this),this._onBackgroundColorUpdate=this._onBackgroundColorUpdate.bind(this),this._initColorPickers(),this._handleListItems(),this._handleTextarea(),this._handleResizeKnob(),this._handleMoveKnob(),setTimeout(function(){_this._resizeTextarea()},1),this._ui.canvas.zoomToFit().then(function(){_this._applySettings()})}},_initColorPickers:{value:function(){var _this=this,foregroundColorPicker=this._controls.querySelector("#imglykit-text-foreground-color-picker");this._foregroundColorPicker=new ColorPicker(this._ui,foregroundColorPicker),this._foregroundColorPicker.setValue(this._operation.getColor()),this._foregroundColorPicker.on("update",this._onForegroundColorUpdate),this._foregroundColorPicker.on("show",function(){_this._backgroundColorPicker.hide()});var backgroundColorPicker=this._controls.querySelector("#imglykit-text-background-color-picker");this._backgroundColorPicker=new ColorPicker(this._ui,backgroundColorPicker),this._backgroundColorPicker.setValue(this._operation.getBackgroundColor()),this._backgroundColorPicker.on("update",this._onBackgroundColorUpdate),this._backgroundColorPicker.on("show",function(){_this._foregroundColorPicker.hide()})}},_handleListItems:{value:function(){var _this=this,listItems=this._controls.querySelectorAll("li");this._listItems=Array.prototype.slice.call(listItems);for(var i=0;i<this._listItems.length;i++)!function(i){var listItem=_this._listItems[i],name=listItem.dataset.name;listItem.addEventListener("click",function(){_this._onListItemClick(listItem)}),(!_this._operationExistedBefore&&0===i||_this._operationExistedBefore&&name===_this._initialSettings.fontFamily)&&_this._onListItemClick(listItem,!1)}(i)}},_handleTextarea:{value:function(){this._textarea.addEventListener("keyup",this._onTextareaKeyUp)}},_onTextareaKeyUp:{value:function(){this._resizeTextarea(),this._settings.text=this._textarea.value,this._highlightDoneButton()}},_resizeTextarea:{value:function(){var scrollTop=this._textarea.scrollTop;if(!scrollTop){var _scrollHeight=void 0,height=void 0;do _scrollHeight=this._textarea.scrollHeight,height=this._textarea.offsetHeight,this._textarea.style.height=""+(height-5)+"px";while(_scrollHeight&&_scrollHeight!=this._textarea.scrollHeight)}var scrollHeight=this._textarea.scrollHeight;this._textarea.style.height=""+(scrollHeight+20)+"px"}},_handleMoveKnob:{value:function(){this._moveKnob.addEventListener("mousedown",this._onMoveKnobDown),this._moveKnob.addEventListener("touchstart",this._onMoveKnobDown)}},_onMoveKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._settings.position.clone(),document.addEventListener("mousemove",this._onMoveKnobDrag),document.addEventListener("touchmove",this._onMoveKnobDrag),document.addEventListener("mouseup",this._onMoveKnobUp),document.addEventListener("tochend",this._onMoveKnobUp)}},_onMoveKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.clone().subtract(this._initialMousePosition),minPosition=new Vector2(0,0),containerSize=new Vector2(this._container.offsetWidth,this._container.offsetHeight),maxPosition=canvasSize.clone().subtract(containerSize),position=this._initialPosition.clone().add(diff).clamp(minPosition,maxPosition);this._settings.position=position,this._container.style.left=""+position.x+"px",this._container.style.top=""+position.y+"px"}},_onMoveKnobUp:{value:function(){document.removeEventListener("mousemove",this._onMoveKnobDrag),document.removeEventListener("touchmove",this._onMoveKnobDrag),document.removeEventListener("mouseup",this._onMoveKnobUp),document.removeEventListener("touchend",this._onMoveKnobUp)}},_handleResizeKnob:{value:function(){this._resizeKnob.addEventListener("mousedown",this._onResizeKnobDown),this._resizeKnob.addEventListener("touchstart",this._onResizeKnobDown)}},_onResizeKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialMaxWidth=this._settings.maxWidth,document.addEventListener("mousemove",this._onResizeKnobDrag),document.addEventListener("touchmove",this._onResizeKnobDrag),document.addEventListener("mouseup",this._onResizeKnobUp),document.addEventListener("touchend",this._onResizeKnobUp)}},_onResizeKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),position=this._settings.position.clone(),maxWidthAllowed=canvasSize.x-position.x,maxWidth=this._initialMaxWidth+diff.x;maxWidth=Math.max(100,Math.min(maxWidthAllowed,maxWidth)),this._settings.maxWidth=maxWidth,this._textarea.style.width=""+maxWidth+"px",this._resizeTextarea()}},_onResizeKnobUp:{value:function(){document.removeEventListener("mousemove",this._onResizeKnobDrag),document.removeEventListener("touchmove",this._onResizeKnobDrag),document.removeEventListener("mouseup",this._onResizeKnobUp),document.removeEventListener("touchend",this._onResizeKnobUp)}},_onForegroundColorUpdate:{value:function(value){this._settings.color=value,this._applySettings(),this._highlightDoneButton()}},_onBackgroundColorUpdate:{value:function(value){this._settings.backgroundColor=value,this._applySettings(),this._highlightDoneButton()}},_applySettings:{value:function(){var textarea=this._textarea,settings=this._settings,canvasSize=this._ui.canvas.size,actualFontSize=settings.fontSize*canvasSize.y;this._container.style.left=""+settings.position.x+"px",this._container.style.top=""+settings.position.y+"px",textarea.value=settings.text,textarea.style.fontFamily=settings.fontFamily,textarea.style.fontSize=""+actualFontSize+"px",textarea.style.fontWeight=settings.fontWeight,textarea.style.lineHeight=settings.lineHeight,textarea.style.color=settings.color.toRGBA(),textarea.style.backgroundColor=settings.backgroundColor.toRGBA(),textarea.style.width=""+settings.maxWidth+"px"}},_onListItemClick:{value:function(item){var manually=void 0===arguments[1]?!0:arguments[1];this._deactivateAllItems();var _item$dataset=item.dataset,name=_item$dataset.name,weight=_item$dataset.weight;this._settings.fontFamily=name,this._settings.fontWeight=weight,this._applySettings(),item.classList.add("imglykit-controls-item-active"),manually&&this._highlightDoneButton()}},_deactivateAllItems:{value:function(){for(var i=0;i<this._listItems.length;i++){var listItem=this._listItems[i];listItem.classList.remove("imglykit-controls-item-active")}}},_addFonts:{value:function(){this.addFont("Helvetica","normal"),this.addFont("Lucida Grande","normal"),this.addFont("Times New Roman","normal")}},addFont:{value:function(name,weight){this._fonts.push({name:name,weight:weight})}},_onDone:{value:function(){var canvasSize=this._ui.canvas.size,padding=new Vector2(2,2),position=this._settings.position.clone().add(padding).divide(canvasSize);this._ui.canvas.setZoomLevel(this._initialZoomLevel,!1),this._operation=this._ui.getOrCreateOperation("text"),this._operation.set({fontSize:this._settings.fontSize,fontFamily:this._settings.fontFamily,fontWeight:this._settings.fontWeight,color:this._settings.color,backgroundColor:this._settings.backgroundColor,position:position,text:this._settings.text,maxWidth:this._settings.maxWidth/canvasSize.x}),this._ui.canvas.render(),this._ui.addHistory(this,{fontFamily:this._initialSettings.fontFamily,fontWeight:this._initialSettings.fontWeight,color:this._initialSettings.color.clone(),backgroundColor:this._initialSettings.backgroundColor.clone(),position:this._initialSettings.position.clone(),text:this._initialSettings.text,maxWidth:this._initialSettings.maxWidth},this._operationExistedBefore)}},_onBack:{value:function(){this._operationExistedBefore?(this._operation=this._ui.getOrCreateOperation("text"),this._operation.set(this._initialSettings)):this._ui.removeOperation("text"),this._ui.canvas.setZoomLevel(this._initialZoomLevel)}},context:{get:function(){var context=_get(Object.getPrototypeOf(TextControl.prototype),"context",this);return context.fonts=this._fonts,context}}}),TextControl}(Control);TextControl.prototype.identifier="text",module.exports=TextControl},{"../../../lib/math/vector2":18,"../../../lib/utils":20,"../lib/color-picker":96,"./control":84}],94:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Control=_interopRequire(require("./control")),Vector2=_interopRequire(require("../../../lib/math/vector2")),Utils=_interopRequire(require("../../../lib/utils")),SimpleSlider=_interopRequire(require("../lib/simple-slider")),TiltShiftControl=function(_Control){function TiltShiftControl(){_classCallCheck(this,TiltShiftControl),null!=_Control&&_Control.apply(this,arguments)}return _inherits(TiltShiftControl,_Control),_createClass(TiltShiftControl,{init:{value:function(){var controlsTemplate='<div class="imglykit-controls-tilt-shift">\n  <div class="imglykit-controls-button imglykit-controls-back">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/back.png\') }}" />\n  </div>\n\n  <div class="imglykit-controls-icon">\n    <img src="{{=it.helpers.assetPath(\'ui/night/blur/blur.png\')}}" />\n  </div>\n\n  <div>\n    {{var sliderId = "imglykit-blur-radius-slider";}}\n    {{#def.simpleSlider}}\n  </div>\n\n  <div class="imglykit-controls-button imglykit-controls-done">\n    <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done.png\') }}" />\n    <div class="imglykit-controls-done-highlighted">\n      <img src="{{=it.helpers.assetPath(\'ui/night/buttons/done-highlighted.png\') }}" />\n    </div>\n  </div>\n</div>\n';this._controlsTemplate=controlsTemplate;var canvasControlsTemplate='<div class="imglykit-canvas-tilt-shift-container">\n  <div class="imglykit-canvas-tilt-shift-dot" data-option="position"></div>\n  <div class="imglykit-canvas-tilt-shift-dot" data-option="gradient"></div>\n  <div class="imglykit-canvas-tilt-shift-rect-container">\n    <div class="imglykit-canvas-tilt-shift-rect"></div>\n  </div>\n</div>\n';this._canvasControlsTemplate=canvasControlsTemplate,this._partialTemplates.push(SimpleSlider.template),this._currentKnob=null}},_onEnter:{value:function(){var _this=this;this._operationExistedBefore=!!this._ui.operations["tilt-shift"],this._operation=this._ui.getOrCreateOperation("tilt-shift"),this._initialSettings={start:this._operation.getStart().clone(),end:this._operation.getEnd().clone(),gradientRadius:this._operation.getGradientRadius(),blurRadius:this._operation.getBlurRadius()},this._onPositionKnobDown=this._onPositionKnobDown.bind(this),this._onPositionKnobDrag=this._onPositionKnobDrag.bind(this),this._onPositionKnobUp=this._onPositionKnobUp.bind(this),this._onGradientKnobDown=this._onGradientKnobDown.bind(this),this._onGradientKnobDrag=this._onGradientKnobDrag.bind(this),this._onGradientKnobUp=this._onGradientKnobUp.bind(this);var selector=".imglykit-canvas-tilt-shift-dot";this._positionKnob=this._canvasControls.querySelector(""+selector+'[data-option="position"]'),this._gradientKnob=this._canvasControls.querySelector(""+selector+'[data-option="gradient"]'),this._rect=this._canvasControls.querySelector(".imglykit-canvas-tilt-shift-rect"),this._initSliders(),this._ui.canvas.render().then(function(){_this._handleKnobs(),_this._updateDOM()})}},_initSliders:{value:function(){var blurRadiusSlider=this._controls.querySelector("#imglykit-blur-radius-slider");this._blurRadiusSlider=new SimpleSlider(blurRadiusSlider,{minValue:0,maxValue:40}),this._blurRadiusSlider.on("update",this._onBlurRadiusUpdate.bind(this)),this._blurRadiusSlider.setValue(this._initialSettings.blurRadius)}},_onBlurRadiusUpdate:{value:function(value){this._operation.setBlurRadius(value),this._ui.canvas.render(),this._highlightDoneButton()}},_handleKnobs:{value:function(){this._positionKnob.addEventListener("mousedown",this._onPositionKnobDown),this._positionKnob.addEventListener("touchstart",this._onPositionKnobDown),this._gradientKnob.addEventListener("mousedown",this._onGradientKnobDown),this._gradientKnob.addEventListener("touchstart",this._onGradientKnobDown);var canvasSize=this._ui.canvas.size,_initialSettings=this._initialSettings,start=_initialSettings.start,end=_initialSettings.end;start=start.clone().multiply(canvasSize),end=end.clone().multiply(canvasSize);var dist=end.clone().subtract(start),middle=start.clone().add(dist.clone().divide(2)),totalDist=Math.sqrt(Math.pow(dist.x,2)+Math.pow(dist.y,2)),factor=dist.clone().divide(totalDist).divide(2);this._knobPosition=middle.clone();var gradientRadius=this._initialSettings.gradientRadius;this._gradientKnobPosition=middle.clone().add(-gradientRadius*factor.y,gradientRadius*factor.x),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()}},_updateStartAndEnd:{value:function(){var canvasSize=this._ui.canvas.size,diff=this._gradientKnobPosition.clone().subtract(this._knobPosition),start=this._knobPosition.clone().add(-diff.y,diff.x).divide(canvasSize),end=this._knobPosition.clone().add(diff.y,-diff.x).divide(canvasSize);this._operation.set({start:start,end:end})}},_onPositionKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialPosition=this._knobPosition.clone(),this._initialDistanceToGradientKnob=this._gradientKnobPosition.clone().subtract(this._initialPosition),document.addEventListener("mousemove",this._onPositionKnobDrag),document.addEventListener("touchmove",this._onPositionKnobDrag),document.addEventListener("mouseup",this._onPositionKnobUp),document.addEventListener("touchend",this._onPositionKnobUp)}},_onPositionKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition),newPosition=this._initialPosition.clone().add(diff);this._knobPosition.copy(newPosition);var minPosition=(new Vector2).subtract(this._initialDistanceToGradientKnob);minPosition.clamp(new Vector2(0,0));var maxPosition=canvasSize.clone().subtract(this._initialDistanceToGradientKnob);maxPosition.clamp(null,canvasSize),this._knobPosition.clamp(minPosition,maxPosition),this._gradientKnobPosition.copy(this._knobPosition).add(this._initialDistanceToGradientKnob),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()}},_onPositionKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onPositionKnobDrag),document.removeEventListener("touchmove",this._onPositionKnobDrag),document.removeEventListener("mouseup",this._onPositionKnobUp),document.removeEventListener("touchend",this._onPositionKnobUp)}},_onGradientKnobDown:{value:function(e){e.preventDefault(),this._initialMousePosition=Utils.getEventPosition(e),this._initialGradientKnobPosition=this._gradientKnobPosition.clone(),document.addEventListener("mousemove",this._onGradientKnobDrag),document.addEventListener("touchmove",this._onGradientKnobDrag),document.addEventListener("mouseup",this._onGradientKnobUp),document.addEventListener("touchend",this._onGradientKnobUp)}},_onGradientKnobDrag:{value:function(e){e.preventDefault();var canvasSize=this._ui.canvas.size,mousePosition=Utils.getEventPosition(e),diff=mousePosition.subtract(this._initialMousePosition);this._gradientKnobPosition.copy(this._initialGradientKnobPosition).add(diff),this._gradientKnobPosition.clamp(new Vector2(0,0),canvasSize);var distance=this._gradientKnobPosition.clone().subtract(this._knobPosition),newGradientRadius=2*Math.sqrt(Math.pow(distance.x,2)+Math.pow(distance.y,2));this._operation.setGradientRadius(newGradientRadius),this._updateStartAndEnd(),this._updateDOM(),this._ui.canvas.render()}},_onGradientKnobUp:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._onGradientKnobDrag),document.removeEventListener("touchmove",this._onGradientKnobDrag),document.removeEventListener("mouseup",this._onGradientKnobUp),document.removeEventListener("touchend",this._onGradientKnobUp)}},_updateDOM:{value:function(){var position=this._knobPosition;this._positionKnob.style.left=""+position.x+"px",this._positionKnob.style.top=""+position.y+"px";var gradientPosition=this._gradientKnobPosition;this._gradientKnob.style.left=""+gradientPosition.x+"px",this._gradientKnob.style.top=""+gradientPosition.y+"px";var canvasSize=this._ui.canvas.size,gradientRadius=this._operation.getGradientRadius(),rectSize=new Vector2(2*Math.sqrt(Math.pow(canvasSize.x,2)+Math.pow(canvasSize.y,2)),gradientRadius);this._rect.style.width=""+rectSize.x+"px",this._rect.style.height=""+rectSize.y+"px",this._rect.style.marginLeft="-"+rectSize.x/2+"px",this._rect.style.marginTop="-"+rectSize.y/2+"px",this._rect.style.left=""+position.x+"px",this._rect.style.top=""+position.y+"px";var dist=gradientPosition.clone().subtract(position),degrees=Math.atan2(dist.x,dist.y)*(180/Math.PI);this._rect.style.transform="rotate("+(-degrees).toFixed(2)+"deg)"}},_onBack:{value:function(){this._operationExistedBefore?this._operation.set(this._initialSettings):this._ui.removeOperation("tilt-shift"),this._ui.canvas.render()}},_onDone:{value:function(){this._ui.addHistory(this._operation,{start:this._initialSettings.start.clone(),end:this._initialSettings.end.clone(),blurRadius:this._initialSettings.blurRadius,gradientRadius:this._initialSettings.gradientRadius},this._operationExistedBefore)}}}),TiltShiftControl}(Control);TiltShiftControl.prototype.identifier="tilt-shift",module.exports=TiltShiftControl},{"../../../lib/math/vector2":18,"../../../lib/utils":20,"../lib/simple-slider":99,"./control":84}],95:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,
prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},WebGLRenderer=_interopRequire(require("../../../renderers/webgl-renderer")),CanvasRenderer=_interopRequire(require("../../../renderers/canvas-renderer")),Vector2=_interopRequire(require("../../../lib/math/vector2")),EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Canvas=function(_EventEmitter){function Canvas(kit,ui,options){_classCallCheck(this,Canvas),_get(Object.getPrototypeOf(Canvas.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._options=options;var container=this._ui.container;this._canvasContainer=container.querySelector(".imglykit-canvas-container"),this._canvasInnerContainer=container.querySelector(".imglykit-canvas-inner-container"),this._canvas=this._canvasContainer.querySelector("canvas"),this._image=this._options.image,this._roundZoomBy=.1,this._isFirstRender=!0,this._dragOnMousedown=this._dragOnMousedown.bind(this),this._dragOnMousemove=this._dragOnMousemove.bind(this),this._dragOnMouseup=this._dragOnMouseup.bind(this)}return _inherits(Canvas,_EventEmitter),_createClass(Canvas,{run:{value:function(){this._initRenderer(),this._zoomLevel=this._getInitialZoomLevel(),this._initialZoomLevel=this._zoomLevel,this._isInitialZoom=!0,this._size=null,this.render(),this._centerCanvas(),this._handleDrag()}},render:{value:function(){var _this=this;this._initialZoomLevel=this._getInitialZoomLevel(),this._isInitialZoom&&this.setZoomLevel(this._initialZoomLevel,!1);var imageSize=new Vector2(this._image.width,this._image.height),initialSize=imageSize.multiply(this._zoomLevel);this._setCanvasSize(initialSize),this._renderer.reset(),(this._isFirstRender||"canvas"===this._renderer.constructor.identifier)&&(this._renderer.drawImage(this._image),this._isFirstRender=!1);var stack=this.sanitizedStack;this._updateStackDirtyStates(stack);var validationPromises=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=stack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;validationPromises.push(operation.validateSettings())}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return Promise.all(validationPromises).then(function(){var promises=[],_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=stack[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var operation=_step2.value;promises.push(operation.render(_this._renderer))}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}return Promise.all(promises)}).then(function(){return _this._renderer.renderFinal()}).then(function(){_this._storeCanvasSize(),_this._updateContainerSize(),_this._updateCanvasMargins(),_this._applyBoundaries()})}},setImage:{value:function(image){this._image=image,this.reset(),this.render(),this._centerCanvas()}},zoomIn:{value:function(){this._isInitialZoom=!1;var zoomLevel=Math.round(100*this._zoomLevel),roundZoomBy=Math.round(100*this._roundZoomBy),initialZoomLevel=Math.round(100*this._initialZoomLevel);return zoomLevel%roundZoomBy!==0?zoomLevel=Math.ceil(zoomLevel/roundZoomBy)*roundZoomBy:zoomLevel+=roundZoomBy,zoomLevel=Math.min(2*initialZoomLevel,zoomLevel),this.setZoomLevel(zoomLevel/100)}},zoomOut:{value:function(){this._isInitialZoom=!1;var zoomLevel=Math.round(100*this._zoomLevel),roundZoomBy=Math.round(100*this._roundZoomBy),initialZoomLevel=Math.round(100*this._initialZoomLevel);return zoomLevel%roundZoomBy!==0?zoomLevel=Math.floor(zoomLevel/roundZoomBy)*roundZoomBy:zoomLevel-=roundZoomBy,zoomLevel=Math.max(initialZoomLevel,zoomLevel),this.setZoomLevel(zoomLevel/100)}},_setCanvasSize:{value:function(size){size=size||new Vector2(this._canvas.width,this._canvas.height),this._canvas.width=size.x,this._canvas.height=size.y,this._storeCanvasSize(),this._updateContainerSize()}},_updateContainerSize:{value:function(){var size=this._size;this._canvasInnerContainer.style.width=""+size.x+"px",this._canvasInnerContainer.style.height=""+size.y+"px"}},_storeCanvasSize:{value:function(){this._size=new Vector2(this._canvas.width,this._canvas.height)}},_centerCanvas:{value:function(){var position=this._maxSize.divide(2);this._canvasInnerContainer.style.left=""+position.x+"px",this._canvasInnerContainer.style.top=""+position.y+"px",this._updateCanvasMargins()}},_updateCanvasMargins:{value:function(){var canvasSize=new Vector2(this._canvas.width,this._canvas.height),margin=canvasSize.divide(2).multiply(-1);this._canvasInnerContainer.style.marginLeft=""+margin.x+"px",this._canvasInnerContainer.style.marginTop=""+margin.y+"px"}},setZoomLevel:{value:function(zoomLevel){var _this=this,render=void 0===arguments[1]?!0:arguments[1];return this._zoomLevel=zoomLevel,render?(this.setAllOperationsToDirty(),this.render().then(function(){_this._updateCanvasMargins(),_this._applyBoundaries(),_this.emit("zoom")})):(this._updateCanvasMargins(),this._applyBoundaries(),this.emit("zoom"),void 0)}},setAllOperationsToDirty:{value:function(){for(var operationsStack=this._kit.operationsStack,i=0;i<operationsStack.length;i++){var operation=operationsStack[i];operation&&(operation.dirty=!0)}}},_getInitialZoomLevel:{value:function(){var inputSize=new Vector2(this._image.width,this._image.height),cropOperation=this._ui.operations.crop,rotationOperation=this._ui.operations.rotation,cropSize=void 0,croppedSize=void 0,finalSize=void 0,initialSize=void 0;if(cropSize=cropOperation?cropOperation.getEnd().clone().subtract(cropOperation.getStart()):new Vector2(1,1),croppedSize=inputSize.clone().multiply(cropSize),rotationOperation&&rotationOperation.getDegrees()%180!==0){var tempX=croppedSize.x;croppedSize.x=croppedSize.y,croppedSize.y=tempX}if(finalSize=this._resizeVectorToFit(croppedSize),rotationOperation&&rotationOperation.getDegrees()%180!==0){var tempX=finalSize.x;finalSize.x=finalSize.y,finalSize.y=tempX}return initialSize=finalSize.clone().divide(cropSize),initialSize.x/inputSize.x}},_resizeVectorToFit:{value:function(size){var maxSize=this._maxSize,scale=Math.min(maxSize.x/size.x,maxSize.y/size.y),newSize=size.clone().multiply(scale);return newSize}},_initRenderer:{value:function(){var _this=this;if(WebGLRenderer.isSupported()&&"canvas"!==this._options.renderer?(this._renderer=new WebGLRenderer(null,this._canvas),this._webglEnabled=!0):CanvasRenderer.isSupported()&&(this._renderer=new CanvasRenderer(null,this._canvas),this._webglEnabled=!1),null===this._renderer)throw new Error("Neither Canvas nor WebGL renderer are supported.");this._renderer.on("new-canvas",function(canvas){_this._setCanvas(canvas)})}},_setCanvas:{value:function(canvas){var canvasParent=this._canvas.parentNode;canvasParent.removeChild(this._canvas),this._canvas=canvas,canvasParent.appendChild(this._canvas),this._updateCanvasMargins(),this._applyBoundaries(),this._updateContainerSize()}},_handleDrag:{value:function(){this._canvas.addEventListener("mousedown",this._dragOnMousedown),this._canvas.addEventListener("touchstart",this._dragOnMousedown)}},_dragOnMousedown:{value:function(e){if("mousedown"!==e.type||0===e.button){e.preventDefault();var x=e.pageX,y=e.pageY;"touchstart"===e.type&&(x=e.touches[0].pageX,y=e.touches[0].pageY);var canvasX=parseInt(this._canvasInnerContainer.style.left),canvasY=parseInt(this._canvasInnerContainer.style.top);document.addEventListener("mousemove",this._dragOnMousemove),document.addEventListener("touchmove",this._dragOnMousemove),document.addEventListener("mouseup",this._dragOnMouseup),document.addEventListener("touchend",this._dragOnMouseup),this._initialMousePosition=new Vector2(x,y),this._initialCanvasPosition=new Vector2(canvasX,canvasY)}}},_dragOnMousemove:{value:function(e){e.preventDefault();var x=e.pageX,y=e.pageY;"touchmove"===e.type&&(x=e.touches[0].pageX,y=e.touches[0].pageY);var newMousePosition=new Vector2(x,y),mouseDiff=newMousePosition.clone().subtract(this._initialMousePosition),newPosition=this._initialCanvasPosition.clone().add(mouseDiff);this._canvasInnerContainer.style.left=""+newPosition.x+"px",this._canvasInnerContainer.style.top=""+newPosition.y+"px",this._applyBoundaries()}},_applyBoundaries:{value:function(){var x=parseInt(this._canvasInnerContainer.style.left),y=parseInt(this._canvasInnerContainer.style.top),canvasPosition=new Vector2(x,y),boundaries=this._boundaries;canvasPosition.x=Math.min(boundaries.max.x,Math.max(boundaries.min.x,canvasPosition.x)),canvasPosition.y=Math.min(boundaries.max.y,Math.max(boundaries.min.y,canvasPosition.y)),this._canvasInnerContainer.style.left=""+canvasPosition.x+"px",this._canvasInnerContainer.style.top=""+canvasPosition.y+"px"}},_dragOnMouseup:{value:function(e){e.preventDefault(),document.removeEventListener("mousemove",this._dragOnMousemove),document.removeEventListener("touchmove",this._dragOnMousemove),document.removeEventListener("mouseup",this._dragOnMouseup),document.removeEventListener("touchend",this._dragOnMouseup)}},_boundaries:{get:function(){var canvasSize=new Vector2(this._canvas.width,this._canvas.height),maxSize=this._maxSize,diff=canvasSize.clone().subtract(maxSize).multiply(-1),boundaries={min:new Vector2(diff.x,diff.y),max:new Vector2(0,0)};canvasSize.x<maxSize.x&&(boundaries.min.x=diff.x/2,boundaries.max.x=diff.x/2),canvasSize.y<maxSize.y&&(boundaries.min.y=diff.y/2,boundaries.max.y=diff.y/2);var halfCanvasSize=canvasSize.clone().divide(2);return boundaries.min.add(halfCanvasSize),boundaries.max.add(halfCanvasSize),boundaries}},_maxSize:{get:function(){var computedStyle=getComputedStyle(this._canvasContainer),size=new Vector2(this._canvasContainer.offsetWidth,this._canvasContainer.offsetHeight),paddingX=parseInt(computedStyle.getPropertyValue("padding-left"));paddingX+=parseInt(computedStyle.getPropertyValue("padding-right"));var paddingY=parseInt(computedStyle.getPropertyValue("padding-top"));paddingY+=parseInt(computedStyle.getPropertyValue("padding-bottom")),size.x-=paddingX,size.y-=paddingY;var controlsHeight=this._ui._controlsContainer.offsetHeight;return size.y-=controlsHeight,size}},_updateStackDirtyStates:{value:function(stack){for(var dirtyFound=!1,i=0;i<stack.length;i++){var operation=stack[i];operation&&(operation.dirty&&(dirtyFound=!0),dirtyFound&&(operation.dirty=!0))}}},zoomToFit:{value:function(){var render=void 0===arguments[0]?!0:arguments[0],initialZoomLevel=this._getInitialZoomLevel();return this.setZoomLevel(initialZoomLevel,render)}},reset:{value:function(){this._renderer.reset(!0),this._kit.operationsStack=[],this._isFirstRender=!0}},sanitizedStack:{get:function(){var sanitizedStack=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this._kit.operationsStack[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var operation=_step.value;operation&&sanitizedStack.push(operation)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return sanitizedStack}},zoomLevel:{get:function(){return this._zoomLevel}},size:{get:function(){return this._size}}}),Canvas}(EventEmitter);module.exports=Canvas},{"../../../lib/event-emitter":14,"../../../lib/math/vector2":18,"../../../renderers/canvas-renderer":77,"../../../renderers/webgl-renderer":79}],96:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr)){for(var _step,_arr=[],_iterator=arr[Symbol.iterator]();!(_step=_iterator.next()).done&&(_arr.push(_step.value),!i||_arr.length!==i););return _arr}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Utils=_interopRequire(require("../../../lib/utils")),Color=_interopRequire(require("../../../lib/color")),Vector2=_interopRequire(require("../../../lib/math/vector2")),ColorPicker=function(_EventEmitter){function ColorPicker(ui,element){_classCallCheck(this,ColorPicker),_get(Object.getPrototypeOf(ColorPicker.prototype),"constructor",this).call(this),this._ui=ui,this._element=element,this._visible=!1,this._loaded=!1,this._overlay=this._element.querySelector(".imglykit-color-picker-overlay"),this._currentColorCanvas=this._element.querySelector(".imglykit-color-picker-color"),this._alphaCanvas=this._element.querySelector("canvas.imglykit-color-picker-alpha"),this._alphaKnob=this._element.querySelector(".imglykit-color-picker-alpha-container .imglykit-transparent-knob"),this._hueCanvas=this._element.querySelector("canvas.imglykit-color-picker-hue"),this._hueKnob=this._element.querySelector(".imglykit-color-picker-hue-container .imglykit-transparent-knob"),this._saturationCanvas=this._element.querySelector("canvas.imglykit-color-picker-saturation"),this._saturationKnob=this._element.querySelector(".imglykit-color-picker-saturation-container .imglykit-transparent-knob"),this._transparencyImage=new Image,this._transparencyImage.src=ui.helpers.assetPath("ui/night/transparency.png"),this._transparencyImage.addEventListener("load",this._onTransparencyImageLoad.bind(this)),this._onAlphaCanvasDown=this._onAlphaCanvasDown.bind(this),this._onAlphaCanvasDrag=this._onAlphaCanvasDrag.bind(this),this._onAlphaCanvasUp=this._onAlphaCanvasUp.bind(this),this._onHueCanvasDown=this._onHueCanvasDown.bind(this),this._onHueCanvasDrag=this._onHueCanvasDrag.bind(this),this._onHueCanvasUp=this._onHueCanvasUp.bind(this),this._onSaturationCanvasDown=this._onSaturationCanvasDown.bind(this),this._onSaturationCanvasDrag=this._onSaturationCanvasDrag.bind(this),this._onSaturationCanvasUp=this._onSaturationCanvasUp.bind(this),this._onElementClick=this._onElementClick.bind(this),this._handleToggle(),this._handleAlphaKnob(),this._handleHueKnob(),this._handleSaturationKnob()}return _inherits(ColorPicker,_EventEmitter),_createClass(ColorPicker,{_onTransparencyImageLoad:{value:function(){this._loaded=!0,this._render()}},_handleToggle:{value:function(){this._element.addEventListener("click",this._onElementClick)}},_onElementClick:{value:function(e){(e.target===this._element||e.target===this._currentColorCanvas)&&(this._visible?(this.hide(),this.emit("hide")):(this.show(),this.emit("show")))}},hide:{value:function(){this._overlay.classList.remove("imglykit-visible"),this._visible=!1}},show:{value:function(){this._overlay.classList.add("imglykit-visible"),this._visible=!0}},setValue:{value:function(value){this._value=value.clone();var _value$toHSV=this._value.toHSV(),_value$toHSV2=_slicedToArray(_value$toHSV,3),h=_value$toHSV2[0],s=_value$toHSV2[1],v=_value$toHSV2[2];this._hsvColor={h:h,s:s,v:v},this._positionKnobs(),this._render()}},_positionKnobs:{value:function(){this._positionAlphaKnob(),this._positionHueKnob(),this._positionSaturationKnob()}},_positionAlphaKnob:{value:function(){var canvas=this._alphaCanvas,canvasSize=new Vector2(canvas.width,canvas.height),left=this._value.a*canvasSize.x;this._alphaKnob.style.left=""+left+"px"}},_positionHueKnob:{value:function(){var canvas=this._hueCanvas,canvasSize=new Vector2(canvas.width,canvas.height),top=this._hsvColor.h*canvasSize.y;this._hueKnob.style.top=""+top+"px"}},_positionSaturationKnob:{value:function(){var canvas=this._saturationCanvas,canvasSize=new Vector2(canvas.width,canvas.height),left=this._hsvColor.s*canvasSize.x;this._saturationKnob.style.left=""+left+"px";var top=(1-this._hsvColor.v)*canvasSize.y;this._saturationKnob.style.top=""+top+"px"}},_render:{value:function(){this._loaded&&(this._renderCurrentColor(),this._renderAlpha(),this._renderHue(),this._renderSaturation())}},_renderCurrentColor:{value:function(){var canvas=this._currentColorCanvas,context=canvas.getContext("2d"),pattern=context.createPattern(this._transparencyImage,"repeat");context.rect(0,0,canvas.width,canvas.height),context.fillStyle=pattern,context.fill(),context.fillStyle=this._value.toRGBA(),context.fill()}},_renderAlpha:{value:function(){var canvas=this._alphaCanvas,context=canvas.getContext("2d"),pattern=context.createPattern(this._transparencyImage,"repeat");context.rect(0,0,canvas.width,canvas.height),context.fillStyle=pattern,context.fill();var gradient=context.createLinearGradient(0,0,canvas.width,canvas.height),color=this._value.clone();color.a=0,gradient.addColorStop(0,color.toRGBA()),gradient.addColorStop(1,this._value.toHex()),context.fillStyle=gradient,context.fill()}},_renderHue:{value:function(){for(var canvas=this._hueCanvas,context=canvas.getContext("2d"),color=new Color,y=0;y<canvas.height;y++){var ratio=y/canvas.height;color.fromHSV(ratio,1,1),context.strokeStyle=color.toRGBA(),context.beginPath(),context.moveTo(0,y),context.lineTo(canvas.width,y),context.stroke()}}},_renderSaturation:{value:function(){for(var canvas=this._saturationCanvas,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,canvas.width,canvas.height),color=new Color(1,0,0,1),y=0;y<canvas.height;y++)for(var value=(canvas.height-y)/canvas.height,x=0;x<canvas.width;x++){var saturation=x/canvas.width;color.fromHSV(this._hsvColor.h,saturation,value);var r=color.r,g=color.g,b=color.b,a=color.a,index=4*(y*canvas.width+x);imageData.data[index]=255*r,imageData.data[index+1]=255*g,imageData.data[index+2]=255*b,imageData.data[index+3]=255*a}context.putImageData(imageData,0,0)}},_handleAlphaKnob:{value:function(){this._alphaCanvas.addEventListener("mousedown",this._onAlphaCanvasDown),this._alphaCanvas.addEventListener("touchstart",this._onAlphaCanvasDown)}},_onAlphaCanvasDown:{value:function(e){e.preventDefault(),this._onAlphaCanvasDrag(e),document.addEventListener("mousemove",this._onAlphaCanvasDrag),document.addEventListener("touchmove",this._onAlphaCanvasDrag),document.addEventListener("mouseup",this._onAlphaCanvasUp),document.addEventListener("touchend",this._onAlphaCanvasUp)}},_onAlphaCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._alphaCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(new Vector2(0,0),canvasSize),this._alphaKnob.style.left=""+relativePosition.x+"px",this._value.a=relativePosition.x/canvasSize.x,this._updateColor()}},_onAlphaCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onAlphaCanvasDrag),document.removeEventListener("touchmove",this._onAlphaCanvasDrag),document.removeEventListener("mouseup",this._onAlphaCanvasUp),document.removeEventListener("touchend",this._onAlphaCanvasUp)}},_handleHueKnob:{value:function(){this._hueCanvas.addEventListener("mousedown",this._onHueCanvasDown),this._hueCanvas.addEventListener("touchstart",this._onHueCanvasDown)}},_onHueCanvasDown:{value:function(e){e.preventDefault(),this._onHueCanvasDrag(e),document.addEventListener("mousemove",this._onHueCanvasDrag),document.addEventListener("touchmove",this._onHueCanvasDrag),document.addEventListener("mouseup",this._onHueCanvasUp),document.addEventListener("touchend",this._onHueCanvasUp)}},_onHueCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._hueCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(new Vector2(0,0),canvasSize),this._hueKnob.style.top=""+relativePosition.y+"px",relativePosition.divide(canvasSize),this._hsvColor.h=relativePosition.y,this._updateColor()}},_onHueCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onHueCanvasDrag),document.removeEventListener("touchmove",this._onHueCanvasDrag),document.removeEventListener("mouseup",this._onHueCanvasUp),document.removeEventListener("touchend",this._onHueCanvasUp)}},_handleSaturationKnob:{value:function(){this._saturationCanvas.addEventListener("mousedown",this._onSaturationCanvasDown),this._saturationCanvas.addEventListener("touchstart",this._onSaturationCanvasDown)}},_onSaturationCanvasDown:{value:function(e){e.preventDefault(),this._onSaturationCanvasDrag(e),document.addEventListener("mousemove",this._onSaturationCanvasDrag),document.addEventListener("touchmove",this._onSaturationCanvasDrag),document.addEventListener("mouseup",this._onSaturationCanvasUp),document.addEventListener("touchend",this._onSaturationCanvasUp)}},_onSaturationCanvasDrag:{value:function(e){e.preventDefault();var canvas=this._saturationCanvas,canvasSize=new Vector2(canvas.width,canvas.height),mousePosition=Utils.getEventPosition(e),_canvas$getBoundingClientRect=canvas.getBoundingClientRect(),left=_canvas$getBoundingClientRect.left,top=_canvas$getBoundingClientRect.top,offset=new Vector2(left,top),relativePosition=mousePosition.subtract(offset);relativePosition.clamp(0,canvas.width),this._saturationKnob.style.left=""+relativePosition.x+"px",this._saturationKnob.style.top=""+relativePosition.y+"px",relativePosition.divide(canvasSize),this._hsvColor.s=relativePosition.x,this._hsvColor.v=1-relativePosition.y,this._updateColor()}},_onSaturationCanvasUp:{value:function(){document.removeEventListener("mousemove",this._onSaturationCanvasDrag),document.removeEventListener("touchmove",this._onSaturationCanvasDrag),document.removeEventListener("mouseup",this._onSaturationCanvasUp),document.removeEventListener("touchend",this._onSaturationCanvasUp)}},_updateColor:{value:function(){this._value.fromHSV(this._hsvColor.h,this._hsvColor.s,this._hsvColor.v),this.emit("update",this._value),this._render()}}},{template:{get:function(){return'{{##def.colorpicker:\n  <div class="imglykit-color-picker" id="{{=(typeof colorpickerId === "undefined"?\'\':colorpickerId)}}">\n    <canvas class="imglykit-color-picker-color" width="34" height="34"></canvas>\n    <div class="imglykit-controls-item-label">{{=(typeof colorpickerLabel === "undefined"?\'\':colorpickerLabel)}}</div>\n\n    <div class="imglykit-color-picker-overlay">\n      <div class="imglykit-color-picker-alpha-container">\n        <canvas class="imglykit-color-picker-alpha" width="200" height="30"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n\n      <div class="imglykit-color-picker-saturation-container">\n        <canvas class="imglykit-color-picker-saturation" width="160" height="160"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n\n      <div class="imglykit-color-picker-hue-container">\n        <canvas class="imglykit-color-picker-hue" width="30" height="160"></canvas>\n        <div class="imglykit-transparent-knob"></div>\n      </div>\n    </div>\n  </div>\n#}}\n'}}}),ColorPicker}(EventEmitter);module.exports=ColorPicker},{"../../../lib/color":13,"../../../lib/event-emitter":14,"../../../lib/math/vector2":18,"../../../lib/utils":20}],97:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),FileLoader=function(_EventEmitter){function FileLoader(kit,ui){_classCallCheck(this,FileLoader),_get(Object.getPrototypeOf(FileLoader.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this._dragCounter=0,this._container=this._ui.container.querySelector(".imglykit-drop-area-container"),this._onDropAreaDragEnter=this._onDropAreaDragEnter.bind(this),this._onDropAreaDragOver=this._onDropAreaDragOver.bind(this),this._onDropAreaDragLeave=this._onDropAreaDragLeave.bind(this),this._onDropAreaDrop=this._onDropAreaDrop.bind(this),this._onDropAreaClick=this._onDropAreaClick.bind(this),this._onFileInputChange=this._onFileInputChange.bind(this),this._hiddenInputField=this._ui.container.querySelector(".imglykit-drop-area .imglykit-drop-area-hidden-input"),this._hiddenInputField.addEventListener("change",this._onFileInputChange),this._handleDropArea()}return _inherits(FileLoader,_EventEmitter),_createClass(FileLoader,{openFileDialog:{value:function(){this._hiddenInputField.click()}},_handleDropArea:{value:function(){var container=this._ui.container;this._dropArea=container.querySelector(".imglykit-drop-area"),this._dropArea.addEventListener("dragenter",this._onDropAreaDragEnter),this._dropArea.addEventListener("dragover",this._onDropAreaDragOver),this._dropArea.addEventListener("dragleave",this._onDropAreaDragLeave),this._dropArea.addEventListener("drop",this._onDropAreaDrop),this._dropArea.addEventListener("dragdrop",this._onDropAreaDrop),this._dropArea.addEventListener("click",this._onDropAreaClick)}},_onDropAreaClick:{value:function(){this.openFileDialog()}},_onDropAreaDragEnter:{value:function(e){e.preventDefault(),this._dragCounter++,this._dropArea.classList.add("imglykit-drop-area-active")}},_onDropAreaDragOver:{value:function(e){e.preventDefault()}},_onDropAreaDragLeave:{value:function(e){e.preventDefault(),this._dragCounter--,0===this._dragCounter&&this._dropArea.classList.remove("imglykit-drop-area-active")}},_onDropAreaDrop:{value:function(e){e.stopPropagation(),e.preventDefault(),e.returnValue=!1,this._dropArea.classList.remove("imglykit-drop-area-active"),e.dataTransfer&&this._handleFile(e.dataTransfer.files[0])}},_onFileInputChange:{value:function(){this._handleFile(this._hiddenInputField.files[0])}},_handleFile:{value:function(file){this.emit("file",file)}},removeDOM:{value:function(){this._dropArea.removeEventListener("dragenter",this._onDropAreaDragEnter),this._dropArea.removeEventListener("dragover",this._onDropAreaDragOver),this._dropArea.removeEventListener("dragleave",this._onDropAreaDragLeave),this._dropArea.removeEventListener("drop",this._onDropAreaDrop),this._dropArea.removeEventListener("dragdrop",this._onDropAreaDrop),this._dropArea.removeEventListener("click",this._onDropAreaClick),this._container.parentNode&&this._container.parentNode.removeChild(this._container)}}}),FileLoader}(EventEmitter);module.exports=FileLoader},{"../../../lib/event-emitter":14}],98:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Utils=_interopRequire(require("../../../lib/utils")),Vector2=_interopRequire(require("../../../lib/math/vector2")),maxScrollbarWidth=18,Scrollbar=function(){function Scrollbar(container){_classCallCheck(this,Scrollbar),this._container=container,this._isDragging=!1,this._isHovering=!1,this._appendDOM(),this._resizeButton(),this._updateValues(),this._onButtonDown=this._onButtonDown.bind(this),this._onButtonMove=this._onButtonMove.bind(this),this._onButtonUp=this._onButtonUp.bind(this),this._onContainerEnter=this._onContainerEnter.bind(this),this._onContainerLeave=this._onContainerLeave.bind(this),this._onBackgroundClick=this._onBackgroundClick.bind(this),this._container.addEventListener("mouseenter",this._onContainerEnter),this._container.addEventListener("mouseleave",this._onContainerLeave),this._container.addEventListener("mousemove",this._onContainerEnter),this._dom.button.addEventListener("mousedown",this._onButtonDown),this._dom.button.addEventListener("touchstart",this._onButtonDown),this._dom.background.addEventListener("click",this._onBackgroundClick),this._list.addEventListener("scroll",this._onListScroll.bind(this)),
this._onListScroll()}return _createClass(Scrollbar,{_onBackgroundClick:{value:function(e){if(e.preventDefault(),e.target===this._dom.background){var position=Utils.getEventPosition(e),backgroundOffset=this._dom.background.getBoundingClientRect();backgroundOffset=new Vector2(backgroundOffset.left,backgroundOffset.top);var relativePosition=position.clone().subtract(backgroundOffset);relativePosition.x-=.5*this._values.button.width,this._setButtonPosition(relativePosition.x)}}},_onContainerEnter:{value:function(){this._isHovering=!0,this.show()}},_onContainerLeave:{value:function(){this._isHovering=!1,this.hide()}},show:{value:function(){this._isScrollingNecessary&&this._dom.background.classList.add("visible")}},hide:{value:function(){this._isDragging||this._dom.background.classList.remove("visible")}},_updateValues:{value:function(){this._values={list:{totalWidth:this._list.scrollWidth,visibleWidth:this._list.offsetWidth,scrollableWidth:this._list.scrollWidth-this._list.offsetWidth},button:{width:this._dom.button.offsetWidth,scrollableWidth:this._dom.background.offsetWidth-this._dom.button.offsetWidth}}}},_onButtonDown:{value:function(event){event.preventDefault(),this._isDragging=!0,this._initialMousePosition=Utils.getEventPosition(event),this._initialButtonPosition=this._buttonPosition||0,document.addEventListener("mousemove",this._onButtonMove),document.addEventListener("touchmove",this._onButtonMove),document.addEventListener("mouseup",this._onButtonUp),document.addEventListener("touchend",this._onButtonUp)}},_onButtonMove:{value:function(event){event.preventDefault();var mousePosition=Utils.getEventPosition(event),diff=mousePosition.clone().subtract(this._initialMousePosition),newButtonPosition=this._initialButtonPosition+diff.x;this._setButtonPosition(newButtonPosition)}},_setButtonPosition:{value:function(newButtonPosition){newButtonPosition=Math.max(0,newButtonPosition),newButtonPosition=Math.min(newButtonPosition,this._values.button.scrollableWidth),this._buttonPosition=newButtonPosition,this._dom.button.style.left=""+this._buttonPosition+"px";var progress=newButtonPosition/this._values.button.scrollableWidth,scrollPosition=this._values.list.scrollableWidth*progress;this._list.scrollLeft=scrollPosition}},_onButtonUp:{value:function(){this._isDragging=!1,document.removeEventListener("mousemove",this._onButtonMove),document.removeEventListener("touchmove",this._onButtonMove),document.removeEventListener("mouseup",this._onButtonUp),document.removeEventListener("touchend",this._onButtonUp)}},_onListScroll:{value:function(){if(!this._isDragging){var listScrollWidth=this._list.scrollWidth-this._list.offsetWidth,listScrollPosition=this._list.scrollLeft,backgroundScrollWidth=this._dom.background.offsetWidth-this._dom.button.offsetWidth,progress=listScrollPosition/listScrollWidth;this._buttonPosition=backgroundScrollWidth*progress,this._dom.button.style.left=""+this._buttonPosition+"px"}}},_resizeButton:{value:function(){var listScrollWidth=this._list.scrollWidth,listWidth=this._list.offsetWidth;this._buttonWidth=listWidth/listScrollWidth*listWidth,this._dom.button.style.width=""+this._buttonWidth+"px"}},_appendDOM:{value:function(){var background=document.createElement("div");background.classList.add("imglykit-scrollbar-background"),background.style.bottom=""+maxScrollbarWidth+"px";var button=document.createElement("div");button.classList.add("imglykit-scrollbar-button"),background.appendChild(button),this._container.appendChild(background),this._container.style.position="relative",this._list=this._container.querySelector(".imglykit-controls-list"),this._dom={background:background,button:button},this._list.style.height="";var listHeight=this._list.offsetHeight;listHeight+=maxScrollbarWidth,this._container.style.height=""+listHeight+"px",this._list.style.height=""+listHeight+"px"}},remove:{value:function(){this._dom.button.removeEventListener("mousedown",this._onButtonDown),this._dom.button.removeEventListener("touchstart",this._onButtonDown),this._dom.background.remove()}},_isScrollingNecessary:{get:function(){return this._list.scrollWidth>this._list.offsetWidth}}}),Scrollbar}();module.exports=Scrollbar},{"../../../lib/math/vector2":18,"../../../lib/utils":20}],99:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},Slider=_interopRequire(require("./slider")),SimpleSlider=function(_Slider){function SimpleSlider(){_classCallCheck(this,SimpleSlider),null!=_Slider&&_Slider.apply(this,arguments)}return _inherits(SimpleSlider,_Slider),_createClass(SimpleSlider,{_setX:{value:function(x){this._xPosition=x,this._dotElement.style.left=""+x+"px",this._fillElement.style.width=""+x+"px"}}},{template:{get:function(){return'{{##def.simpleSlider:\n  <div class="imglykit-slider" id="{{=(typeof sliderId === "undefined"?\'\':sliderId)}}">\n    <div class="imglykit-slider-minus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/minus.png\') }}" />\n    </div>\n    <div class="imglykit-slider-slider">\n      <div class="imglykit-slider-background"></div>\n      <div class="imglykit-slider-fill"></div>\n      <div class="imglykit-slider-dot"></div>\n    </div>\n    <div class="imglykit-slider-plus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/plus.png\') }}" />\n    </div>\n  </div>\n#}}\n'}}}),SimpleSlider}(Slider);module.exports=SimpleSlider},{"./slider":100}],100:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),Utils=_interopRequire(require("../../../lib/utils")),Vector2=_interopRequire(require("../../../lib/math/vector2")),_=_interopRequire(require("lodash")),Slider=function(_EventEmitter){function Slider(element,options){_classCallCheck(this,Slider),_get(Object.getPrototypeOf(Slider.prototype),"constructor",this).call(this),this._element=element,this._options=_.defaults(options,{minValue:0,maxValue:1,defaultValue:0}),this._value=this._options.defaultValue,this._sliderElement=this._element.querySelector(".imglykit-slider-slider"),this._dotElement=this._element.querySelector(".imglykit-slider-dot"),this._centerDotElement=this._element.querySelector(".imglykit-slider-center-dot"),this._fillElement=this._element.querySelector(".imglykit-slider-fill"),this._backgroundElement=this._element.querySelector(".imglykit-slider-background"),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onCenterDotClick=this._onCenterDotClick.bind(this),this._onBackgroundClick=this._onBackgroundClick.bind(this),this._backgroundElement.addEventListener("click",this._onBackgroundClick),this._fillElement.addEventListener("click",this._onBackgroundClick),this._handleDot()}return _inherits(Slider,_EventEmitter),_createClass(Slider,{setValue:{value:function(value){this._value=value;var _options=this._options,maxValue=_options.maxValue,minValue=_options.minValue,valueRange=maxValue-minValue,percentage=(value-minValue)/valueRange,sliderWidth=this._sliderElement.offsetWidth;this._setX(sliderWidth*percentage)}},_setX:{value:function(x){this._xPosition=x,this._dotElement.style.left=""+x+"px";var halfSliderWidth=this._sliderElement.offsetWidth/2,relativeX=x-halfSliderWidth;this._fillElement.style.width=""+Math.abs(relativeX)+"px",this._fillElement.style.left=0>relativeX?halfSliderWidth-Math.abs(relativeX)+"px":halfSliderWidth+"px"}},_handleDot:{value:function(){this._dotElement.addEventListener("mousedown",this._onMouseDown),this._dotElement.addEventListener("touchstart",this._onMouseDown),this._centerDotElement&&this._centerDotElement.addEventListener("click",this._onCenterDotClick)}},_onCenterDotClick:{value:function(){this.setValue(this._options.defaultValue),this.emit("update",this._value)}},_onBackgroundClick:{value:function(e){var position=Utils.getEventPosition(e),sliderOffset=this._sliderElement.getBoundingClientRect();sliderOffset=new Vector2(sliderOffset.left,sliderOffset.y);var relativePosition=position.clone().subtract(sliderOffset);this._setX(relativePosition.x),this._updateValue()}},_onMouseDown:{value:function(e){if("mousedown"!==e.type||0===e.button){e.preventDefault();var mousePosition=Utils.getEventPosition(e);document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("touchmove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp),document.addEventListener("touchend",this._onMouseUp);var dotPosition=this._dotElement.getBoundingClientRect(),sliderPosition=this._sliderElement.getBoundingClientRect();this._initialSliderX=dotPosition.left-sliderPosition.left,this._initialMousePosition=mousePosition}}},_onMouseMove:{value:function(e){e.preventDefault();var mousePosition=Utils.getEventPosition(e),mouseDiff=mousePosition.subtract(this._initialMousePosition),halfDotWidth=.5*this._dotElement.offsetWidth,newSliderX=this._initialSliderX+mouseDiff.x+halfDotWidth,sliderWidth=this._sliderElement.offsetWidth;newSliderX=Math.max(0,Math.min(newSliderX,sliderWidth)),this._setX(newSliderX),this._updateValue()}},_updateValue:{value:function(){var sliderWidth=this._sliderElement.offsetWidth,_options=this._options,minValue=_options.minValue,maxValue=_options.maxValue,percentage=this._xPosition/sliderWidth,value=minValue+(maxValue-minValue)*percentage;this.emit("update",value)}},_onMouseUp:{value:function(){document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("touchmove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("touchend",this._onMouseUp)}}},{template:{get:function(){return'{{##def.slider:\n  <div class="imglykit-slider" id="{{=(typeof sliderId === "undefined"?\'\':sliderId)}}">\n    <div class="imglykit-slider-minus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/minus.png\') }}" />\n    </div>\n    <div class="imglykit-slider-slider">\n      <div class="imglykit-slider-background"></div>\n      <div class="imglykit-slider-fill"></div>\n      <div class="imglykit-slider-center-dot"></div>\n      <div class="imglykit-slider-dot"></div>\n    </div>\n    <div class="imglykit-slider-plus">\n      <img src="{{=it.helpers.assetPath(\'ui/night/slider/plus.png\') }}" />\n    </div>\n  </div>\n#}}\n'}}}),Slider}(EventEmitter);module.exports=Slider},{"../../../lib/event-emitter":14,"../../../lib/math/vector2":18,"../../../lib/utils":20,lodash:"lodash"}],101:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},EventEmitter=_interopRequire(require("../../../lib/event-emitter")),TopControls=function(_EventEmitter){function TopControls(kit,ui){_classCallCheck(this,TopControls),_get(Object.getPrototypeOf(TopControls.prototype),"constructor",this).call(this),this._kit=kit,this._ui=ui,this.init()}return _inherits(TopControls,_EventEmitter),_createClass(TopControls,{init:{value:function(){this._canvas=this._ui.canvas}},run:{value:function(){var container=this._ui.container;this._rightControls=container.querySelector(".imglykit-top-controls-right"),this._leftControls=container.querySelector(".imglykit-top-controls-left"),this._undoButton=container.querySelector(".imglykit-undo"),this._zoomIn=container.querySelector(".imglykit-zoom-in"),this._zoomOut=container.querySelector(".imglykit-zoom-out"),this._zoomLevel=container.querySelector(".imglykit-zoom-level-num"),this._newButton=container.querySelector(".imglykit-new"),this._handleZoom(),this._handleUndo(),this._handleNew()}},_handleZoom:{value:function(){this._zoomIn.addEventListener("click",this._onZoomInClick.bind(this)),this._zoomOut.addEventListener("click",this._onZoomOutClick.bind(this))}},_handleUndo:{value:function(){this._undoButton.addEventListener("click",this._undo.bind(this)),this._undo()}},_handleNew:{value:function(){this._newButton&&this._newButton.addEventListener("click",this._onNewClick.bind(this))}},_onNewClick:{value:function(e){e.preventDefault();var fileLoader=this._ui.fileLoader;fileLoader.openFileDialog()}},_undo:{value:function(){this.emit("undo")}},updateUndoButton:{value:function(){var history=this._ui.history;this._undoButton.style.display=0===history.length?"none":"inline-block"}},_onZoomInClick:{value:function(e){e.preventDefault(),this.emit("zoom-in"),this.updateZoomLevel()}},_onZoomOutClick:{value:function(e){e.preventDefault(),this.emit("zoom-out"),this.updateZoomLevel()}},showZoom:{value:function(){this._rightControls.style.display="inline-block"}},hideZoom:{value:function(){this._rightControls.style.display="none"}},updateZoomLevel:{value:function(){var zoomLevel=this._canvas.zoomLevel;this._zoomLevel.innerHTML=Math.round(100*zoomLevel)}}}),TopControls}(EventEmitter);module.exports=TopControls},{"../../../lib/event-emitter":14}],102:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc&&desc.writable)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},_inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},_=_interopRequire(require("lodash")),UI=_interopRequire(require("../base/ui")),Canvas=_interopRequire(require("./lib/canvas")),FileLoader=_interopRequire(require("./lib/file-loader")),TopControls=_interopRequire(require("./lib/top-controls")),Scrollbar=_interopRequire(require("./lib/scrollbar")),NightUI=function(_UI){function NightUI(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];_classCallCheck(this,NightUI),this._operationsMap={},this._template='<div class="imglykit-container">\n  {{? !it.options.ui.hideHeader }}\n  <div class="imglykit-header">\n    img.ly Photo Editor SDK\n\n    {{? it.options.ui.showCloseButton }}\n    <div class="imglykit-close-button">\n      <img src="{{=it.helpers.assetPath(\'ui/night/close.png\')}}" />\n    </div>\n    {{?}}\n  </div>\n  {{?}}\n  <div class="imglykit-top-controls{{? !it.options.ui.hideHeader }} imglykit-header-padding{{?}}">\n    <div class="imglykit-top-controls-left">\n      {{? it.options.ui.showNewButton }}\n      <div class="imglykit-new">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/new.png\')}}" />\n        New\n      </div>\n      {{?}}\n      <div class="imglykit-undo">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/undo.png\')}}" />\n        Undo\n      </div>\n    </div>\n    <div class="imglykit-top-controls-right">\n      <div class="imglykit-zoom-fit"></div>\n      <div class="imglykit-zoom-level">Zoom: <span class="imglykit-zoom-level-num">100</span>%</div>\n      <div class="imglykit-zoom-in">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/zoom-in.png\')}}" />\n      </div>\n      <div class="imglykit-zoom-out">\n        <img src="{{=it.helpers.assetPath(\'ui/night/top/zoom-out.png\')}}" />\n      </div>\n    </div>\n  </div>\n\n  <div class="imglykit-canvas-container{{? !it.options.ui.hideHeader }} imglykit-header-padding{{?}}">\n    <div class="imglykit-canvas-inner-container">\n      <canvas class="imglykit-canvas-draggable"></canvas>\n      <div class="imglykit-canvas-controls imglykit-canvas-controls-disabled"></div>\n    </div>\n    {{? it.renderDropArea }}\n    <div class="imglykit-drop-area-container{{? !it.options.ui.hideHeader }} imglykit-header-padding{{?}}">\n      <div class="imglykit-drop-area">\n        <input type="file" class="imglykit-drop-area-hidden-input" />\n        <img src="{{=it.helpers.assetPath(\'ui/night/upload.png\')}}" />\n\n        <div class="imglykit-drop-area-content">\n          <h1>Upload a picture</h1>\n          <span>Click to upload a picture from your library or just drag and drop</span>\n        </div>\n      </div>\n    </div>\n    {{?}}\n  </div>\n\n  <div class="imglykit-controls-container">\n    <div class="imglykit-controls">\n\n      <div>\n        <div class="imglykit-controls-overview">\n          <ul class="imglykit-controls-list">\n          {{ for (var identifier in it.controls) { }}\n            {{ var control = it.controls[identifier]; }}\n            <li data-identifier="{{= control.identifier}}"{{? it.controlsDisabled }} data-disabled{{?}}>\n              <img src="{{=it.helpers.assetPath(\'ui/night/operations/\' + control.identifier + \'.png\') }}" />\n            </li>\n          {{ } }}\n          </ul>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</div>\n',this._registeredControls={},this._history=[],this._preferredOperationOrder=["rotation","crop","flip","filters","contrast","brightness","saturation","radial-blur","tilt-shift","frames","stickers","text"],this._paused=!1,_get(Object.getPrototypeOf(NightUI.prototype),"constructor",this).apply(this,args),this._options.ui=_.defaults(this._options.ui,{showNewButton:!this._options.image,showHeader:!0,showCloseButton:!1})}return _inherits(NightUI,_UI),_createClass(NightUI,{identifier:{get:function(){return"night"}},run:{value:function(){this._registerControls(),_get(Object.getPrototypeOf(NightUI.prototype),"run",this).call(this);var container=this._options.container;this._controlsContainer=container.querySelector(".imglykit-controls"),this._canvasControlsContainer=container.querySelector(".imglykit-canvas-controls"),this._overviewControlsContainer=container.querySelector(".imglykit-controls-overview"),this._handleOverview(),this._options.image?this._initCanvas():this._initFileLoader(),this._initTopControls(),this._initControls(),this._options.image&&this.showZoom(),this._options.ui.showCloseButton&&this._handleCloseButton()}},_initFileLoader:{value:function(){this._fileLoader=new FileLoader(this._kit,this),this._fileLoader.on("file",this._onFileLoaded.bind(this))}},_onFileLoaded:{value:function(file){var _this=this,reader=new FileReader;reader.onload=function(){return function(e){var data=e.target.result,image=new Image;image.src=data,_this._setImage(image)}}(file),reader.readAsDataURL(file)}},_setImage:{value:function(image){this._options.image=image,this._canvas&&this._canvas.reset(),this._fileLoader.removeDOM(),this._canvas?this._canvas.setImage(this._options.image):this._initCanvas(),this.showZoom(),this._topControls.init(),this._enableControls()}},_initTopControls:{value:function(){var _this=this;this._topControls=new TopControls(this._kit,this),this._topControls.run(),this._topControls.on("undo",function(){_this.undo()}),this._topControls.on("zoom-in",function(){_this._canvas.zoomIn().then(function(){_this._currentControl&&_this._currentControl.onZoom()})}),this._topControls.on("zoom-out",function(){_this._canvas.zoomOut().then(function(){_this._currentControl&&_this._currentControl.onZoom()})})}},_initCanvas:{value:function(){var _this=this;this._canvas=new Canvas(this._kit,this,this._options),this._canvas.run(),this._canvas.on("zoom",function(){_this._topControls.updateZoomLevel()})}},selectOperations:{value:function(selector){_get(Object.getPrototypeOf(NightUI.prototype),"selectOperations",this).call(this,selector)}},getOrCreateOperation:{value:function(identifier){var _kit=this._kit,operationsStack=_kit.operationsStack,registeredOperations=_kit.registeredOperations,Operation=registeredOperations[identifier];if("undefined"==typeof this._operationsMap[identifier]){var operationInstance=new Operation(this._kit);this._operationsMap[identifier]=operationInstance;var index=this._preferredOperationOrder.indexOf(identifier);return-1===index&&(index=this._preferredOperationOrder.length),operationsStack[index]=operationInstance,operationInstance}return this._operationsMap[identifier]}},removeOperation:{value:function(identifier){if(this._operationsMap[identifier]){var operation=this._operationsMap[identifier];delete this._operationsMap[identifier];var index=this._kit.operationsStack.indexOf(operation);this._kit.operationsStack.splice(index,1)}}},_registerControls:{value:function(){this.registerControl("filters","filters",require("./controls/filters")),this.registerControl("rotation","rotation",require("./controls/rotation")),this.registerControl("flip","flip",require("./controls/flip")),this.registerControl("brightness","brightness",require("./controls/brightness")),this.registerControl("contrast","contrast",require("./controls/contrast")),this.registerControl("saturation","saturation",require("./controls/saturation")),this.registerControl("crop","crop",require("./controls/crop")),this.registerControl("radial-blur","radial-blur",require("./controls/radial-blur")),this.registerControl("tilt-shift","tilt-shift",require("./controls/tilt-shift")),this.registerControl("frames","frames",require("./controls/frames")),this.registerControl("stickers","stickers",require("./controls/stickers")),this.registerControl("text","text",require("./controls/text"))}},_handleOverview:{value:function(){var _this=this,listItems=this._overviewControlsContainer.querySelectorAll(":scope > ul > li");listItems=Array.prototype.slice.call(listItems);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=listItems[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0)!function(){var listItem=_step.value,identifier=listItem.dataset.identifier;listItem.addEventListener("click",function(){_this.switchToControl(identifier)})}()}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},_enableControls:{value:function(){var listItems=this._overviewControlsContainer.querySelectorAll(":scope > ul > li");listItems=Array.prototype.slice.call(listItems);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=listItems[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var listItem=_step.value;listItem.removeAttribute("data-disabled")}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},switchToControl:{value:function(identifier){this.context.controlsDisabled||(this._overviewControlsContainer.style.display="none",this._scrollbar.remove(),this._currentControl&&this._currentControl.leave(),this._currentControl=this._registeredControls[identifier],this._currentControl.enter(),this._currentControl.once("back",this._switchToOverview.bind(this)))}},_switchToOverview:{value:function(){this._currentControl&&this._currentControl.leave(),this._currentControl=null,this._overviewControlsContainer.style.display="",this._initScrollbar()}},registerControl:{value:function(identifier,operationIdentifier,ControlClass){if(this.isOperationSelected(operationIdentifier)){var instance=new ControlClass(this._kit,this);this._registeredControls[identifier]=instance}}},_initControls:{value:function(){for(var identifier in this._registeredControls){var control=this._registeredControls[identifier];control.setContainers(this._controlsContainer,this._canvasControlsContainer),control.init()}this._initScrollbar()}},_initScrollbar:{value:function(){var container=this._controlsContainer.querySelector(".imglykit-controls-list").parentNode;this._scrollbar=new Scrollbar(container)}},_handleCloseButton:{value:function(){var _this=this,closeButton=this._options.container.querySelector(".imglykit-close-button");closeButton.addEventListener("click",function(e){e.preventDefault(),_this.emit("close")})}},render:{value:function(){this._canvas&&this._canvas.render()}},operations:{get:function(){return this._operationsMap}},controls:{get:function(){return this._registeredControls}},context:{get:function(){var context=_get(Object.getPrototypeOf(NightUI.prototype),"context",this);return context.controls=this._registeredControls,context.renderDropArea=!this._options.image,context.controlsDisabled=!this._options.image,context}},pause:{value:function(){this._paused=!0}},resume:{value:function(){var rerender=void 0===arguments[0]?!0:arguments[0];this._paused=!1,rerender&&this.render()}},addHistory:{value:function(operation,options,existent){this._history.push({operation:operation,options:options,existent:existent}),this._topControls.updateUndoButton()}},hideZoom:{value:function(){this._topControls.hideZoom()}},showZoom:{value:function(){this._topControls.showZoom()}},undo:{value:function(){var lastItem=this._history.pop();if(lastItem){var operation=lastItem.operation,existent=lastItem.existent,options=lastItem.options;existent?(operation=this.getOrCreateOperation(operation.identifier),operation.set(options)):this.removeOperation(operation.identifier),this.canvas.zoomToFit(!0)}this._topControls.updateUndoButton()}},history:{get:function(){return this._history}},fileLoader:{get:function(){return this._fileLoader}}}),NightUI}(UI);NightUI.Control=require("./controls/control"),module.exports=NightUI},{"../base/ui":81,"./controls/brightness":82,"./controls/contrast":83,"./controls/control":84,"./controls/crop":85,"./controls/filters":86,"./controls/flip":87,"./controls/frames":88,"./controls/radial-blur":89,"./controls/rotation":90,"./controls/saturation":91,"./controls/stickers":92,"./controls/text":93,"./controls/tilt-shift":94,"./lib/canvas":95,"./lib/file-loader":97,"./lib/scrollbar":98,"./lib/top-controls":101,lodash:"lodash"}],103:[function(require,module){"use strict";function stackBlurCanvasRGBA(imageData,top_x,top_y,width,height,radius){if(!(isNaN(radius)||1>radius)){radius|=0;var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs,stackEnd,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;div>i;i++)stack=stack.next=new BlurStack,i==radiusPlus1&&(stackEnd=stack);stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;height>y;y++){for(r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(i=1;radiusPlus1>i;i++)p=yi+((i>widthMinus1?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,a_sum+=(stack.a=pa=pixels[p+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;width>x;x++)pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum,0!==pa?(pa=255/pa,pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa,pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],a_in_sum+=stackIn.a=pixels[p+3],
r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,a_sum+=a_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;width>x;x++){for(g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0,yi=x<<2,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;radiusPlus1>i;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(yp=width,i=1;radius>=i;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,a_sum+=(stack.a=pa=pixels[yi+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next,heightMinus1>i&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;height>y;y++)p=yi<<2,pixels[p+3]=pa=a_sum*mul_sum>>shg_sum,pa>0?(pa=255/pa,pixels[p]=(r_sum*mul_sum>>shg_sum)*pa,pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[p]=pixels[p+1]=pixels[p+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],a_sum+=a_in_sum+=stackIn.a=pixels[p+3],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=width}}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];module.exports={stackBlurCanvasRGBA:stackBlurCanvasRGBA}},{}],lodash:[function(require,module,exports){(function(global){"use strict";(function(){function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}function lodash(){}function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return setBindData(bound,bindData),bound}function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;var bindData=func.__bindData__;if("undefined"==typeof bindData&&(support.funcNames&&(bindData=!func.name),bindData=bindData||!support.funcDecomp,!bindData)){var source=fnToString.call(func);support.funcNames||(bindData=!reFuncName.test(source)),bindData||(bindData=reThis.test(source),setBindData(func,bindData))}if(bindData===!1||bindData!==!0&&1&bindData[1])return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return setBindData(bound,bindData),bound}function createWrapper(_x,_x2,_x3,_x4,_x5,_x6){for(var _arguments,_again=!0;_again;){_again=!1;var func=_x,bitmask=_x2,partialArgs=_x3,partialRightArgs=_x4,thisArg=_x5,arity=_x6;isBind=isBindKey=isCurry=isCurryBound=isPartial=isPartialRight=bindData=creater=void 0;var isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var bindData=func&&func.__bindData__;if(!bindData||bindData===!0){var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}bindData=slice(bindData),bindData[2]&&(bindData[2]=slice(bindData[2])),bindData[3]&&(bindData[3]=slice(bindData[3])),!isBind||1&bindData[1]||(bindData[4]=thisArg),!isBind&&1&bindData[1]&&(bitmask|=8),!isCurry||4&bindData[1]||(bindData[5]=arity),isPartial&&push.apply(bindData[2]||(bindData[2]=[]),partialArgs),isPartialRight&&unshift.apply(bindData[3]||(bindData[3]=[]),partialRightArgs),bindData[1]|=bitmask,_arguments=bindData,_x=_arguments[0],_x2=_arguments[1],_x3=_arguments[2],_x4=_arguments[3],_x5=_arguments[4],_x6=_arguments[5],_again=!0}}function createIterator(){iteratorData.shadowedProps=shadowedProps,iteratorData.array=iteratorData.bottom=iteratorData.loop=iteratorData.top="",iteratorData.init="iterable",iteratorData.useHas=!0;for(var object,index=0;object=arguments[index];index++)for(var key in object)iteratorData[key]=object[key];var args=iteratorData.args;iteratorData.firstArg=/^[^,]+/.exec(args)[0];var factory=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+args+") {\n"+iteratorTemplate(iteratorData)+"\n}");return factory(baseCreateCallback,errorClass,errorProto,hasOwnProperty,indicatorObject,isArguments,isArray,isString,iteratorData.keys,objectProto,objectTypes,nonEnumProps,stringClass,stringProto,toString)}function isNative(value){return"function"==typeof value&&reNative.test(value)}function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}function isFunction(value){return"function"==typeof value}function isObject(value){return!(!value||!objectTypes[typeof value])}function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}function identity(value){return value}function noop(){}var indicatorObject={},reFuncName=/^\s*function[ \n\r\t]+\w/,reThis=/\bthis\b/,shadowedProps=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",errorClass="[object Error]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",descriptor={configurable:!1,enumerable:!1,value:null,writable:!1},iteratorData={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var arrayRef=[],errorProto=Error.prototype,objectProto=Object.prototype,stringProto=String.prototype,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,unshift=arrayRef.unshift,defineProperty=function(){try{var o={},func=isNative(func=Object.defineProperty)&&func,result=func(o,o,o)&&func}catch(e){}return result}(),nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nonEnumProps={};nonEnumProps[arrayClass]=nonEnumProps[dateClass]=nonEnumProps[numberClass]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},nonEnumProps[boolClass]=nonEnumProps[stringClass]={constructor:!0,toString:!0,valueOf:!0},nonEnumProps[errorClass]=nonEnumProps[funcClass]=nonEnumProps[regexpClass]={constructor:!0,toString:!0},nonEnumProps[objectClass]={constructor:!0},function(){for(var length=shadowedProps.length;length--;){var key=shadowedProps[length];for(var className in nonEnumProps)hasOwnProperty.call(nonEnumProps,className)&&!hasOwnProperty.call(nonEnumProps[className],key)&&(nonEnumProps[className][key]=!1)}}();var support=lodash.support={};!function(){var ctor=function(){this.x=1},object={0:1,length:1},props=[];ctor.prototype={valueOf:1,y:1};for(var key in new ctor)props.push(key);for(key in arguments);support.argsClass=toString.call(arguments)==argsClass,support.argsObject=arguments.constructor==Object&&!(arguments instanceof Array),support.enumErrorProps=propertyIsEnumerable.call(errorProto,"message")||propertyIsEnumerable.call(errorProto,"name"),support.enumPrototypes=propertyIsEnumerable.call(ctor,"prototype"),support.funcDecomp=!isNative(root.WinRTError)&&reThis.test(function(){return this}),support.funcNames="string"==typeof Function.name,support.nonEnumArgs=0!=key,support.nonEnumShadows=!/valueOf/.test(props),support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0]),support.unindexedChars="x"[0]+Object("x")[0]!="xx"}(1);var iteratorTemplate=function(obj){var __p="var index, iterable = "+obj.firstArg+", result = "+obj.init+";\nif (!iterable) return result;\n"+obj.top+";";obj.array?(__p+="\nvar length = iterable.length; index = -1;\nif ("+obj.array+") {  ",support.unindexedChars&&(__p+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),__p+="\n  while (++index < length) {\n    "+obj.loop+";\n  }\n}\nelse {  "):support.nonEnumArgs&&(__p+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+obj.loop+";\n    }\n  } else {  "),support.enumPrototypes&&(__p+="\n  var skipProto = typeof iterable == 'function';\n  "),support.enumErrorProps&&(__p+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var conditions=[];if(support.enumPrototypes&&conditions.push('!(skipProto && index == "prototype")'),support.enumErrorProps&&conditions.push('!(skipErrorProps && (index == "message" || index == "name"))'),obj.useHas&&obj.keys)__p+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",conditions.length&&(__p+="    if ("+conditions.join(" && ")+") {\n  "),__p+=obj.loop+";    ",conditions.length&&(__p+="\n    }"),__p+="\n  }  ";else if(__p+="\n  for (index in iterable) {\n",obj.useHas&&conditions.push("hasOwnProperty.call(iterable, index)"),conditions.length&&(__p+="    if ("+conditions.join(" && ")+") {\n  "),__p+=obj.loop+";    ",conditions.length&&(__p+="\n    }"),__p+="\n  }    ",support.nonEnumShadows){for(__p+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)__p+="\n    index = '"+obj.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",obj.useHas||(__p+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),__p+=") {\n      "+obj.loop+";\n    }      ";__p+="\n  }    "}return(obj.array||support.nonEnumArgs)&&(__p+="\n}"),__p+=obj.bottom+";\nreturn result"};nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||root.Object()}}());var setBindData=defineProperty?function(func,value){descriptor.value=value,defineProperty(func,"__bindData__",descriptor)}:noop;support.argsClass||(isArguments=function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1},shimKeys=createIterator({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),keys=nativeKeys?function(object){return isObject(object)?support.enumPrototypes&&"function"==typeof object||support.nonEnumArgs&&object.length&&isArguments(object)?shimKeys(object):nativeKeys(object):[]}:shimKeys,defaultsIteratorOptions={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:keys,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},assign=createIterator(defaultsIteratorOptions,{top:defaultsIteratorOptions.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),defaults=createIterator(defaultsIteratorOptions);isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&toString.call(value)==funcClass}),lodash.assign=assign,lodash.bind=bind,lodash.defaults=defaults,lodash.keys=keys,lodash.extend=assign,lodash.identity=identity,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isFunction=isFunction,lodash.isObject=isObject,lodash.isString=isString,lodash.noop=noop,lodash.VERSION="2.4.1","function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=lodash,define(function(){return lodash})):freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}).call(void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);